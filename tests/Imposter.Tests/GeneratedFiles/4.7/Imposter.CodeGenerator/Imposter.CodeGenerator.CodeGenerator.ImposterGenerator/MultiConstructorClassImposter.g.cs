// <auto-generated />
#nullable enable
using global::System;
using global::System.Linq;
using global::System.Collections.Generic;
using global::System.Threading.Tasks;
using global::System.Diagnostics;
using global::System.Runtime.CompilerServices;
using global::Imposter.Abstractions;
using global::System.Collections.Concurrent;
using global::Imposter.Tests.Features.ClassImposter.Suts;

namespace Imposter.Tests.Features.ClassImposter.Suts
{
    [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
    public sealed class MultiConstructorClassImposter : global::Imposter.Abstractions.IHaveImposterInstance<global::Imposter.Tests.Features.ClassImposter.Suts.MultiConstructorClass>
    {
        private readonly CalculateMethodImposter _calculateMethodImposter;
        private readonly CalculateMethodInvocationHistoryCollection _calculateMethodInvocationHistoryCollection = new CalculateMethodInvocationHistoryCollection();
        public ICalculateMethodImposterBuilder Calculate(global::Imposter.Abstractions.Arg<int> input)
        {
            return new CalculateMethodImposter.Builder(_calculateMethodImposter, _calculateMethodInvocationHistoryCollection, new CalculateArgumentsCriteria(input));
        }

        private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
        private ImposterTargetInstance _imposterInstance;
        global::Imposter.Tests.Features.ClassImposter.Suts.MultiConstructorClass global::Imposter.Abstractions.IHaveImposterInstance<global::Imposter.Tests.Features.ClassImposter.Suts.MultiConstructorClass>.Instance()
        {
            return _imposterInstance;
        }

        // virtual int MultiConstructorClass.Calculate(int input)
        public delegate int CalculateDelegate(int input);
        // virtual int MultiConstructorClass.Calculate(int input)
        public delegate void CalculateCallbackDelegate(int input);
        // virtual int MultiConstructorClass.Calculate(int input)
        public delegate global::System.Exception CalculateExceptionGeneratorDelegate(int input);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class CalculateArguments
        {
            public int input;
            internal CalculateArguments(int input)
            {
                this.input = input;
            }
        }

        // virtual int MultiConstructorClass.Calculate(int input)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class CalculateArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<int> input { get; }

            public CalculateArgumentsCriteria(global::Imposter.Abstractions.Arg<int> input)
            {
                this.input = input;
            }

            public bool Matches(CalculateArguments arguments)
            {
                return input.Matches(arguments.input);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICalculateMethodInvocationHistory
        {
            bool Matches(CalculateArgumentsCriteria criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CalculateMethodInvocationHistory : ICalculateMethodInvocationHistory
        {
            internal CalculateArguments Arguments;
            internal int? Result;
            internal global::System.Exception? Exception;
            public CalculateMethodInvocationHistory(CalculateArguments Arguments, int? Result, global::System.Exception? Exception)
            {
                this.Arguments = Arguments;
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches(CalculateArgumentsCriteria criteria)
            {
                return criteria.Matches(Arguments);
            }

            public override string ToString()
            {
                return "Calculate(" + global::System.String.Join(", ", new[] { "input: " + FormatValue(Arguments.input) }) + ")" + " => " + FormatValue(Result) + (Exception == null ? "" : " threw " + FormatValue(Exception));
            }

            private static string FormatValue(object? value)
            {
                return "<" + (value?.ToString() ?? "null") + ">";
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CalculateMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<ICalculateMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<ICalculateMethodInvocationHistory>();
            internal void Add(ICalculateMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count(CalculateArgumentsCriteria argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches(argumentsCriteria));
            }

            public override string ToString()
            {
                return string.Join(Environment.NewLine, _invocationHistory.Select(invocation => invocation.ToString()));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class CalculateMethodInvocationImposterGroup
        {
            internal static CalculateMethodInvocationImposterGroup Default = new CalculateMethodInvocationImposterGroup(new CalculateArgumentsCriteria(global::Imposter.Abstractions.Arg<int>.Any()));
            internal CalculateArgumentsCriteria ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public CalculateMethodInvocationImposterGroup(CalculateArgumentsCriteria argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public int Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, int input, CalculateDelegate? baseImplementation = null)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName, input, baseImplementation);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private CalculateDelegate? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<CalculateCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<CalculateCallbackDelegate>();
                private bool _useBaseImplementation;
                internal bool IsEmpty => !_useBaseImplementation && ((_resultGenerator == null) && (_callbacks.Count == 0));

                public int Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, int input, CalculateDelegate? baseImplementation = null)
                {
                    if (_useBaseImplementation)
                    {
                        _resultGenerator = baseImplementation ?? throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    int result = _resultGenerator.Invoke(input);
                    foreach (var callback in _callbacks)
                    {
                        callback(input);
                    }

                    return result;
                }

                internal void Callback(CalculateCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(CalculateDelegate resultGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(int value)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (int input) =>
                    {
                        return value;
                    };
                }

                internal void Throws(CalculateExceptionGeneratorDelegate exceptionGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (int input) =>
                    {
                        throw exceptionGenerator(input);
                    };
                }

                internal void UseBaseImplementation()
                {
                    _useBaseImplementation = true;
                    _resultGenerator = null;
                }

                internal static int DefaultResultGenerator(int input)
                {
                    return default !;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICalculateMethodInvocationImposterGroupCallback
        {
            ICalculateMethodInvocationImposterGroupContinuation Callback(CalculateCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICalculateMethodInvocationImposterGroupContinuation : ICalculateMethodInvocationImposterGroupCallback
        {
            ICalculateMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICalculateMethodInvocationImposterGroup : ICalculateMethodInvocationImposterGroupCallback
        {
            ICalculateMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            ICalculateMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            ICalculateMethodInvocationImposterGroupContinuation Throws(CalculateExceptionGeneratorDelegate exceptionGenerator);
            ICalculateMethodInvocationImposterGroupContinuation Returns(CalculateDelegate resultGenerator);
            ICalculateMethodInvocationImposterGroupContinuation Returns(int value);
            ICalculateMethodInvocationImposterGroupContinuation UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface CalculateInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICalculateMethodImposterBuilder : ICalculateMethodInvocationImposterGroup, ICalculateMethodInvocationImposterGroupCallback, CalculateInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CalculateMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<CalculateMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<CalculateMethodInvocationImposterGroup>();
            private readonly CalculateMethodInvocationHistoryCollection _calculateMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public CalculateMethodImposter(CalculateMethodInvocationHistoryCollection _calculateMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._calculateMethodInvocationHistoryCollection = _calculateMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup(CalculateArguments arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private CalculateMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup(CalculateArguments arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public int Invoke(int input, CalculateDelegate? baseImplementation = null)
            {
                var arguments = new CalculateArguments(input);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("virtual int MultiConstructorClass.Calculate(int input)");
                    }

                    matchingInvocationImposterGroup = CalculateMethodInvocationImposterGroup.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "virtual int MultiConstructorClass.Calculate(int input)", input, baseImplementation);
                    _calculateMethodInvocationHistoryCollection.Add(new CalculateMethodInvocationHistory(arguments, result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _calculateMethodInvocationHistoryCollection.Add(new CalculateMethodInvocationHistory(arguments, default !, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : ICalculateMethodImposterBuilder, ICalculateMethodInvocationImposterGroupContinuation
            {
                private readonly CalculateMethodImposter _imposter;
                private readonly CalculateMethodInvocationHistoryCollection _calculateMethodInvocationHistoryCollection;
                private readonly CalculateArgumentsCriteria _argumentsCriteria;
                private readonly CalculateMethodInvocationImposterGroup _invocationImposterGroup;
                private CalculateMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(CalculateMethodImposter _imposter, CalculateMethodInvocationHistoryCollection _calculateMethodInvocationHistoryCollection, CalculateArgumentsCriteria _argumentsCriteria)
                {
                    this._imposter = _imposter;
                    this._calculateMethodInvocationHistoryCollection = _calculateMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new CalculateMethodInvocationImposterGroup(_argumentsCriteria);
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                ICalculateMethodInvocationImposterGroupContinuation ICalculateMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((int input) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                ICalculateMethodInvocationImposterGroupContinuation ICalculateMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((int input) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                ICalculateMethodInvocationImposterGroupContinuation ICalculateMethodInvocationImposterGroup.Throws(CalculateExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((int input) =>
                    {
                        throw exceptionGenerator.Invoke(input);
                    });
                    return this;
                }

                ICalculateMethodInvocationImposterGroupContinuation ICalculateMethodInvocationImposterGroupCallback.Callback(CalculateCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                ICalculateMethodInvocationImposterGroupContinuation ICalculateMethodInvocationImposterGroup.Returns(CalculateDelegate resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                ICalculateMethodInvocationImposterGroupContinuation ICalculateMethodInvocationImposterGroup.Returns(int value)
                {
                    _currentInvocationImposter.Returns(value);
                    return this;
                }

                ICalculateMethodInvocationImposterGroupContinuation ICalculateMethodInvocationImposterGroup.UseBaseImplementation()
                {
                    _currentInvocationImposter.UseBaseImplementation();
                    return this;
                }

                ICalculateMethodInvocationImposterGroup ICalculateMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void CalculateInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _calculateMethodInvocationHistoryCollection.Count(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount, _calculateMethodInvocationHistoryCollection.ToString());
                    }
                }
            }
        }

        public MultiConstructorClassImposter(global::Imposter.Abstractions.ImposterMode invocationBehavior = global::Imposter.Abstractions.ImposterMode.Implicit)
        {
            this._calculateMethodImposter = new CalculateMethodImposter(_calculateMethodInvocationHistoryCollection, invocationBehavior);
            this._imposterInstance = new ImposterTargetInstance(this);
            this._invocationBehavior = invocationBehavior;
        }

        public MultiConstructorClassImposter(int value, string label, global::Imposter.Abstractions.ImposterMode invocationBehavior = global::Imposter.Abstractions.ImposterMode.Implicit)
        {
            this._calculateMethodImposter = new CalculateMethodImposter(_calculateMethodInvocationHistoryCollection, invocationBehavior);
            this._imposterInstance = new ImposterTargetInstance(this, value, label);
            this._invocationBehavior = invocationBehavior;
        }

        public MultiConstructorClassImposter(global::System.Guid correlationId, global::Imposter.Abstractions.ImposterMode invocationBehavior = global::Imposter.Abstractions.ImposterMode.Implicit)
        {
            this._calculateMethodImposter = new CalculateMethodImposter(_calculateMethodInvocationHistoryCollection, invocationBehavior);
            this._imposterInstance = new ImposterTargetInstance(this, correlationId);
            this._invocationBehavior = invocationBehavior;
        }

        public MultiConstructorClassImposter(bool enabled, global::Imposter.Abstractions.ImposterMode invocationBehavior = global::Imposter.Abstractions.ImposterMode.Implicit)
        {
            this._calculateMethodImposter = new CalculateMethodImposter(_calculateMethodInvocationHistoryCollection, invocationBehavior);
            this._imposterInstance = new ImposterTargetInstance(this, enabled);
            this._invocationBehavior = invocationBehavior;
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class ImposterTargetInstance : global::Imposter.Tests.Features.ClassImposter.Suts.MultiConstructorClass
        {
            private readonly MultiConstructorClassImposter _imposter;
            internal ImposterTargetInstance(MultiConstructorClassImposter _imposter) : base()
            {
                this._imposter = _imposter;
            }

            internal ImposterTargetInstance(MultiConstructorClassImposter _imposter, int value, string label) : base(value, label)
            {
                this._imposter = _imposter;
            }

            internal ImposterTargetInstance(MultiConstructorClassImposter _imposter, global::System.Guid correlationId) : base(correlationId)
            {
                this._imposter = _imposter;
            }

            internal ImposterTargetInstance(MultiConstructorClassImposter _imposter, bool enabled) : base(enabled)
            {
                this._imposter = _imposter;
            }

            public override int Calculate(int input)
            {
                return _imposter._calculateMethodImposter.Invoke(input, base.Calculate);
            }
        }
    }
}
#nullable restore
