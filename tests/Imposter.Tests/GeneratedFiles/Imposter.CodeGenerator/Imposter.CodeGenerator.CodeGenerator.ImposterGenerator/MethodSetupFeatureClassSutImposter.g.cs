// <auto-generated />
#pragma warning disable nullable
using global::System;
using global::System.Linq;
using global::System.Collections.Generic;
using global::System.Threading.Tasks;
using global::System.Diagnostics;
using global::System.Runtime.CompilerServices;
using global::Imposter.Abstractions;
using global::System.Collections.Concurrent;
using global::Imposter.Tests.Features.MethodImposter;

namespace Imposter.Tests.Features.MethodImposter
{
    [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
    public sealed class MethodSetupFeatureClassSutImposter : global::Imposter.Abstractions.IHaveImposterInstance<global::Imposter.Tests.Features.MethodImposter.MethodSetupFeatureClassSut>
    {
        private readonly IntSingleParamMethodImposter _intSingleParamMethodImposter;
        private readonly VoidWithSideEffectMethodImposter _voidWithSideEffectMethodImposter;
        private readonly SumAsyncMethodImposter _sumAsyncMethodImposter;
        private readonly BuildLabelAsyncMethodImposter _buildLabelAsyncMethodImposter;
        private readonly RefOutWithParamsMethodImposter _refOutWithParamsMethodImposter;
        private readonly ThrowingCalculationMethodImposter _throwingCalculationMethodImposter;
        private readonly IntSingleParamMethodInvocationHistoryCollection _intSingleParamMethodInvocationHistoryCollection = new IntSingleParamMethodInvocationHistoryCollection();
        private readonly VoidWithSideEffectMethodInvocationHistoryCollection _voidWithSideEffectMethodInvocationHistoryCollection = new VoidWithSideEffectMethodInvocationHistoryCollection();
        private readonly SumAsyncMethodInvocationHistoryCollection _sumAsyncMethodInvocationHistoryCollection = new SumAsyncMethodInvocationHistoryCollection();
        private readonly BuildLabelAsyncMethodInvocationHistoryCollection _buildLabelAsyncMethodInvocationHistoryCollection = new BuildLabelAsyncMethodInvocationHistoryCollection();
        private readonly RefOutWithParamsMethodInvocationHistoryCollection _refOutWithParamsMethodInvocationHistoryCollection = new RefOutWithParamsMethodInvocationHistoryCollection();
        private readonly ThrowingCalculationMethodInvocationHistoryCollection _throwingCalculationMethodInvocationHistoryCollection = new ThrowingCalculationMethodInvocationHistoryCollection();
        public IIntSingleParamMethodImposterBuilder IntSingleParam(global::Imposter.Abstractions.Arg<int> age)
        {
            return new IntSingleParamMethodImposter.Builder(_intSingleParamMethodImposter, _intSingleParamMethodInvocationHistoryCollection, new IntSingleParamArgumentsCriteria(age));
        }

        public IVoidWithSideEffectMethodImposterBuilder VoidWithSideEffect(global::Imposter.Abstractions.Arg<int> delta)
        {
            return new VoidWithSideEffectMethodImposter.Builder(_voidWithSideEffectMethodImposter, _voidWithSideEffectMethodInvocationHistoryCollection, new VoidWithSideEffectArgumentsCriteria(delta));
        }

        public ISumAsyncMethodImposterBuilder SumAsync(global::Imposter.Abstractions.Arg<int> left, global::Imposter.Abstractions.Arg<int> right)
        {
            return new SumAsyncMethodImposter.Builder(_sumAsyncMethodImposter, _sumAsyncMethodInvocationHistoryCollection, new SumAsyncArgumentsCriteria(left, right));
        }

        public IBuildLabelAsyncMethodImposterBuilder BuildLabelAsync(global::Imposter.Abstractions.Arg<string> prefix, global::Imposter.Abstractions.Arg<string> suffix)
        {
            return new BuildLabelAsyncMethodImposter.Builder(_buildLabelAsyncMethodImposter, _buildLabelAsyncMethodInvocationHistoryCollection, new BuildLabelAsyncArgumentsCriteria(prefix, suffix));
        }

        public IRefOutWithParamsMethodImposterBuilder RefOutWithParams(global::Imposter.Abstractions.Arg<int> seed, global::Imposter.Abstractions.OutArg<int> doubled, global::Imposter.Abstractions.Arg<int[]> adjustments)
        {
            return new RefOutWithParamsMethodImposter.Builder(_refOutWithParamsMethodImposter, _refOutWithParamsMethodInvocationHistoryCollection, new RefOutWithParamsArgumentsCriteria(seed, doubled, adjustments));
        }

        public IThrowingCalculationMethodImposterBuilder ThrowingCalculation(global::Imposter.Abstractions.Arg<int> value)
        {
            return new ThrowingCalculationMethodImposter.Builder(_throwingCalculationMethodImposter, _throwingCalculationMethodInvocationHistoryCollection, new ThrowingCalculationArgumentsCriteria(value));
        }

        private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
        private ImposterTargetInstance _imposterInstance;
        global::Imposter.Tests.Features.MethodImposter.MethodSetupFeatureClassSut global::Imposter.Abstractions.IHaveImposterInstance<global::Imposter.Tests.Features.MethodImposter.MethodSetupFeatureClassSut>.Instance()
        {
            return _imposterInstance;
        }

        // virtual ValueTask<string> MethodSetupFeatureClassSut.BuildLabelAsync(string prefix, string suffix)
        public delegate global::System.Threading.Tasks.ValueTask<string> BuildLabelAsyncDelegate(string prefix, string suffix);
        // virtual ValueTask<string> MethodSetupFeatureClassSut.BuildLabelAsync(string prefix, string suffix)
        public delegate global::System.Threading.Tasks.Task BuildLabelAsyncCallbackDelegate(string prefix, string suffix);
        // virtual ValueTask<string> MethodSetupFeatureClassSut.BuildLabelAsync(string prefix, string suffix)
        public delegate global::System.Exception BuildLabelAsyncExceptionGeneratorDelegate(string prefix, string suffix);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class BuildLabelAsyncArguments
        {
            public string prefix;
            public string suffix;
            internal BuildLabelAsyncArguments(string prefix, string suffix)
            {
                this.prefix = prefix;
                this.suffix = suffix;
            }
        }

        // virtual ValueTask<string> MethodSetupFeatureClassSut.BuildLabelAsync(string prefix, string suffix)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class BuildLabelAsyncArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<string> prefix { get; }
            public global::Imposter.Abstractions.Arg<string> suffix { get; }

            public BuildLabelAsyncArgumentsCriteria(global::Imposter.Abstractions.Arg<string> prefix, global::Imposter.Abstractions.Arg<string> suffix)
            {
                this.prefix = prefix;
                this.suffix = suffix;
            }

            public bool Matches(BuildLabelAsyncArguments arguments)
            {
                return prefix.Matches(arguments.prefix) && suffix.Matches(arguments.suffix);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IBuildLabelAsyncMethodInvocationHistory
        {
            bool Matches(BuildLabelAsyncArgumentsCriteria criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class BuildLabelAsyncMethodInvocationHistory : IBuildLabelAsyncMethodInvocationHistory
        {
            internal BuildLabelAsyncArguments Arguments;
            internal global::System.Threading.Tasks.ValueTask<string> Result;
            internal global::System.Exception Exception;
            public BuildLabelAsyncMethodInvocationHistory(BuildLabelAsyncArguments Arguments, global::System.Threading.Tasks.ValueTask<string> Result, global::System.Exception Exception)
            {
                this.Arguments = Arguments;
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches(BuildLabelAsyncArgumentsCriteria criteria)
            {
                return criteria.Matches(Arguments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class BuildLabelAsyncMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IBuildLabelAsyncMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IBuildLabelAsyncMethodInvocationHistory>();
            internal void Add(IBuildLabelAsyncMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count(BuildLabelAsyncArgumentsCriteria argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches(argumentsCriteria));
            }
        }

        // virtual ValueTask<string> MethodSetupFeatureClassSut.BuildLabelAsync(string prefix, string suffix)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class BuildLabelAsyncMethodInvocationImposterGroup
        {
            internal static BuildLabelAsyncMethodInvocationImposterGroup Default = new BuildLabelAsyncMethodInvocationImposterGroup(new BuildLabelAsyncArgumentsCriteria(global::Imposter.Abstractions.Arg<string>.Any(), global::Imposter.Abstractions.Arg<string>.Any()));
            internal BuildLabelAsyncArgumentsCriteria ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter _lastestInvocationImposter;
            public BuildLabelAsyncMethodInvocationImposterGroup(BuildLabelAsyncArgumentsCriteria argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                MethodInvocationImposter invocationImposter;
                if (_invocationImposters.TryDequeue(out invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public global::System.Threading.Tasks.ValueTask<string> Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, string prefix, string suffix, BuildLabelAsyncDelegate baseImplementation = null)
            {
                MethodInvocationImposter invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName, prefix, suffix, baseImplementation);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private BuildLabelAsyncDelegate _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<BuildLabelAsyncCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<BuildLabelAsyncCallbackDelegate>();
                private bool _useBaseImplementation;
                internal bool IsEmpty => !_useBaseImplementation && ((_resultGenerator == null) && (_callbacks.Count == 0));

                public global::System.Threading.Tasks.ValueTask<string> Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, string prefix, string suffix, BuildLabelAsyncDelegate baseImplementation = null)
                {
                    if (_useBaseImplementation)
                    {
                        _resultGenerator = baseImplementation ?? throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    global::System.Threading.Tasks.ValueTask<string> result = _resultGenerator.Invoke(prefix, suffix);
                    foreach (var callback in _callbacks)
                    {
                        callback(prefix, suffix);
                    }

                    return result;
                }

                internal void Callback(BuildLabelAsyncCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(BuildLabelAsyncDelegate resultGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(global::System.Threading.Tasks.ValueTask<string> value)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (string prefix, string suffix) =>
                    {
                        return value;
                    };
                }

                internal void ReturnsAsync(string value)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (string prefix, string suffix) =>
                    {
                        return new global::System.Threading.Tasks.ValueTask<string>(value);
                    };
                }

                internal void Throws(BuildLabelAsyncExceptionGeneratorDelegate exceptionGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (string prefix, string suffix) =>
                    {
                        throw exceptionGenerator(prefix, suffix);
                    };
                }

                internal void ThrowsAsync(global::System.Exception exception)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (string prefix, string suffix) =>
                    {
                        return new global::System.Threading.Tasks.ValueTask<string>(global::System.Threading.Tasks.Task.FromException<string>(exception));
                    };
                }

                internal void UseBaseImplementation()
                {
                    _useBaseImplementation = true;
                    _resultGenerator = null;
                }

                internal static async global::System.Threading.Tasks.ValueTask<string> DefaultResultGenerator(string prefix, string suffix)
                {
                    return default;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IBuildLabelAsyncMethodInvocationImposterGroupCallback
        {
            IBuildLabelAsyncMethodInvocationImposterGroupContinuation Callback(BuildLabelAsyncCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IBuildLabelAsyncMethodInvocationImposterGroupContinuation : IBuildLabelAsyncMethodInvocationImposterGroupCallback
        {
            IBuildLabelAsyncMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IBuildLabelAsyncMethodInvocationImposterGroup : IBuildLabelAsyncMethodInvocationImposterGroupCallback
        {
            IBuildLabelAsyncMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            IBuildLabelAsyncMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            IBuildLabelAsyncMethodInvocationImposterGroupContinuation Throws(BuildLabelAsyncExceptionGeneratorDelegate exceptionGenerator);
            IBuildLabelAsyncMethodInvocationImposterGroupContinuation Returns(BuildLabelAsyncDelegate resultGenerator);
            IBuildLabelAsyncMethodInvocationImposterGroupContinuation Returns(global::System.Threading.Tasks.ValueTask<string> value);
            IBuildLabelAsyncMethodInvocationImposterGroupContinuation ReturnsAsync(string value);
            IBuildLabelAsyncMethodInvocationImposterGroupContinuation ThrowsAsync(global::System.Exception exception);
            IBuildLabelAsyncMethodInvocationImposterGroupContinuation UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface BuildLabelAsyncInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        // virtual ValueTask<string> MethodSetupFeatureClassSut.BuildLabelAsync(string prefix, string suffix)
        public interface IBuildLabelAsyncMethodImposterBuilder : IBuildLabelAsyncMethodInvocationImposterGroup, IBuildLabelAsyncMethodInvocationImposterGroupCallback, BuildLabelAsyncInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class BuildLabelAsyncMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<BuildLabelAsyncMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<BuildLabelAsyncMethodInvocationImposterGroup>();
            private readonly BuildLabelAsyncMethodInvocationHistoryCollection _buildLabelAsyncMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public BuildLabelAsyncMethodImposter(BuildLabelAsyncMethodInvocationHistoryCollection _buildLabelAsyncMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._buildLabelAsyncMethodInvocationHistoryCollection = _buildLabelAsyncMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup(BuildLabelAsyncArguments arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private BuildLabelAsyncMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup(BuildLabelAsyncArguments arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public global::System.Threading.Tasks.ValueTask<string> Invoke(string prefix, string suffix, BuildLabelAsyncDelegate baseImplementation = null)
            {
                var arguments = new BuildLabelAsyncArguments(prefix, suffix);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("virtual ValueTask<string> MethodSetupFeatureClassSut.BuildLabelAsync(string prefix, string suffix)");
                    }

                    matchingInvocationImposterGroup = BuildLabelAsyncMethodInvocationImposterGroup.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "virtual ValueTask<string> MethodSetupFeatureClassSut.BuildLabelAsync(string prefix, string suffix)", prefix, suffix, baseImplementation);
                    _buildLabelAsyncMethodInvocationHistoryCollection.Add(new BuildLabelAsyncMethodInvocationHistory(arguments, result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _buildLabelAsyncMethodInvocationHistoryCollection.Add(new BuildLabelAsyncMethodInvocationHistory(arguments, default, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IBuildLabelAsyncMethodImposterBuilder, IBuildLabelAsyncMethodInvocationImposterGroupContinuation
            {
                private readonly BuildLabelAsyncMethodImposter _imposter;
                private readonly BuildLabelAsyncMethodInvocationHistoryCollection _buildLabelAsyncMethodInvocationHistoryCollection;
                private readonly BuildLabelAsyncArgumentsCriteria _argumentsCriteria;
                private readonly BuildLabelAsyncMethodInvocationImposterGroup _invocationImposterGroup;
                private BuildLabelAsyncMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(BuildLabelAsyncMethodImposter _imposter, BuildLabelAsyncMethodInvocationHistoryCollection _buildLabelAsyncMethodInvocationHistoryCollection, BuildLabelAsyncArgumentsCriteria _argumentsCriteria)
                {
                    this._imposter = _imposter;
                    this._buildLabelAsyncMethodInvocationHistoryCollection = _buildLabelAsyncMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new BuildLabelAsyncMethodInvocationImposterGroup(_argumentsCriteria);
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IBuildLabelAsyncMethodInvocationImposterGroupContinuation IBuildLabelAsyncMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((string prefix, string suffix) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IBuildLabelAsyncMethodInvocationImposterGroupContinuation IBuildLabelAsyncMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((string prefix, string suffix) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IBuildLabelAsyncMethodInvocationImposterGroupContinuation IBuildLabelAsyncMethodInvocationImposterGroup.Throws(BuildLabelAsyncExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((string prefix, string suffix) =>
                    {
                        throw exceptionGenerator.Invoke(prefix, suffix);
                    });
                    return this;
                }

                IBuildLabelAsyncMethodInvocationImposterGroupContinuation IBuildLabelAsyncMethodInvocationImposterGroupCallback.Callback(BuildLabelAsyncCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IBuildLabelAsyncMethodInvocationImposterGroupContinuation IBuildLabelAsyncMethodInvocationImposterGroup.Returns(BuildLabelAsyncDelegate resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                IBuildLabelAsyncMethodInvocationImposterGroupContinuation IBuildLabelAsyncMethodInvocationImposterGroup.Returns(global::System.Threading.Tasks.ValueTask<string> value)
                {
                    _currentInvocationImposter.Returns(value);
                    return this;
                }

                IBuildLabelAsyncMethodInvocationImposterGroupContinuation IBuildLabelAsyncMethodInvocationImposterGroup.ReturnsAsync(string value)
                {
                    _currentInvocationImposter.ReturnsAsync(value);
                    return this;
                }

                IBuildLabelAsyncMethodInvocationImposterGroupContinuation IBuildLabelAsyncMethodInvocationImposterGroup.ThrowsAsync(global::System.Exception exception)
                {
                    _currentInvocationImposter.ThrowsAsync(exception);
                    return this;
                }

                IBuildLabelAsyncMethodInvocationImposterGroupContinuation IBuildLabelAsyncMethodInvocationImposterGroup.UseBaseImplementation()
                {
                    _currentInvocationImposter.UseBaseImplementation();
                    return this;
                }

                IBuildLabelAsyncMethodInvocationImposterGroup IBuildLabelAsyncMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void BuildLabelAsyncInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _buildLabelAsyncMethodInvocationHistoryCollection.Count(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        // virtual int MethodSetupFeatureClassSut.IntSingleParam(int age)
        public delegate int IntSingleParamDelegate(int age);
        // virtual int MethodSetupFeatureClassSut.IntSingleParam(int age)
        public delegate void IntSingleParamCallbackDelegate(int age);
        // virtual int MethodSetupFeatureClassSut.IntSingleParam(int age)
        public delegate global::System.Exception IntSingleParamExceptionGeneratorDelegate(int age);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class IntSingleParamArguments
        {
            public int age;
            internal IntSingleParamArguments(int age)
            {
                this.age = age;
            }
        }

        // virtual int MethodSetupFeatureClassSut.IntSingleParam(int age)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class IntSingleParamArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<int> age { get; }

            public IntSingleParamArgumentsCriteria(global::Imposter.Abstractions.Arg<int> age)
            {
                this.age = age;
            }

            public bool Matches(IntSingleParamArguments arguments)
            {
                return age.Matches(arguments.age);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIntSingleParamMethodInvocationHistory
        {
            bool Matches(IntSingleParamArgumentsCriteria criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class IntSingleParamMethodInvocationHistory : IIntSingleParamMethodInvocationHistory
        {
            internal IntSingleParamArguments Arguments;
            internal int Result;
            internal global::System.Exception Exception;
            public IntSingleParamMethodInvocationHistory(IntSingleParamArguments Arguments, int Result, global::System.Exception Exception)
            {
                this.Arguments = Arguments;
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches(IntSingleParamArgumentsCriteria criteria)
            {
                return criteria.Matches(Arguments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class IntSingleParamMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IIntSingleParamMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IIntSingleParamMethodInvocationHistory>();
            internal void Add(IIntSingleParamMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count(IntSingleParamArgumentsCriteria argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches(argumentsCriteria));
            }
        }

        // virtual int MethodSetupFeatureClassSut.IntSingleParam(int age)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class IntSingleParamMethodInvocationImposterGroup
        {
            internal static IntSingleParamMethodInvocationImposterGroup Default = new IntSingleParamMethodInvocationImposterGroup(new IntSingleParamArgumentsCriteria(global::Imposter.Abstractions.Arg<int>.Any()));
            internal IntSingleParamArgumentsCriteria ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter _lastestInvocationImposter;
            public IntSingleParamMethodInvocationImposterGroup(IntSingleParamArgumentsCriteria argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                MethodInvocationImposter invocationImposter;
                if (_invocationImposters.TryDequeue(out invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public int Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, int age, IntSingleParamDelegate baseImplementation = null)
            {
                MethodInvocationImposter invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName, age, baseImplementation);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private IntSingleParamDelegate _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<IntSingleParamCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<IntSingleParamCallbackDelegate>();
                private bool _useBaseImplementation;
                internal bool IsEmpty => !_useBaseImplementation && ((_resultGenerator == null) && (_callbacks.Count == 0));

                public int Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, int age, IntSingleParamDelegate baseImplementation = null)
                {
                    if (_useBaseImplementation)
                    {
                        _resultGenerator = baseImplementation ?? throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    int result = _resultGenerator.Invoke(age);
                    foreach (var callback in _callbacks)
                    {
                        callback(age);
                    }

                    return result;
                }

                internal void Callback(IntSingleParamCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(IntSingleParamDelegate resultGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(int value)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (int age) =>
                    {
                        return value;
                    };
                }

                internal void Throws(IntSingleParamExceptionGeneratorDelegate exceptionGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (int age) =>
                    {
                        throw exceptionGenerator(age);
                    };
                }

                internal void UseBaseImplementation()
                {
                    _useBaseImplementation = true;
                    _resultGenerator = null;
                }

                internal static int DefaultResultGenerator(int age)
                {
                    return default;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIntSingleParamMethodInvocationImposterGroupCallback
        {
            IIntSingleParamMethodInvocationImposterGroupContinuation Callback(IntSingleParamCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIntSingleParamMethodInvocationImposterGroupContinuation : IIntSingleParamMethodInvocationImposterGroupCallback
        {
            IIntSingleParamMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIntSingleParamMethodInvocationImposterGroup : IIntSingleParamMethodInvocationImposterGroupCallback
        {
            IIntSingleParamMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            IIntSingleParamMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            IIntSingleParamMethodInvocationImposterGroupContinuation Throws(IntSingleParamExceptionGeneratorDelegate exceptionGenerator);
            IIntSingleParamMethodInvocationImposterGroupContinuation Returns(IntSingleParamDelegate resultGenerator);
            IIntSingleParamMethodInvocationImposterGroupContinuation Returns(int value);
            IIntSingleParamMethodInvocationImposterGroupContinuation UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IntSingleParamInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        // virtual int MethodSetupFeatureClassSut.IntSingleParam(int age)
        public interface IIntSingleParamMethodImposterBuilder : IIntSingleParamMethodInvocationImposterGroup, IIntSingleParamMethodInvocationImposterGroupCallback, IntSingleParamInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class IntSingleParamMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IntSingleParamMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<IntSingleParamMethodInvocationImposterGroup>();
            private readonly IntSingleParamMethodInvocationHistoryCollection _intSingleParamMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public IntSingleParamMethodImposter(IntSingleParamMethodInvocationHistoryCollection _intSingleParamMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._intSingleParamMethodInvocationHistoryCollection = _intSingleParamMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup(IntSingleParamArguments arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private IntSingleParamMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup(IntSingleParamArguments arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public int Invoke(int age, IntSingleParamDelegate baseImplementation = null)
            {
                var arguments = new IntSingleParamArguments(age);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("virtual int MethodSetupFeatureClassSut.IntSingleParam(int age)");
                    }

                    matchingInvocationImposterGroup = IntSingleParamMethodInvocationImposterGroup.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "virtual int MethodSetupFeatureClassSut.IntSingleParam(int age)", age, baseImplementation);
                    _intSingleParamMethodInvocationHistoryCollection.Add(new IntSingleParamMethodInvocationHistory(arguments, result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _intSingleParamMethodInvocationHistoryCollection.Add(new IntSingleParamMethodInvocationHistory(arguments, default, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IIntSingleParamMethodImposterBuilder, IIntSingleParamMethodInvocationImposterGroupContinuation
            {
                private readonly IntSingleParamMethodImposter _imposter;
                private readonly IntSingleParamMethodInvocationHistoryCollection _intSingleParamMethodInvocationHistoryCollection;
                private readonly IntSingleParamArgumentsCriteria _argumentsCriteria;
                private readonly IntSingleParamMethodInvocationImposterGroup _invocationImposterGroup;
                private IntSingleParamMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(IntSingleParamMethodImposter _imposter, IntSingleParamMethodInvocationHistoryCollection _intSingleParamMethodInvocationHistoryCollection, IntSingleParamArgumentsCriteria _argumentsCriteria)
                {
                    this._imposter = _imposter;
                    this._intSingleParamMethodInvocationHistoryCollection = _intSingleParamMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new IntSingleParamMethodInvocationImposterGroup(_argumentsCriteria);
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IIntSingleParamMethodInvocationImposterGroupContinuation IIntSingleParamMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((int age) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IIntSingleParamMethodInvocationImposterGroupContinuation IIntSingleParamMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((int age) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IIntSingleParamMethodInvocationImposterGroupContinuation IIntSingleParamMethodInvocationImposterGroup.Throws(IntSingleParamExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((int age) =>
                    {
                        throw exceptionGenerator.Invoke(age);
                    });
                    return this;
                }

                IIntSingleParamMethodInvocationImposterGroupContinuation IIntSingleParamMethodInvocationImposterGroupCallback.Callback(IntSingleParamCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IIntSingleParamMethodInvocationImposterGroupContinuation IIntSingleParamMethodInvocationImposterGroup.Returns(IntSingleParamDelegate resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                IIntSingleParamMethodInvocationImposterGroupContinuation IIntSingleParamMethodInvocationImposterGroup.Returns(int value)
                {
                    _currentInvocationImposter.Returns(value);
                    return this;
                }

                IIntSingleParamMethodInvocationImposterGroupContinuation IIntSingleParamMethodInvocationImposterGroup.UseBaseImplementation()
                {
                    _currentInvocationImposter.UseBaseImplementation();
                    return this;
                }

                IIntSingleParamMethodInvocationImposterGroup IIntSingleParamMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void IntSingleParamInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _intSingleParamMethodInvocationHistoryCollection.Count(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        // virtual int MethodSetupFeatureClassSut.RefOutWithParams(ref int seed, out int doubled, params int[] adjustments)
        public delegate int RefOutWithParamsDelegate(ref int seed, out int doubled, int[] adjustments);
        // virtual int MethodSetupFeatureClassSut.RefOutWithParams(ref int seed, out int doubled, params int[] adjustments)
        public delegate void RefOutWithParamsCallbackDelegate(ref int seed, out int doubled, int[] adjustments);
        // virtual int MethodSetupFeatureClassSut.RefOutWithParams(ref int seed, out int doubled, params int[] adjustments)
        public delegate global::System.Exception RefOutWithParamsExceptionGeneratorDelegate(ref int seed, out int doubled, int[] adjustments);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class RefOutWithParamsArguments
        {
            public int seed;
            public int[] adjustments;
            internal RefOutWithParamsArguments(int seed, int[] adjustments)
            {
                this.seed = seed;
                this.adjustments = adjustments;
            }
        }

        // virtual int MethodSetupFeatureClassSut.RefOutWithParams(ref int seed, out int doubled, params int[] adjustments)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class RefOutWithParamsArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<int> seed { get; }
            public global::Imposter.Abstractions.OutArg<int> doubled { get; }
            public global::Imposter.Abstractions.Arg<int[]> adjustments { get; }

            public RefOutWithParamsArgumentsCriteria(global::Imposter.Abstractions.Arg<int> seed, global::Imposter.Abstractions.OutArg<int> doubled, global::Imposter.Abstractions.Arg<int[]> adjustments)
            {
                this.seed = seed;
                this.doubled = doubled;
                this.adjustments = adjustments;
            }

            public bool Matches(RefOutWithParamsArguments arguments)
            {
                return seed.Matches(arguments.seed) && adjustments.Matches(arguments.adjustments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IRefOutWithParamsMethodInvocationHistory
        {
            bool Matches(RefOutWithParamsArgumentsCriteria criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class RefOutWithParamsMethodInvocationHistory : IRefOutWithParamsMethodInvocationHistory
        {
            internal RefOutWithParamsArguments Arguments;
            internal int Result;
            internal global::System.Exception Exception;
            public RefOutWithParamsMethodInvocationHistory(RefOutWithParamsArguments Arguments, int Result, global::System.Exception Exception)
            {
                this.Arguments = Arguments;
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches(RefOutWithParamsArgumentsCriteria criteria)
            {
                return criteria.Matches(Arguments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class RefOutWithParamsMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IRefOutWithParamsMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IRefOutWithParamsMethodInvocationHistory>();
            internal void Add(IRefOutWithParamsMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count(RefOutWithParamsArgumentsCriteria argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches(argumentsCriteria));
            }
        }

        // virtual int MethodSetupFeatureClassSut.RefOutWithParams(ref int seed, out int doubled, params int[] adjustments)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class RefOutWithParamsMethodInvocationImposterGroup
        {
            internal static RefOutWithParamsMethodInvocationImposterGroup Default = new RefOutWithParamsMethodInvocationImposterGroup(new RefOutWithParamsArgumentsCriteria(global::Imposter.Abstractions.Arg<int>.Any(), global::Imposter.Abstractions.OutArg<int>.Any(), global::Imposter.Abstractions.Arg<int[]>.Any()));
            internal RefOutWithParamsArgumentsCriteria ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter _lastestInvocationImposter;
            public RefOutWithParamsMethodInvocationImposterGroup(RefOutWithParamsArgumentsCriteria argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                MethodInvocationImposter invocationImposter;
                if (_invocationImposters.TryDequeue(out invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public int Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, ref int seed, out int doubled, int[] adjustments, RefOutWithParamsDelegate baseImplementation = null)
            {
                MethodInvocationImposter invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName, ref seed, out doubled, adjustments, baseImplementation);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private RefOutWithParamsDelegate _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<RefOutWithParamsCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<RefOutWithParamsCallbackDelegate>();
                private bool _useBaseImplementation;
                internal bool IsEmpty => !_useBaseImplementation && ((_resultGenerator == null) && (_callbacks.Count == 0));

                public int Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, ref int seed, out int doubled, int[] adjustments, RefOutWithParamsDelegate baseImplementation = null)
                {
                    if (_useBaseImplementation)
                    {
                        _resultGenerator = baseImplementation ?? throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    int result = _resultGenerator.Invoke(ref seed, out doubled, adjustments);
                    foreach (var callback in _callbacks)
                    {
                        callback(ref seed, out doubled, adjustments);
                    }

                    return result;
                }

                internal void Callback(RefOutWithParamsCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(RefOutWithParamsDelegate resultGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(int value)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (ref int seed, out int doubled, int[] adjustments) =>
                    {
                        InitializeOutParametersWithDefaultValues(out doubled);
                        return value;
                    };
                }

                internal void Throws(RefOutWithParamsExceptionGeneratorDelegate exceptionGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (ref int seed, out int doubled, int[] adjustments) =>
                    {
                        throw exceptionGenerator(ref seed, out doubled, adjustments);
                    };
                }

                internal void UseBaseImplementation()
                {
                    _useBaseImplementation = true;
                    _resultGenerator = null;
                }

                private static void InitializeOutParametersWithDefaultValues(out int doubled)
                {
                    doubled = default(int);
                }

                internal static int DefaultResultGenerator(ref int seed, out int doubled, int[] adjustments)
                {
                    InitializeOutParametersWithDefaultValues(out doubled);
                    return default;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IRefOutWithParamsMethodInvocationImposterGroupCallback
        {
            IRefOutWithParamsMethodInvocationImposterGroupContinuation Callback(RefOutWithParamsCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IRefOutWithParamsMethodInvocationImposterGroupContinuation : IRefOutWithParamsMethodInvocationImposterGroupCallback
        {
            IRefOutWithParamsMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IRefOutWithParamsMethodInvocationImposterGroup : IRefOutWithParamsMethodInvocationImposterGroupCallback
        {
            IRefOutWithParamsMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            IRefOutWithParamsMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            IRefOutWithParamsMethodInvocationImposterGroupContinuation Throws(RefOutWithParamsExceptionGeneratorDelegate exceptionGenerator);
            IRefOutWithParamsMethodInvocationImposterGroupContinuation Returns(RefOutWithParamsDelegate resultGenerator);
            IRefOutWithParamsMethodInvocationImposterGroupContinuation Returns(int value);
            IRefOutWithParamsMethodInvocationImposterGroupContinuation UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface RefOutWithParamsInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        // virtual int MethodSetupFeatureClassSut.RefOutWithParams(ref int seed, out int doubled, params int[] adjustments)
        public interface IRefOutWithParamsMethodImposterBuilder : IRefOutWithParamsMethodInvocationImposterGroup, IRefOutWithParamsMethodInvocationImposterGroupCallback, RefOutWithParamsInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class RefOutWithParamsMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<RefOutWithParamsMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<RefOutWithParamsMethodInvocationImposterGroup>();
            private readonly RefOutWithParamsMethodInvocationHistoryCollection _refOutWithParamsMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public RefOutWithParamsMethodImposter(RefOutWithParamsMethodInvocationHistoryCollection _refOutWithParamsMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._refOutWithParamsMethodInvocationHistoryCollection = _refOutWithParamsMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            private static void InitializeOutParametersWithDefaultValues(out int doubled)
            {
                doubled = default(int);
            }

            public bool HasMatchingInvocationImposterGroup(RefOutWithParamsArguments arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private RefOutWithParamsMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup(RefOutWithParamsArguments arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public int Invoke(ref int seed, out int doubled, int[] adjustments, RefOutWithParamsDelegate baseImplementation = null)
            {
                var arguments = new RefOutWithParamsArguments(seed, adjustments);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("virtual int MethodSetupFeatureClassSut.RefOutWithParams(ref int seed, out int doubled, params int[] adjustments)");
                    }

                    matchingInvocationImposterGroup = RefOutWithParamsMethodInvocationImposterGroup.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "virtual int MethodSetupFeatureClassSut.RefOutWithParams(ref int seed, out int doubled, params int[] adjustments)", ref seed, out doubled, adjustments, baseImplementation);
                    _refOutWithParamsMethodInvocationHistoryCollection.Add(new RefOutWithParamsMethodInvocationHistory(arguments, result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _refOutWithParamsMethodInvocationHistoryCollection.Add(new RefOutWithParamsMethodInvocationHistory(arguments, default, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IRefOutWithParamsMethodImposterBuilder, IRefOutWithParamsMethodInvocationImposterGroupContinuation
            {
                private readonly RefOutWithParamsMethodImposter _imposter;
                private readonly RefOutWithParamsMethodInvocationHistoryCollection _refOutWithParamsMethodInvocationHistoryCollection;
                private readonly RefOutWithParamsArgumentsCriteria _argumentsCriteria;
                private readonly RefOutWithParamsMethodInvocationImposterGroup _invocationImposterGroup;
                private RefOutWithParamsMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(RefOutWithParamsMethodImposter _imposter, RefOutWithParamsMethodInvocationHistoryCollection _refOutWithParamsMethodInvocationHistoryCollection, RefOutWithParamsArgumentsCriteria _argumentsCriteria)
                {
                    this._imposter = _imposter;
                    this._refOutWithParamsMethodInvocationHistoryCollection = _refOutWithParamsMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new RefOutWithParamsMethodInvocationImposterGroup(_argumentsCriteria);
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IRefOutWithParamsMethodInvocationImposterGroupContinuation IRefOutWithParamsMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((ref int seed, out int doubled, int[] adjustments) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IRefOutWithParamsMethodInvocationImposterGroupContinuation IRefOutWithParamsMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((ref int seed, out int doubled, int[] adjustments) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IRefOutWithParamsMethodInvocationImposterGroupContinuation IRefOutWithParamsMethodInvocationImposterGroup.Throws(RefOutWithParamsExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((ref int seed, out int doubled, int[] adjustments) =>
                    {
                        throw exceptionGenerator.Invoke(ref seed, out doubled, adjustments);
                    });
                    return this;
                }

                IRefOutWithParamsMethodInvocationImposterGroupContinuation IRefOutWithParamsMethodInvocationImposterGroupCallback.Callback(RefOutWithParamsCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IRefOutWithParamsMethodInvocationImposterGroupContinuation IRefOutWithParamsMethodInvocationImposterGroup.Returns(RefOutWithParamsDelegate resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                IRefOutWithParamsMethodInvocationImposterGroupContinuation IRefOutWithParamsMethodInvocationImposterGroup.Returns(int value)
                {
                    _currentInvocationImposter.Returns(value);
                    return this;
                }

                IRefOutWithParamsMethodInvocationImposterGroupContinuation IRefOutWithParamsMethodInvocationImposterGroup.UseBaseImplementation()
                {
                    _currentInvocationImposter.UseBaseImplementation();
                    return this;
                }

                IRefOutWithParamsMethodInvocationImposterGroup IRefOutWithParamsMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void RefOutWithParamsInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _refOutWithParamsMethodInvocationHistoryCollection.Count(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        // virtual Task<int> MethodSetupFeatureClassSut.SumAsync(int left, int right)
        public delegate global::System.Threading.Tasks.Task<int> SumAsyncDelegate(int left, int right);
        // virtual Task<int> MethodSetupFeatureClassSut.SumAsync(int left, int right)
        public delegate global::System.Threading.Tasks.Task SumAsyncCallbackDelegate(int left, int right);
        // virtual Task<int> MethodSetupFeatureClassSut.SumAsync(int left, int right)
        public delegate global::System.Exception SumAsyncExceptionGeneratorDelegate(int left, int right);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class SumAsyncArguments
        {
            public int left;
            public int right;
            internal SumAsyncArguments(int left, int right)
            {
                this.left = left;
                this.right = right;
            }
        }

        // virtual Task<int> MethodSetupFeatureClassSut.SumAsync(int left, int right)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class SumAsyncArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<int> left { get; }
            public global::Imposter.Abstractions.Arg<int> right { get; }

            public SumAsyncArgumentsCriteria(global::Imposter.Abstractions.Arg<int> left, global::Imposter.Abstractions.Arg<int> right)
            {
                this.left = left;
                this.right = right;
            }

            public bool Matches(SumAsyncArguments arguments)
            {
                return left.Matches(arguments.left) && right.Matches(arguments.right);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ISumAsyncMethodInvocationHistory
        {
            bool Matches(SumAsyncArgumentsCriteria criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class SumAsyncMethodInvocationHistory : ISumAsyncMethodInvocationHistory
        {
            internal SumAsyncArguments Arguments;
            internal global::System.Threading.Tasks.Task<int> Result;
            internal global::System.Exception Exception;
            public SumAsyncMethodInvocationHistory(SumAsyncArguments Arguments, global::System.Threading.Tasks.Task<int> Result, global::System.Exception Exception)
            {
                this.Arguments = Arguments;
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches(SumAsyncArgumentsCriteria criteria)
            {
                return criteria.Matches(Arguments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class SumAsyncMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<ISumAsyncMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<ISumAsyncMethodInvocationHistory>();
            internal void Add(ISumAsyncMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count(SumAsyncArgumentsCriteria argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches(argumentsCriteria));
            }
        }

        // virtual Task<int> MethodSetupFeatureClassSut.SumAsync(int left, int right)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class SumAsyncMethodInvocationImposterGroup
        {
            internal static SumAsyncMethodInvocationImposterGroup Default = new SumAsyncMethodInvocationImposterGroup(new SumAsyncArgumentsCriteria(global::Imposter.Abstractions.Arg<int>.Any(), global::Imposter.Abstractions.Arg<int>.Any()));
            internal SumAsyncArgumentsCriteria ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter _lastestInvocationImposter;
            public SumAsyncMethodInvocationImposterGroup(SumAsyncArgumentsCriteria argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                MethodInvocationImposter invocationImposter;
                if (_invocationImposters.TryDequeue(out invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public global::System.Threading.Tasks.Task<int> Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, int left, int right, SumAsyncDelegate baseImplementation = null)
            {
                MethodInvocationImposter invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName, left, right, baseImplementation);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private SumAsyncDelegate _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<SumAsyncCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<SumAsyncCallbackDelegate>();
                private bool _useBaseImplementation;
                internal bool IsEmpty => !_useBaseImplementation && ((_resultGenerator == null) && (_callbacks.Count == 0));

                public global::System.Threading.Tasks.Task<int> Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, int left, int right, SumAsyncDelegate baseImplementation = null)
                {
                    if (_useBaseImplementation)
                    {
                        _resultGenerator = baseImplementation ?? throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    global::System.Threading.Tasks.Task<int> result = _resultGenerator.Invoke(left, right);
                    foreach (var callback in _callbacks)
                    {
                        callback(left, right);
                    }

                    return result;
                }

                internal void Callback(SumAsyncCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(SumAsyncDelegate resultGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(global::System.Threading.Tasks.Task<int> value)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (int left, int right) =>
                    {
                        return value;
                    };
                }

                internal void ReturnsAsync(int value)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (int left, int right) =>
                    {
                        return global::System.Threading.Tasks.Task.FromResult(value);
                    };
                }

                internal void Throws(SumAsyncExceptionGeneratorDelegate exceptionGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (int left, int right) =>
                    {
                        throw exceptionGenerator(left, right);
                    };
                }

                internal void ThrowsAsync(global::System.Exception exception)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (int left, int right) =>
                    {
                        return global::System.Threading.Tasks.Task.FromException<int>(exception);
                    };
                }

                internal void UseBaseImplementation()
                {
                    _useBaseImplementation = true;
                    _resultGenerator = null;
                }

                internal static async global::System.Threading.Tasks.Task<int> DefaultResultGenerator(int left, int right)
                {
                    return default;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ISumAsyncMethodInvocationImposterGroupCallback
        {
            ISumAsyncMethodInvocationImposterGroupContinuation Callback(SumAsyncCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ISumAsyncMethodInvocationImposterGroupContinuation : ISumAsyncMethodInvocationImposterGroupCallback
        {
            ISumAsyncMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ISumAsyncMethodInvocationImposterGroup : ISumAsyncMethodInvocationImposterGroupCallback
        {
            ISumAsyncMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            ISumAsyncMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            ISumAsyncMethodInvocationImposterGroupContinuation Throws(SumAsyncExceptionGeneratorDelegate exceptionGenerator);
            ISumAsyncMethodInvocationImposterGroupContinuation Returns(SumAsyncDelegate resultGenerator);
            ISumAsyncMethodInvocationImposterGroupContinuation Returns(global::System.Threading.Tasks.Task<int> value);
            ISumAsyncMethodInvocationImposterGroupContinuation ReturnsAsync(int value);
            ISumAsyncMethodInvocationImposterGroupContinuation ThrowsAsync(global::System.Exception exception);
            ISumAsyncMethodInvocationImposterGroupContinuation UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface SumAsyncInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        // virtual Task<int> MethodSetupFeatureClassSut.SumAsync(int left, int right)
        public interface ISumAsyncMethodImposterBuilder : ISumAsyncMethodInvocationImposterGroup, ISumAsyncMethodInvocationImposterGroupCallback, SumAsyncInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class SumAsyncMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<SumAsyncMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<SumAsyncMethodInvocationImposterGroup>();
            private readonly SumAsyncMethodInvocationHistoryCollection _sumAsyncMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public SumAsyncMethodImposter(SumAsyncMethodInvocationHistoryCollection _sumAsyncMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._sumAsyncMethodInvocationHistoryCollection = _sumAsyncMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup(SumAsyncArguments arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private SumAsyncMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup(SumAsyncArguments arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public global::System.Threading.Tasks.Task<int> Invoke(int left, int right, SumAsyncDelegate baseImplementation = null)
            {
                var arguments = new SumAsyncArguments(left, right);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("virtual Task<int> MethodSetupFeatureClassSut.SumAsync(int left, int right)");
                    }

                    matchingInvocationImposterGroup = SumAsyncMethodInvocationImposterGroup.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "virtual Task<int> MethodSetupFeatureClassSut.SumAsync(int left, int right)", left, right, baseImplementation);
                    _sumAsyncMethodInvocationHistoryCollection.Add(new SumAsyncMethodInvocationHistory(arguments, result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _sumAsyncMethodInvocationHistoryCollection.Add(new SumAsyncMethodInvocationHistory(arguments, default, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : ISumAsyncMethodImposterBuilder, ISumAsyncMethodInvocationImposterGroupContinuation
            {
                private readonly SumAsyncMethodImposter _imposter;
                private readonly SumAsyncMethodInvocationHistoryCollection _sumAsyncMethodInvocationHistoryCollection;
                private readonly SumAsyncArgumentsCriteria _argumentsCriteria;
                private readonly SumAsyncMethodInvocationImposterGroup _invocationImposterGroup;
                private SumAsyncMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(SumAsyncMethodImposter _imposter, SumAsyncMethodInvocationHistoryCollection _sumAsyncMethodInvocationHistoryCollection, SumAsyncArgumentsCriteria _argumentsCriteria)
                {
                    this._imposter = _imposter;
                    this._sumAsyncMethodInvocationHistoryCollection = _sumAsyncMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new SumAsyncMethodInvocationImposterGroup(_argumentsCriteria);
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                ISumAsyncMethodInvocationImposterGroupContinuation ISumAsyncMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((int left, int right) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                ISumAsyncMethodInvocationImposterGroupContinuation ISumAsyncMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((int left, int right) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                ISumAsyncMethodInvocationImposterGroupContinuation ISumAsyncMethodInvocationImposterGroup.Throws(SumAsyncExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((int left, int right) =>
                    {
                        throw exceptionGenerator.Invoke(left, right);
                    });
                    return this;
                }

                ISumAsyncMethodInvocationImposterGroupContinuation ISumAsyncMethodInvocationImposterGroupCallback.Callback(SumAsyncCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                ISumAsyncMethodInvocationImposterGroupContinuation ISumAsyncMethodInvocationImposterGroup.Returns(SumAsyncDelegate resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                ISumAsyncMethodInvocationImposterGroupContinuation ISumAsyncMethodInvocationImposterGroup.Returns(global::System.Threading.Tasks.Task<int> value)
                {
                    _currentInvocationImposter.Returns(value);
                    return this;
                }

                ISumAsyncMethodInvocationImposterGroupContinuation ISumAsyncMethodInvocationImposterGroup.ReturnsAsync(int value)
                {
                    _currentInvocationImposter.ReturnsAsync(value);
                    return this;
                }

                ISumAsyncMethodInvocationImposterGroupContinuation ISumAsyncMethodInvocationImposterGroup.ThrowsAsync(global::System.Exception exception)
                {
                    _currentInvocationImposter.ThrowsAsync(exception);
                    return this;
                }

                ISumAsyncMethodInvocationImposterGroupContinuation ISumAsyncMethodInvocationImposterGroup.UseBaseImplementation()
                {
                    _currentInvocationImposter.UseBaseImplementation();
                    return this;
                }

                ISumAsyncMethodInvocationImposterGroup ISumAsyncMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void SumAsyncInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _sumAsyncMethodInvocationHistoryCollection.Count(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        // virtual int MethodSetupFeatureClassSut.ThrowingCalculation(int value)
        public delegate int ThrowingCalculationDelegate(int value);
        // virtual int MethodSetupFeatureClassSut.ThrowingCalculation(int value)
        public delegate void ThrowingCalculationCallbackDelegate(int value);
        // virtual int MethodSetupFeatureClassSut.ThrowingCalculation(int value)
        public delegate global::System.Exception ThrowingCalculationExceptionGeneratorDelegate(int value);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class ThrowingCalculationArguments
        {
            public int value;
            internal ThrowingCalculationArguments(int value)
            {
                this.value = value;
            }
        }

        // virtual int MethodSetupFeatureClassSut.ThrowingCalculation(int value)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class ThrowingCalculationArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<int> value { get; }

            public ThrowingCalculationArgumentsCriteria(global::Imposter.Abstractions.Arg<int> value)
            {
                this.value = value;
            }

            public bool Matches(ThrowingCalculationArguments arguments)
            {
                return value.Matches(arguments.value);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IThrowingCalculationMethodInvocationHistory
        {
            bool Matches(ThrowingCalculationArgumentsCriteria criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ThrowingCalculationMethodInvocationHistory : IThrowingCalculationMethodInvocationHistory
        {
            internal ThrowingCalculationArguments Arguments;
            internal int Result;
            internal global::System.Exception Exception;
            public ThrowingCalculationMethodInvocationHistory(ThrowingCalculationArguments Arguments, int Result, global::System.Exception Exception)
            {
                this.Arguments = Arguments;
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches(ThrowingCalculationArgumentsCriteria criteria)
            {
                return criteria.Matches(Arguments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ThrowingCalculationMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IThrowingCalculationMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IThrowingCalculationMethodInvocationHistory>();
            internal void Add(IThrowingCalculationMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count(ThrowingCalculationArgumentsCriteria argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches(argumentsCriteria));
            }
        }

        // virtual int MethodSetupFeatureClassSut.ThrowingCalculation(int value)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class ThrowingCalculationMethodInvocationImposterGroup
        {
            internal static ThrowingCalculationMethodInvocationImposterGroup Default = new ThrowingCalculationMethodInvocationImposterGroup(new ThrowingCalculationArgumentsCriteria(global::Imposter.Abstractions.Arg<int>.Any()));
            internal ThrowingCalculationArgumentsCriteria ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter _lastestInvocationImposter;
            public ThrowingCalculationMethodInvocationImposterGroup(ThrowingCalculationArgumentsCriteria argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                MethodInvocationImposter invocationImposter;
                if (_invocationImposters.TryDequeue(out invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public int Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, int value, ThrowingCalculationDelegate baseImplementation = null)
            {
                MethodInvocationImposter invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName, value, baseImplementation);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private ThrowingCalculationDelegate _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<ThrowingCalculationCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<ThrowingCalculationCallbackDelegate>();
                private bool _useBaseImplementation;
                internal bool IsEmpty => !_useBaseImplementation && ((_resultGenerator == null) && (_callbacks.Count == 0));

                public int Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, int value, ThrowingCalculationDelegate baseImplementation = null)
                {
                    if (_useBaseImplementation)
                    {
                        _resultGenerator = baseImplementation ?? throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    int result = _resultGenerator.Invoke(value);
                    foreach (var callback in _callbacks)
                    {
                        callback(value);
                    }

                    return result;
                }

                internal void Callback(ThrowingCalculationCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(ThrowingCalculationDelegate resultGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(int value_1)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (int value) =>
                    {
                        return value_1;
                    };
                }

                internal void Throws(ThrowingCalculationExceptionGeneratorDelegate exceptionGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (int value) =>
                    {
                        throw exceptionGenerator(value);
                    };
                }

                internal void UseBaseImplementation()
                {
                    _useBaseImplementation = true;
                    _resultGenerator = null;
                }

                internal static int DefaultResultGenerator(int value)
                {
                    return default;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IThrowingCalculationMethodInvocationImposterGroupCallback
        {
            IThrowingCalculationMethodInvocationImposterGroupContinuation Callback(ThrowingCalculationCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IThrowingCalculationMethodInvocationImposterGroupContinuation : IThrowingCalculationMethodInvocationImposterGroupCallback
        {
            IThrowingCalculationMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IThrowingCalculationMethodInvocationImposterGroup : IThrowingCalculationMethodInvocationImposterGroupCallback
        {
            IThrowingCalculationMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            IThrowingCalculationMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            IThrowingCalculationMethodInvocationImposterGroupContinuation Throws(ThrowingCalculationExceptionGeneratorDelegate exceptionGenerator);
            IThrowingCalculationMethodInvocationImposterGroupContinuation Returns(ThrowingCalculationDelegate resultGenerator);
            IThrowingCalculationMethodInvocationImposterGroupContinuation Returns(int value);
            IThrowingCalculationMethodInvocationImposterGroupContinuation UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ThrowingCalculationInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        // virtual int MethodSetupFeatureClassSut.ThrowingCalculation(int value)
        public interface IThrowingCalculationMethodImposterBuilder : IThrowingCalculationMethodInvocationImposterGroup, IThrowingCalculationMethodInvocationImposterGroupCallback, ThrowingCalculationInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ThrowingCalculationMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<ThrowingCalculationMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<ThrowingCalculationMethodInvocationImposterGroup>();
            private readonly ThrowingCalculationMethodInvocationHistoryCollection _throwingCalculationMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public ThrowingCalculationMethodImposter(ThrowingCalculationMethodInvocationHistoryCollection _throwingCalculationMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._throwingCalculationMethodInvocationHistoryCollection = _throwingCalculationMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup(ThrowingCalculationArguments arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private ThrowingCalculationMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup(ThrowingCalculationArguments arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public int Invoke(int value, ThrowingCalculationDelegate baseImplementation = null)
            {
                var arguments = new ThrowingCalculationArguments(value);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("virtual int MethodSetupFeatureClassSut.ThrowingCalculation(int value)");
                    }

                    matchingInvocationImposterGroup = ThrowingCalculationMethodInvocationImposterGroup.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "virtual int MethodSetupFeatureClassSut.ThrowingCalculation(int value)", value, baseImplementation);
                    _throwingCalculationMethodInvocationHistoryCollection.Add(new ThrowingCalculationMethodInvocationHistory(arguments, result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _throwingCalculationMethodInvocationHistoryCollection.Add(new ThrowingCalculationMethodInvocationHistory(arguments, default, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IThrowingCalculationMethodImposterBuilder, IThrowingCalculationMethodInvocationImposterGroupContinuation
            {
                private readonly ThrowingCalculationMethodImposter _imposter;
                private readonly ThrowingCalculationMethodInvocationHistoryCollection _throwingCalculationMethodInvocationHistoryCollection;
                private readonly ThrowingCalculationArgumentsCriteria _argumentsCriteria;
                private readonly ThrowingCalculationMethodInvocationImposterGroup _invocationImposterGroup;
                private ThrowingCalculationMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(ThrowingCalculationMethodImposter _imposter, ThrowingCalculationMethodInvocationHistoryCollection _throwingCalculationMethodInvocationHistoryCollection, ThrowingCalculationArgumentsCriteria _argumentsCriteria)
                {
                    this._imposter = _imposter;
                    this._throwingCalculationMethodInvocationHistoryCollection = _throwingCalculationMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new ThrowingCalculationMethodInvocationImposterGroup(_argumentsCriteria);
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IThrowingCalculationMethodInvocationImposterGroupContinuation IThrowingCalculationMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((int value) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IThrowingCalculationMethodInvocationImposterGroupContinuation IThrowingCalculationMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((int value) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IThrowingCalculationMethodInvocationImposterGroupContinuation IThrowingCalculationMethodInvocationImposterGroup.Throws(ThrowingCalculationExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((int value) =>
                    {
                        throw exceptionGenerator.Invoke(value);
                    });
                    return this;
                }

                IThrowingCalculationMethodInvocationImposterGroupContinuation IThrowingCalculationMethodInvocationImposterGroupCallback.Callback(ThrowingCalculationCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IThrowingCalculationMethodInvocationImposterGroupContinuation IThrowingCalculationMethodInvocationImposterGroup.Returns(ThrowingCalculationDelegate resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                IThrowingCalculationMethodInvocationImposterGroupContinuation IThrowingCalculationMethodInvocationImposterGroup.Returns(int value_1)
                {
                    _currentInvocationImposter.Returns(value_1);
                    return this;
                }

                IThrowingCalculationMethodInvocationImposterGroupContinuation IThrowingCalculationMethodInvocationImposterGroup.UseBaseImplementation()
                {
                    _currentInvocationImposter.UseBaseImplementation();
                    return this;
                }

                IThrowingCalculationMethodInvocationImposterGroup IThrowingCalculationMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void ThrowingCalculationInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _throwingCalculationMethodInvocationHistoryCollection.Count(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        // virtual void MethodSetupFeatureClassSut.VoidWithSideEffect(int delta)
        public delegate void VoidWithSideEffectDelegate(int delta);
        // virtual void MethodSetupFeatureClassSut.VoidWithSideEffect(int delta)
        public delegate void VoidWithSideEffectCallbackDelegate(int delta);
        // virtual void MethodSetupFeatureClassSut.VoidWithSideEffect(int delta)
        public delegate global::System.Exception VoidWithSideEffectExceptionGeneratorDelegate(int delta);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class VoidWithSideEffectArguments
        {
            public int delta;
            internal VoidWithSideEffectArguments(int delta)
            {
                this.delta = delta;
            }
        }

        // virtual void MethodSetupFeatureClassSut.VoidWithSideEffect(int delta)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class VoidWithSideEffectArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<int> delta { get; }

            public VoidWithSideEffectArgumentsCriteria(global::Imposter.Abstractions.Arg<int> delta)
            {
                this.delta = delta;
            }

            public bool Matches(VoidWithSideEffectArguments arguments)
            {
                return delta.Matches(arguments.delta);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IVoidWithSideEffectMethodInvocationHistory
        {
            bool Matches(VoidWithSideEffectArgumentsCriteria criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class VoidWithSideEffectMethodInvocationHistory : IVoidWithSideEffectMethodInvocationHistory
        {
            internal VoidWithSideEffectArguments Arguments;
            internal global::System.Exception Exception;
            public VoidWithSideEffectMethodInvocationHistory(VoidWithSideEffectArguments Arguments, global::System.Exception Exception)
            {
                this.Arguments = Arguments;
                this.Exception = Exception;
            }

            public bool Matches(VoidWithSideEffectArgumentsCriteria criteria)
            {
                return criteria.Matches(Arguments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class VoidWithSideEffectMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IVoidWithSideEffectMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IVoidWithSideEffectMethodInvocationHistory>();
            internal void Add(IVoidWithSideEffectMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count(VoidWithSideEffectArgumentsCriteria argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches(argumentsCriteria));
            }
        }

        // virtual void MethodSetupFeatureClassSut.VoidWithSideEffect(int delta)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class VoidWithSideEffectMethodInvocationImposterGroup
        {
            internal static VoidWithSideEffectMethodInvocationImposterGroup Default = new VoidWithSideEffectMethodInvocationImposterGroup(new VoidWithSideEffectArgumentsCriteria(global::Imposter.Abstractions.Arg<int>.Any()));
            internal VoidWithSideEffectArgumentsCriteria ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter _lastestInvocationImposter;
            public VoidWithSideEffectMethodInvocationImposterGroup(VoidWithSideEffectArgumentsCriteria argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                MethodInvocationImposter invocationImposter;
                if (_invocationImposters.TryDequeue(out invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public void Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, int delta, VoidWithSideEffectDelegate baseImplementation = null)
            {
                MethodInvocationImposter invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                invocationImposter.Invoke(invocationBehavior, methodDisplayName, delta, baseImplementation);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default._resultGenerator = DefaultResultGenerator;
                }

                private VoidWithSideEffectDelegate _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<VoidWithSideEffectCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<VoidWithSideEffectCallbackDelegate>();
                private bool _useBaseImplementation;
                internal bool IsEmpty => !_useBaseImplementation && ((_resultGenerator == null) && (_callbacks.Count == 0));

                public void Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, int delta, VoidWithSideEffectDelegate baseImplementation = null)
                {
                    if (_useBaseImplementation)
                    {
                        _resultGenerator = baseImplementation ?? throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    _resultGenerator.Invoke(delta);
                    foreach (var callback in _callbacks)
                    {
                        callback(delta);
                    }
                }

                internal void Callback(VoidWithSideEffectCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Throws(VoidWithSideEffectExceptionGeneratorDelegate exceptionGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (int delta) =>
                    {
                        throw exceptionGenerator(delta);
                    };
                }

                internal void UseBaseImplementation()
                {
                    _useBaseImplementation = true;
                    _resultGenerator = null;
                }

                internal static void DefaultResultGenerator(int delta)
                {
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IVoidWithSideEffectMethodInvocationImposterGroupCallback
        {
            IVoidWithSideEffectMethodInvocationImposterGroupContinuation Callback(VoidWithSideEffectCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IVoidWithSideEffectMethodInvocationImposterGroupContinuation : IVoidWithSideEffectMethodInvocationImposterGroupCallback
        {
            IVoidWithSideEffectMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IVoidWithSideEffectMethodInvocationImposterGroup : IVoidWithSideEffectMethodInvocationImposterGroupCallback
        {
            IVoidWithSideEffectMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            IVoidWithSideEffectMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            IVoidWithSideEffectMethodInvocationImposterGroupContinuation Throws(VoidWithSideEffectExceptionGeneratorDelegate exceptionGenerator);
            IVoidWithSideEffectMethodInvocationImposterGroupContinuation UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface VoidWithSideEffectInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        // virtual void MethodSetupFeatureClassSut.VoidWithSideEffect(int delta)
        public interface IVoidWithSideEffectMethodImposterBuilder : IVoidWithSideEffectMethodInvocationImposterGroup, IVoidWithSideEffectMethodInvocationImposterGroupCallback, VoidWithSideEffectInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class VoidWithSideEffectMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<VoidWithSideEffectMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<VoidWithSideEffectMethodInvocationImposterGroup>();
            private readonly VoidWithSideEffectMethodInvocationHistoryCollection _voidWithSideEffectMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public VoidWithSideEffectMethodImposter(VoidWithSideEffectMethodInvocationHistoryCollection _voidWithSideEffectMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._voidWithSideEffectMethodInvocationHistoryCollection = _voidWithSideEffectMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup(VoidWithSideEffectArguments arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private VoidWithSideEffectMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup(VoidWithSideEffectArguments arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public void Invoke(int delta, VoidWithSideEffectDelegate baseImplementation = null)
            {
                var arguments = new VoidWithSideEffectArguments(delta);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("virtual void MethodSetupFeatureClassSut.VoidWithSideEffect(int delta)");
                    }

                    matchingInvocationImposterGroup = VoidWithSideEffectMethodInvocationImposterGroup.Default;
                }

                try
                {
                    matchingInvocationImposterGroup.Invoke(_invocationBehavior, "virtual void MethodSetupFeatureClassSut.VoidWithSideEffect(int delta)", delta, baseImplementation);
                    _voidWithSideEffectMethodInvocationHistoryCollection.Add(new VoidWithSideEffectMethodInvocationHistory(arguments, default));
                }
                catch (global::System.Exception ex)
                {
                    _voidWithSideEffectMethodInvocationHistoryCollection.Add(new VoidWithSideEffectMethodInvocationHistory(arguments, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IVoidWithSideEffectMethodImposterBuilder, IVoidWithSideEffectMethodInvocationImposterGroupContinuation
            {
                private readonly VoidWithSideEffectMethodImposter _imposter;
                private readonly VoidWithSideEffectMethodInvocationHistoryCollection _voidWithSideEffectMethodInvocationHistoryCollection;
                private readonly VoidWithSideEffectArgumentsCriteria _argumentsCriteria;
                private readonly VoidWithSideEffectMethodInvocationImposterGroup _invocationImposterGroup;
                private VoidWithSideEffectMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(VoidWithSideEffectMethodImposter _imposter, VoidWithSideEffectMethodInvocationHistoryCollection _voidWithSideEffectMethodInvocationHistoryCollection, VoidWithSideEffectArgumentsCriteria _argumentsCriteria)
                {
                    this._imposter = _imposter;
                    this._voidWithSideEffectMethodInvocationHistoryCollection = _voidWithSideEffectMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new VoidWithSideEffectMethodInvocationImposterGroup(_argumentsCriteria);
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IVoidWithSideEffectMethodInvocationImposterGroupContinuation IVoidWithSideEffectMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((int delta) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IVoidWithSideEffectMethodInvocationImposterGroupContinuation IVoidWithSideEffectMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((int delta) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IVoidWithSideEffectMethodInvocationImposterGroupContinuation IVoidWithSideEffectMethodInvocationImposterGroup.Throws(VoidWithSideEffectExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((int delta) =>
                    {
                        throw exceptionGenerator.Invoke(delta);
                    });
                    return this;
                }

                IVoidWithSideEffectMethodInvocationImposterGroupContinuation IVoidWithSideEffectMethodInvocationImposterGroupCallback.Callback(VoidWithSideEffectCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IVoidWithSideEffectMethodInvocationImposterGroupContinuation IVoidWithSideEffectMethodInvocationImposterGroup.UseBaseImplementation()
                {
                    _currentInvocationImposter.UseBaseImplementation();
                    return this;
                }

                IVoidWithSideEffectMethodInvocationImposterGroup IVoidWithSideEffectMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void VoidWithSideEffectInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _voidWithSideEffectMethodInvocationHistoryCollection.Count(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        public MethodSetupFeatureClassSutImposter(global::Imposter.Abstractions.ImposterMode invocationBehavior = global::Imposter.Abstractions.ImposterMode.Implicit)
        {
            this._intSingleParamMethodImposter = new IntSingleParamMethodImposter(_intSingleParamMethodInvocationHistoryCollection, invocationBehavior);
            this._voidWithSideEffectMethodImposter = new VoidWithSideEffectMethodImposter(_voidWithSideEffectMethodInvocationHistoryCollection, invocationBehavior);
            this._sumAsyncMethodImposter = new SumAsyncMethodImposter(_sumAsyncMethodInvocationHistoryCollection, invocationBehavior);
            this._buildLabelAsyncMethodImposter = new BuildLabelAsyncMethodImposter(_buildLabelAsyncMethodInvocationHistoryCollection, invocationBehavior);
            this._refOutWithParamsMethodImposter = new RefOutWithParamsMethodImposter(_refOutWithParamsMethodInvocationHistoryCollection, invocationBehavior);
            this._throwingCalculationMethodImposter = new ThrowingCalculationMethodImposter(_throwingCalculationMethodInvocationHistoryCollection, invocationBehavior);
            this._imposterInstance = new ImposterTargetInstance();
            this._imposterInstance.InitializeImposter(this);
            this._invocationBehavior = invocationBehavior;
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class ImposterTargetInstance : global::Imposter.Tests.Features.MethodImposter.MethodSetupFeatureClassSut
        {
            MethodSetupFeatureClassSutImposter _imposter;
            internal void InitializeImposter(MethodSetupFeatureClassSutImposter imposter)
            {
                _imposter = imposter;
            }

            internal ImposterTargetInstance() : base()
            {
            }

            internal override int IntSingleParam(int age)
            {
                return _imposter._intSingleParamMethodImposter.Invoke(age, base.IntSingleParam);
            }

            internal override void VoidWithSideEffect(int delta)
            {
                _imposter._voidWithSideEffectMethodImposter.Invoke(delta, base.VoidWithSideEffect);
            }

            internal override global::System.Threading.Tasks.Task<int> SumAsync(int left, int right)
            {
                return _imposter._sumAsyncMethodImposter.Invoke(left, right, base.SumAsync);
            }

            internal override global::System.Threading.Tasks.ValueTask<string> BuildLabelAsync(string prefix, string suffix)
            {
                return _imposter._buildLabelAsyncMethodImposter.Invoke(prefix, suffix, base.BuildLabelAsync);
            }

            internal override int RefOutWithParams(ref int seed, out int doubled, int[] adjustments)
            {
                return _imposter._refOutWithParamsMethodImposter.Invoke(ref seed, out doubled, adjustments, base.RefOutWithParams);
            }

            internal override int ThrowingCalculation(int value)
            {
                return _imposter._throwingCalculationMethodImposter.Invoke(value, base.ThrowingCalculation);
            }
        }
    }
}
#pragma warning restore nullable
