// <auto-generated />
#nullable enable
using global::System;
using global::System.Linq;
using global::System.Collections.Generic;
using global::System.Threading.Tasks;
using global::System.Diagnostics;
using global::System.Runtime.CompilerServices;
using global::Imposter.Abstractions;
using global::System.Collections.Concurrent;
using global::Imposter.Tests.Features.OpenGenericImposter;

namespace Imposter.Tests.Features.OpenGenericImposter
{
    [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
    public sealed class IGenericConstraintsTargetImposter : global::Imposter.Abstractions.IHaveImposterInstance<global::Imposter.Tests.Features.OpenGenericImposter.IGenericConstraintsTarget>
    {
        private readonly HandleReferenceMethodImposterCollection _handleReferenceMethodImposterCollection;
        private readonly CloneStructMethodImposterCollection _cloneStructMethodImposterCollection;
        private readonly CompareValuesMethodImposterCollection _compareValuesMethodImposterCollection;
        private readonly CreateInstanceMethodImposterCollection _createInstanceMethodImposterCollection;
        private readonly HandleReferenceMethodInvocationHistoryCollection _handleReferenceMethodInvocationHistoryCollection = new HandleReferenceMethodInvocationHistoryCollection();
        private readonly CloneStructMethodInvocationHistoryCollection _cloneStructMethodInvocationHistoryCollection = new CloneStructMethodInvocationHistoryCollection();
        private readonly CompareValuesMethodInvocationHistoryCollection _compareValuesMethodInvocationHistoryCollection = new CompareValuesMethodInvocationHistoryCollection();
        private readonly CreateInstanceMethodInvocationHistoryCollection _createInstanceMethodInvocationHistoryCollection = new CreateInstanceMethodInvocationHistoryCollection();
        public IHandleReferenceMethodImposterBuilder<TArg> HandleReference<TArg>(global::Imposter.Abstractions.Arg<TArg> value)
        {
            return new HandleReferenceMethodImposter<TArg>.Builder(_handleReferenceMethodImposterCollection, _handleReferenceMethodInvocationHistoryCollection, new HandleReferenceArgumentsCriteria<TArg>(value));
        }

        public ICloneStructMethodImposterBuilder<TArg> CloneStruct<TArg>(global::Imposter.Abstractions.Arg<TArg> value)
        {
            return new CloneStructMethodImposter<TArg>.Builder(_cloneStructMethodImposterCollection, _cloneStructMethodInvocationHistoryCollection, new CloneStructArgumentsCriteria<TArg>(value));
        }

        public ICompareValuesMethodImposterBuilder<TArg> CompareValues<TArg>(global::Imposter.Abstractions.Arg<TArg> left, global::Imposter.Abstractions.Arg<TArg> right)
        {
            return new CompareValuesMethodImposter<TArg>.Builder(_compareValuesMethodImposterCollection, _compareValuesMethodInvocationHistoryCollection, new CompareValuesArgumentsCriteria<TArg>(left, right));
        }

        public ICreateInstanceMethodImposterBuilder<TArg> CreateInstance<TArg>()
        {
            return new CreateInstanceMethodImposter<TArg>.Builder(_createInstanceMethodImposterCollection, _createInstanceMethodInvocationHistoryCollection);
        }

        private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
        private ImposterTargetInstance _imposterInstance;
        global::Imposter.Tests.Features.OpenGenericImposter.IGenericConstraintsTarget global::Imposter.Abstractions.IHaveImposterInstance<global::Imposter.Tests.Features.OpenGenericImposter.IGenericConstraintsTarget>.Instance()
        {
            return _imposterInstance;
        }

        public delegate TArg CloneStructDelegate<TArg>(TArg value);
        public delegate void CloneStructCallbackDelegate<TArg>(TArg value);
        public delegate global::System.Exception CloneStructExceptionGeneratorDelegate<TArg>(TArg value);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class CloneStructArguments<TArg>
        {
            public TArg value;
            internal CloneStructArguments(TArg value)
            {
                this.value = value;
            }

            public CloneStructArguments<TArgTarget> As<TArgTarget>()
            {
                return new CloneStructArguments<TArgTarget>(TypeCaster.Cast<TArg, TArgTarget>(value));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class CloneStructArgumentsCriteria<TArg>
        {
            public global::Imposter.Abstractions.Arg<TArg> value { get; }

            public CloneStructArgumentsCriteria(global::Imposter.Abstractions.Arg<TArg> value)
            {
                this.value = value;
            }

            public bool Matches(CloneStructArguments<TArg> arguments)
            {
                return value.Matches(arguments.value);
            }

            public CloneStructArgumentsCriteria<TArgTarget> As<TArgTarget>()
            {
                return new CloneStructArgumentsCriteria<TArgTarget>(global::Imposter.Abstractions.Arg<TArgTarget>.Is(it => global::Imposter.Abstractions.TypeCaster.TryCast<TArgTarget, TArg>(it, out TArg valueTarget) && value.Matches(valueTarget)));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICloneStructMethodInvocationHistory
        {
            bool Matches<TArgTarget>(CloneStructArgumentsCriteria<TArgTarget> criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CloneStructMethodInvocationHistory<TArg> : ICloneStructMethodInvocationHistory
        {
            internal CloneStructArguments<TArg> Arguments;
            internal TArg? Result;
            internal global::System.Exception? Exception;
            public CloneStructMethodInvocationHistory(CloneStructArguments<TArg> Arguments, TArg? Result, global::System.Exception? Exception)
            {
                this.Arguments = Arguments;
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches<TArgTarget>(CloneStructArgumentsCriteria<TArgTarget> criteria)
            {
                return ((typeof(TArgTarget) == typeof(TArg)) && (typeof(TArg) == typeof(TArgTarget))) && criteria.As<TArg>().Matches(Arguments);
            }

            public override string ToString()
            {
                return "CloneStruct(" + global::System.String.Join(", ", new[] { "value: " + FormatValue(Arguments.value) }) + ")" + " => " + FormatValue(Result) + (Exception == null ? "" : " threw " + FormatValue(Exception));
            }

            private static string FormatValue(object? value)
            {
                return "<" + (value?.ToString() ?? "null") + ">";
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CloneStructMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<ICloneStructMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<ICloneStructMethodInvocationHistory>();
            internal void Add(ICloneStructMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count<TArg>(CloneStructArgumentsCriteria<TArg> argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches<TArg>(argumentsCriteria));
            }

            public override string ToString()
            {
                return string.Join(Environment.NewLine, _invocationHistory.Select(invocation => invocation.ToString()));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CloneStructMethodImposterCollection
        {
            private readonly CloneStructMethodInvocationHistoryCollection _cloneStructMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public CloneStructMethodImposterCollection(CloneStructMethodInvocationHistoryCollection _cloneStructMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._cloneStructMethodInvocationHistoryCollection = _cloneStructMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            private readonly global::System.Collections.Concurrent.ConcurrentStack<ICloneStructMethodImposter> _imposters = new global::System.Collections.Concurrent.ConcurrentStack<ICloneStructMethodImposter>();
            internal CloneStructMethodImposter<TArg> AddNew<TArg>()
            {
                var imposter = new CloneStructMethodImposter<TArg>(_cloneStructMethodInvocationHistoryCollection, _invocationBehavior);
                _imposters.Push(imposter);
                return imposter;
            }

            internal ICloneStructMethodImposter<TArg> GetImposterWithMatchingInvocationImposterGroup<TArg>(CloneStructArguments<TArg> arguments)
            {
                return _imposters.Select(it => it.As<TArg>()).Where(it => it != null).Select(it => it!).FirstOrDefault(it => it.HasMatchingInvocationImposterGroup(arguments)) ?? AddNew<TArg>();
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class CloneStructMethodInvocationImposterGroup<TArg>
        {
            internal static CloneStructMethodInvocationImposterGroup<TArg> Default = new CloneStructMethodInvocationImposterGroup<TArg>(new CloneStructArgumentsCriteria<TArg>(global::Imposter.Abstractions.Arg<TArg>.Any()));
            internal CloneStructArgumentsCriteria<TArg> ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public CloneStructMethodInvocationImposterGroup(CloneStructArgumentsCriteria<TArg> argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public TArg Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, TArg value)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName, value);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private CloneStructDelegate<TArg>? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<CloneStructCallbackDelegate<TArg>> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<CloneStructCallbackDelegate<TArg>>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public TArg Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, TArg value)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    TArg result = _resultGenerator.Invoke(value);
                    foreach (var callback in _callbacks)
                    {
                        callback(value);
                    }

                    return result;
                }

                internal void Callback(CloneStructCallbackDelegate<TArg> callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(CloneStructDelegate<TArg> resultGenerator)
                {
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(TArg value_1)
                {
                    _resultGenerator = (TArg value) =>
                    {
                        return value_1;
                    };
                }

                internal void Throws(CloneStructExceptionGeneratorDelegate<TArg> exceptionGenerator)
                {
                    _resultGenerator = (TArg value) =>
                    {
                        throw exceptionGenerator(value);
                    };
                }

                internal static TArg DefaultResultGenerator(TArg value)
                {
                    return default !;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICloneStructMethodInvocationImposterGroupCallback<TArg>
        {
            ICloneStructMethodInvocationImposterGroupContinuation<TArg> Callback(CloneStructCallbackDelegate<TArg> callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICloneStructMethodInvocationImposterGroupContinuation<TArg> : ICloneStructMethodInvocationImposterGroupCallback<TArg>
        {
            ICloneStructMethodInvocationImposterGroup<TArg> Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICloneStructMethodInvocationImposterGroup<TArg> : ICloneStructMethodInvocationImposterGroupCallback<TArg>
        {
            ICloneStructMethodInvocationImposterGroupContinuation<TArg> Throws<TException>()
                where TException : global::System.Exception, new();
            ICloneStructMethodInvocationImposterGroupContinuation<TArg> Throws(global::System.Exception exception);
            ICloneStructMethodInvocationImposterGroupContinuation<TArg> Throws(CloneStructExceptionGeneratorDelegate<TArg> exceptionGenerator);
            ICloneStructMethodInvocationImposterGroupContinuation<TArg> Returns(CloneStructDelegate<TArg> resultGenerator);
            ICloneStructMethodInvocationImposterGroupContinuation<TArg> Returns(TArg value);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface ICloneStructMethodImposter
        {
            ICloneStructMethodImposter<TArgTarget>? As<TArgTarget>();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface ICloneStructMethodImposter<TArg> : ICloneStructMethodImposter
        {
            TArg Invoke(TArg value);
            bool HasMatchingInvocationImposterGroup(CloneStructArguments<TArg> arguments);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface CloneStructInvocationVerifier<TArg>
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICloneStructMethodImposterBuilder<TArg> : ICloneStructMethodInvocationImposterGroup<TArg>, ICloneStructMethodInvocationImposterGroupCallback<TArg>, CloneStructInvocationVerifier<TArg>
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CloneStructMethodImposter<TArg> : ICloneStructMethodImposter<TArg>
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<CloneStructMethodInvocationImposterGroup<TArg>> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<CloneStructMethodInvocationImposterGroup<TArg>>();
            private readonly CloneStructMethodInvocationHistoryCollection _cloneStructMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public CloneStructMethodImposter(CloneStructMethodInvocationHistoryCollection _cloneStructMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._cloneStructMethodInvocationHistoryCollection = _cloneStructMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            ICloneStructMethodImposter<TArgTarget>? ICloneStructMethodImposter.As<TArgTarget>()
            {
                if (typeof(TArgTarget).IsAssignableTo(typeof(TArg)) && typeof(TArg).IsAssignableTo(typeof(TArgTarget)))
                {
                    return new Adapter<TArgTarget>(this);
                }

                return null;
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            private class Adapter<TArgTarget> : ICloneStructMethodImposter<TArgTarget>
            {
                private readonly CloneStructMethodImposter<TArg> _target;
                public Adapter(CloneStructMethodImposter<TArg> target)
                {
                    _target = target;
                }

                public TArgTarget Invoke(TArgTarget value)
                {
                    var result = _target.Invoke(global::Imposter.Abstractions.TypeCaster.Cast<TArgTarget, TArg>(value));
                    return global::Imposter.Abstractions.TypeCaster.Cast<TArg, TArgTarget>(result);
                }

                public bool HasMatchingInvocationImposterGroup(CloneStructArguments<TArgTarget> arguments)
                {
                    return _target.HasMatchingInvocationImposterGroup(arguments.As<TArg>());
                }

                ICloneStructMethodImposter<TArgTarget1>? ICloneStructMethodImposter.As<TArgTarget1>()
                {
                    throw new NotImplementedException();
                }
            }

            public bool HasMatchingInvocationImposterGroup(CloneStructArguments<TArg> arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private CloneStructMethodInvocationImposterGroup<TArg>? FindMatchingInvocationImposterGroup(CloneStructArguments<TArg> arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public TArg Invoke(TArg value)
            {
                var arguments = new CloneStructArguments<TArg>(value);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("TArg IGenericConstraintsTarget.CloneStruct<TArg>(TArg value)");
                    }

                    matchingInvocationImposterGroup = CloneStructMethodInvocationImposterGroup<TArg>.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "TArg IGenericConstraintsTarget.CloneStruct<TArg>(TArg value)", value);
                    _cloneStructMethodInvocationHistoryCollection.Add(new CloneStructMethodInvocationHistory<TArg>(arguments, result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _cloneStructMethodInvocationHistoryCollection.Add(new CloneStructMethodInvocationHistory<TArg>(arguments, default !, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : ICloneStructMethodImposterBuilder<TArg>, ICloneStructMethodInvocationImposterGroupContinuation<TArg>
            {
                private readonly CloneStructMethodImposterCollection _imposterCollection;
                private readonly CloneStructMethodInvocationHistoryCollection _cloneStructMethodInvocationHistoryCollection;
                private readonly CloneStructArgumentsCriteria<TArg> _argumentsCriteria;
                private readonly CloneStructMethodInvocationImposterGroup<TArg> _invocationImposterGroup;
                private CloneStructMethodInvocationImposterGroup<TArg>.MethodInvocationImposter _currentInvocationImposter;
                public Builder(CloneStructMethodImposterCollection _imposterCollection, CloneStructMethodInvocationHistoryCollection _cloneStructMethodInvocationHistoryCollection, CloneStructArgumentsCriteria<TArg> _argumentsCriteria)
                {
                    this._imposterCollection = _imposterCollection;
                    this._cloneStructMethodInvocationHistoryCollection = _cloneStructMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new CloneStructMethodInvocationImposterGroup<TArg>(_argumentsCriteria);
                    CloneStructMethodImposter<TArg> methodImposter = _imposterCollection.AddNew<TArg>();
                    methodImposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                ICloneStructMethodInvocationImposterGroupContinuation<TArg> ICloneStructMethodInvocationImposterGroup<TArg>.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((TArg value) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                ICloneStructMethodInvocationImposterGroupContinuation<TArg> ICloneStructMethodInvocationImposterGroup<TArg>.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((TArg value) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                ICloneStructMethodInvocationImposterGroupContinuation<TArg> ICloneStructMethodInvocationImposterGroup<TArg>.Throws(CloneStructExceptionGeneratorDelegate<TArg> exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((TArg value) =>
                    {
                        throw exceptionGenerator.Invoke(value);
                    });
                    return this;
                }

                ICloneStructMethodInvocationImposterGroupContinuation<TArg> ICloneStructMethodInvocationImposterGroupCallback<TArg>.Callback(CloneStructCallbackDelegate<TArg> callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                ICloneStructMethodInvocationImposterGroupContinuation<TArg> ICloneStructMethodInvocationImposterGroup<TArg>.Returns(CloneStructDelegate<TArg> resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                ICloneStructMethodInvocationImposterGroupContinuation<TArg> ICloneStructMethodInvocationImposterGroup<TArg>.Returns(TArg value_1)
                {
                    _currentInvocationImposter.Returns(value_1);
                    return this;
                }

                ICloneStructMethodInvocationImposterGroup<TArg> ICloneStructMethodInvocationImposterGroupContinuation<TArg>.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void CloneStructInvocationVerifier<TArg>.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _cloneStructMethodInvocationHistoryCollection.Count<TArg>(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount, _cloneStructMethodInvocationHistoryCollection.ToString());
                    }
                }
            }
        }

        public delegate void CompareValuesDelegate<TArg>(TArg left, TArg right);
        public delegate void CompareValuesCallbackDelegate<TArg>(TArg left, TArg right);
        public delegate global::System.Exception CompareValuesExceptionGeneratorDelegate<TArg>(TArg left, TArg right);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class CompareValuesArguments<TArg>
        {
            public TArg left;
            public TArg right;
            internal CompareValuesArguments(TArg left, TArg right)
            {
                this.left = left;
                this.right = right;
            }

            public CompareValuesArguments<TArgTarget> As<TArgTarget>()
            {
                return new CompareValuesArguments<TArgTarget>(TypeCaster.Cast<TArg, TArgTarget>(left), TypeCaster.Cast<TArg, TArgTarget>(right));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class CompareValuesArgumentsCriteria<TArg>
        {
            public global::Imposter.Abstractions.Arg<TArg> left { get; }
            public global::Imposter.Abstractions.Arg<TArg> right { get; }

            public CompareValuesArgumentsCriteria(global::Imposter.Abstractions.Arg<TArg> left, global::Imposter.Abstractions.Arg<TArg> right)
            {
                this.left = left;
                this.right = right;
            }

            public bool Matches(CompareValuesArguments<TArg> arguments)
            {
                return left.Matches(arguments.left) && right.Matches(arguments.right);
            }

            public CompareValuesArgumentsCriteria<TArgTarget> As<TArgTarget>()
            {
                return new CompareValuesArgumentsCriteria<TArgTarget>(global::Imposter.Abstractions.Arg<TArgTarget>.Is(it => global::Imposter.Abstractions.TypeCaster.TryCast<TArgTarget, TArg>(it, out TArg leftTarget) && left.Matches(leftTarget)), global::Imposter.Abstractions.Arg<TArgTarget>.Is(it => global::Imposter.Abstractions.TypeCaster.TryCast<TArgTarget, TArg>(it, out TArg rightTarget) && right.Matches(rightTarget)));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICompareValuesMethodInvocationHistory
        {
            bool Matches<TArgTarget>(CompareValuesArgumentsCriteria<TArgTarget> criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CompareValuesMethodInvocationHistory<TArg> : ICompareValuesMethodInvocationHistory
        {
            internal CompareValuesArguments<TArg> Arguments;
            internal global::System.Exception? Exception;
            public CompareValuesMethodInvocationHistory(CompareValuesArguments<TArg> Arguments, global::System.Exception? Exception)
            {
                this.Arguments = Arguments;
                this.Exception = Exception;
            }

            public bool Matches<TArgTarget>(CompareValuesArgumentsCriteria<TArgTarget> criteria)
            {
                return ((typeof(TArgTarget) == typeof(TArg)) && (typeof(TArgTarget) == typeof(TArg))) && criteria.As<TArg>().Matches(Arguments);
            }

            public override string ToString()
            {
                return "CompareValues(" + global::System.String.Join(", ", new[] { "left: " + FormatValue(Arguments.left), "right: " + FormatValue(Arguments.right) }) + ")" + (Exception == null ? "" : " threw " + FormatValue(Exception));
            }

            private static string FormatValue(object? value)
            {
                return "<" + (value?.ToString() ?? "null") + ">";
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CompareValuesMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<ICompareValuesMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<ICompareValuesMethodInvocationHistory>();
            internal void Add(ICompareValuesMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count<TArg>(CompareValuesArgumentsCriteria<TArg> argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches<TArg>(argumentsCriteria));
            }

            public override string ToString()
            {
                return string.Join(Environment.NewLine, _invocationHistory.Select(invocation => invocation.ToString()));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CompareValuesMethodImposterCollection
        {
            private readonly CompareValuesMethodInvocationHistoryCollection _compareValuesMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public CompareValuesMethodImposterCollection(CompareValuesMethodInvocationHistoryCollection _compareValuesMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._compareValuesMethodInvocationHistoryCollection = _compareValuesMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            private readonly global::System.Collections.Concurrent.ConcurrentStack<ICompareValuesMethodImposter> _imposters = new global::System.Collections.Concurrent.ConcurrentStack<ICompareValuesMethodImposter>();
            internal CompareValuesMethodImposter<TArg> AddNew<TArg>()
            {
                var imposter = new CompareValuesMethodImposter<TArg>(_compareValuesMethodInvocationHistoryCollection, _invocationBehavior);
                _imposters.Push(imposter);
                return imposter;
            }

            internal ICompareValuesMethodImposter<TArg> GetImposterWithMatchingInvocationImposterGroup<TArg>(CompareValuesArguments<TArg> arguments)
            {
                return _imposters.Select(it => it.As<TArg>()).Where(it => it != null).Select(it => it!).FirstOrDefault(it => it.HasMatchingInvocationImposterGroup(arguments)) ?? AddNew<TArg>();
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class CompareValuesMethodInvocationImposterGroup<TArg>
        {
            internal static CompareValuesMethodInvocationImposterGroup<TArg> Default = new CompareValuesMethodInvocationImposterGroup<TArg>(new CompareValuesArgumentsCriteria<TArg>(global::Imposter.Abstractions.Arg<TArg>.Any(), global::Imposter.Abstractions.Arg<TArg>.Any()));
            internal CompareValuesArgumentsCriteria<TArg> ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public CompareValuesMethodInvocationImposterGroup(CompareValuesArgumentsCriteria<TArg> argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public void Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, TArg left, TArg right)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                invocationImposter.Invoke(invocationBehavior, methodDisplayName, left, right);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default._resultGenerator = DefaultResultGenerator;
                }

                private CompareValuesDelegate<TArg>? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<CompareValuesCallbackDelegate<TArg>> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<CompareValuesCallbackDelegate<TArg>>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public void Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, TArg left, TArg right)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    _resultGenerator.Invoke(left, right);
                    foreach (var callback in _callbacks)
                    {
                        callback(left, right);
                    }
                }

                internal void Callback(CompareValuesCallbackDelegate<TArg> callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Throws(CompareValuesExceptionGeneratorDelegate<TArg> exceptionGenerator)
                {
                    _resultGenerator = (TArg left, TArg right) =>
                    {
                        throw exceptionGenerator(left, right);
                    };
                }

                internal static void DefaultResultGenerator(TArg left, TArg right)
                {
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICompareValuesMethodInvocationImposterGroupCallback<TArg>
        {
            ICompareValuesMethodInvocationImposterGroupContinuation<TArg> Callback(CompareValuesCallbackDelegate<TArg> callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICompareValuesMethodInvocationImposterGroupContinuation<TArg> : ICompareValuesMethodInvocationImposterGroupCallback<TArg>
        {
            ICompareValuesMethodInvocationImposterGroup<TArg> Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICompareValuesMethodInvocationImposterGroup<TArg> : ICompareValuesMethodInvocationImposterGroupCallback<TArg>
        {
            ICompareValuesMethodInvocationImposterGroupContinuation<TArg> Throws<TException>()
                where TException : global::System.Exception, new();
            ICompareValuesMethodInvocationImposterGroupContinuation<TArg> Throws(global::System.Exception exception);
            ICompareValuesMethodInvocationImposterGroupContinuation<TArg> Throws(CompareValuesExceptionGeneratorDelegate<TArg> exceptionGenerator);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface ICompareValuesMethodImposter
        {
            ICompareValuesMethodImposter<TArgTarget>? As<TArgTarget>();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface ICompareValuesMethodImposter<TArg> : ICompareValuesMethodImposter
        {
            void Invoke(TArg left, TArg right);
            bool HasMatchingInvocationImposterGroup(CompareValuesArguments<TArg> arguments);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface CompareValuesInvocationVerifier<TArg>
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICompareValuesMethodImposterBuilder<TArg> : ICompareValuesMethodInvocationImposterGroup<TArg>, ICompareValuesMethodInvocationImposterGroupCallback<TArg>, CompareValuesInvocationVerifier<TArg>
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CompareValuesMethodImposter<TArg> : ICompareValuesMethodImposter<TArg>
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<CompareValuesMethodInvocationImposterGroup<TArg>> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<CompareValuesMethodInvocationImposterGroup<TArg>>();
            private readonly CompareValuesMethodInvocationHistoryCollection _compareValuesMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public CompareValuesMethodImposter(CompareValuesMethodInvocationHistoryCollection _compareValuesMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._compareValuesMethodInvocationHistoryCollection = _compareValuesMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            ICompareValuesMethodImposter<TArgTarget>? ICompareValuesMethodImposter.As<TArgTarget>()
            {
                if (typeof(TArgTarget).IsAssignableTo(typeof(TArg)) && typeof(TArgTarget).IsAssignableTo(typeof(TArg)))
                {
                    return new Adapter<TArgTarget>(this);
                }

                return null;
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            private class Adapter<TArgTarget> : ICompareValuesMethodImposter<TArgTarget>
            {
                private readonly CompareValuesMethodImposter<TArg> _target;
                public Adapter(CompareValuesMethodImposter<TArg> target)
                {
                    _target = target;
                }

                public void Invoke(TArgTarget left, TArgTarget right)
                {
                    _target.Invoke(global::Imposter.Abstractions.TypeCaster.Cast<TArgTarget, TArg>(left), global::Imposter.Abstractions.TypeCaster.Cast<TArgTarget, TArg>(right));
                }

                public bool HasMatchingInvocationImposterGroup(CompareValuesArguments<TArgTarget> arguments)
                {
                    return _target.HasMatchingInvocationImposterGroup(arguments.As<TArg>());
                }

                ICompareValuesMethodImposter<TArgTarget1>? ICompareValuesMethodImposter.As<TArgTarget1>()
                {
                    throw new NotImplementedException();
                }
            }

            public bool HasMatchingInvocationImposterGroup(CompareValuesArguments<TArg> arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private CompareValuesMethodInvocationImposterGroup<TArg>? FindMatchingInvocationImposterGroup(CompareValuesArguments<TArg> arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public void Invoke(TArg left, TArg right)
            {
                var arguments = new CompareValuesArguments<TArg>(left, right);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("void IGenericConstraintsTarget.CompareValues<TArg>(TArg left, TArg right)");
                    }

                    matchingInvocationImposterGroup = CompareValuesMethodInvocationImposterGroup<TArg>.Default;
                }

                try
                {
                    matchingInvocationImposterGroup.Invoke(_invocationBehavior, "void IGenericConstraintsTarget.CompareValues<TArg>(TArg left, TArg right)", left, right);
                    _compareValuesMethodInvocationHistoryCollection.Add(new CompareValuesMethodInvocationHistory<TArg>(arguments, default));
                }
                catch (global::System.Exception ex)
                {
                    _compareValuesMethodInvocationHistoryCollection.Add(new CompareValuesMethodInvocationHistory<TArg>(arguments, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : ICompareValuesMethodImposterBuilder<TArg>, ICompareValuesMethodInvocationImposterGroupContinuation<TArg>
            {
                private readonly CompareValuesMethodImposterCollection _imposterCollection;
                private readonly CompareValuesMethodInvocationHistoryCollection _compareValuesMethodInvocationHistoryCollection;
                private readonly CompareValuesArgumentsCriteria<TArg> _argumentsCriteria;
                private readonly CompareValuesMethodInvocationImposterGroup<TArg> _invocationImposterGroup;
                private CompareValuesMethodInvocationImposterGroup<TArg>.MethodInvocationImposter _currentInvocationImposter;
                public Builder(CompareValuesMethodImposterCollection _imposterCollection, CompareValuesMethodInvocationHistoryCollection _compareValuesMethodInvocationHistoryCollection, CompareValuesArgumentsCriteria<TArg> _argumentsCriteria)
                {
                    this._imposterCollection = _imposterCollection;
                    this._compareValuesMethodInvocationHistoryCollection = _compareValuesMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new CompareValuesMethodInvocationImposterGroup<TArg>(_argumentsCriteria);
                    CompareValuesMethodImposter<TArg> methodImposter = _imposterCollection.AddNew<TArg>();
                    methodImposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                ICompareValuesMethodInvocationImposterGroupContinuation<TArg> ICompareValuesMethodInvocationImposterGroup<TArg>.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((TArg left, TArg right) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                ICompareValuesMethodInvocationImposterGroupContinuation<TArg> ICompareValuesMethodInvocationImposterGroup<TArg>.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((TArg left, TArg right) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                ICompareValuesMethodInvocationImposterGroupContinuation<TArg> ICompareValuesMethodInvocationImposterGroup<TArg>.Throws(CompareValuesExceptionGeneratorDelegate<TArg> exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((TArg left, TArg right) =>
                    {
                        throw exceptionGenerator.Invoke(left, right);
                    });
                    return this;
                }

                ICompareValuesMethodInvocationImposterGroupContinuation<TArg> ICompareValuesMethodInvocationImposterGroupCallback<TArg>.Callback(CompareValuesCallbackDelegate<TArg> callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                ICompareValuesMethodInvocationImposterGroup<TArg> ICompareValuesMethodInvocationImposterGroupContinuation<TArg>.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void CompareValuesInvocationVerifier<TArg>.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _compareValuesMethodInvocationHistoryCollection.Count<TArg>(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount, _compareValuesMethodInvocationHistoryCollection.ToString());
                    }
                }
            }
        }

        public delegate TArg CreateInstanceDelegate<TArg>();
        public delegate void CreateInstanceCallbackDelegate<TArg>();
        public delegate global::System.Exception CreateInstanceExceptionGeneratorDelegate<TArg>();
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICreateInstanceMethodInvocationHistory
        {
            bool Matches<TArgTarget>();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CreateInstanceMethodInvocationHistory<TArg> : ICreateInstanceMethodInvocationHistory
        {
            internal TArg? Result;
            internal global::System.Exception? Exception;
            public CreateInstanceMethodInvocationHistory(TArg? Result, global::System.Exception? Exception)
            {
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches<TArgTarget>()
            {
                return typeof(TArg) == typeof(TArgTarget);
            }

            public override string ToString()
            {
                return "CreateInstance(" + "" + ")" + " => " + FormatValue(Result) + (Exception == null ? "" : " threw " + FormatValue(Exception));
            }

            private static string FormatValue(object? value)
            {
                return "<" + (value?.ToString() ?? "null") + ">";
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CreateInstanceMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<ICreateInstanceMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<ICreateInstanceMethodInvocationHistory>();
            internal void Add(ICreateInstanceMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count<TArg>()
            {
                return _invocationHistory.Count(it => it.Matches<TArg>());
            }

            public override string ToString()
            {
                return string.Join(Environment.NewLine, _invocationHistory.Select(invocation => invocation.ToString()));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CreateInstanceMethodImposterCollection
        {
            private readonly CreateInstanceMethodInvocationHistoryCollection _createInstanceMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public CreateInstanceMethodImposterCollection(CreateInstanceMethodInvocationHistoryCollection _createInstanceMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._createInstanceMethodInvocationHistoryCollection = _createInstanceMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            private readonly global::System.Collections.Concurrent.ConcurrentStack<ICreateInstanceMethodImposter> _imposters = new global::System.Collections.Concurrent.ConcurrentStack<ICreateInstanceMethodImposter>();
            internal CreateInstanceMethodImposter<TArg> AddNew<TArg>()
            {
                var imposter = new CreateInstanceMethodImposter<TArg>(_createInstanceMethodInvocationHistoryCollection, _invocationBehavior);
                _imposters.Push(imposter);
                return imposter;
            }

            internal ICreateInstanceMethodImposter<TArg> GetImposterWithMatchingInvocationImposterGroup<TArg>()
            {
                return _imposters.Select(it => it.As<TArg>()).Where(it => it != null).Select(it => it!).FirstOrDefault(it => it.HasMatchingInvocationImposterGroup()) ?? AddNew<TArg>();
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class CreateInstanceMethodInvocationImposterGroup<TArg>
        {
            internal static CreateInstanceMethodInvocationImposterGroup<TArg> Default = new CreateInstanceMethodInvocationImposterGroup<TArg>();
            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public CreateInstanceMethodInvocationImposterGroup()
            {
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public TArg Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private CreateInstanceDelegate<TArg>? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<CreateInstanceCallbackDelegate<TArg>> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<CreateInstanceCallbackDelegate<TArg>>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public TArg Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    TArg result = _resultGenerator.Invoke();
                    foreach (var callback in _callbacks)
                    {
                        callback();
                    }

                    return result;
                }

                internal void Callback(CreateInstanceCallbackDelegate<TArg> callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(CreateInstanceDelegate<TArg> resultGenerator)
                {
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(TArg value)
                {
                    _resultGenerator = () =>
                    {
                        return value;
                    };
                }

                internal void Throws(CreateInstanceExceptionGeneratorDelegate<TArg> exceptionGenerator)
                {
                    _resultGenerator = () =>
                    {
                        throw exceptionGenerator();
                    };
                }

                internal static TArg DefaultResultGenerator()
                {
                    return default !;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICreateInstanceMethodInvocationImposterGroupCallback<TArg>
        {
            ICreateInstanceMethodInvocationImposterGroupContinuation<TArg> Callback(CreateInstanceCallbackDelegate<TArg> callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICreateInstanceMethodInvocationImposterGroupContinuation<TArg> : ICreateInstanceMethodInvocationImposterGroupCallback<TArg>
        {
            ICreateInstanceMethodInvocationImposterGroup<TArg> Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICreateInstanceMethodInvocationImposterGroup<TArg> : ICreateInstanceMethodInvocationImposterGroupCallback<TArg>
        {
            ICreateInstanceMethodInvocationImposterGroupContinuation<TArg> Throws<TException>()
                where TException : global::System.Exception, new();
            ICreateInstanceMethodInvocationImposterGroupContinuation<TArg> Throws(global::System.Exception exception);
            ICreateInstanceMethodInvocationImposterGroupContinuation<TArg> Throws(CreateInstanceExceptionGeneratorDelegate<TArg> exceptionGenerator);
            ICreateInstanceMethodInvocationImposterGroupContinuation<TArg> Returns(CreateInstanceDelegate<TArg> resultGenerator);
            ICreateInstanceMethodInvocationImposterGroupContinuation<TArg> Returns(TArg value);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface ICreateInstanceMethodImposter
        {
            ICreateInstanceMethodImposter<TArgTarget>? As<TArgTarget>();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface ICreateInstanceMethodImposter<TArg> : ICreateInstanceMethodImposter
        {
            TArg Invoke();
            bool HasMatchingInvocationImposterGroup();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface CreateInstanceInvocationVerifier<TArg>
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICreateInstanceMethodImposterBuilder<TArg> : ICreateInstanceMethodInvocationImposterGroup<TArg>, ICreateInstanceMethodInvocationImposterGroupCallback<TArg>, CreateInstanceInvocationVerifier<TArg>
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CreateInstanceMethodImposter<TArg> : ICreateInstanceMethodImposter<TArg>
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<CreateInstanceMethodInvocationImposterGroup<TArg>> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<CreateInstanceMethodInvocationImposterGroup<TArg>>();
            private readonly CreateInstanceMethodInvocationHistoryCollection _createInstanceMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public CreateInstanceMethodImposter(CreateInstanceMethodInvocationHistoryCollection _createInstanceMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._createInstanceMethodInvocationHistoryCollection = _createInstanceMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            ICreateInstanceMethodImposter<TArgTarget>? ICreateInstanceMethodImposter.As<TArgTarget>()
            {
                if (typeof(TArg).IsAssignableTo(typeof(TArgTarget)))
                {
                    return new Adapter<TArgTarget>(this);
                }

                return null;
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            private class Adapter<TArgTarget> : ICreateInstanceMethodImposter<TArgTarget>
            {
                private readonly CreateInstanceMethodImposter<TArg> _target;
                public Adapter(CreateInstanceMethodImposter<TArg> target)
                {
                    _target = target;
                }

                public TArgTarget Invoke()
                {
                    var result = _target.Invoke();
                    return global::Imposter.Abstractions.TypeCaster.Cast<TArg, TArgTarget>(result);
                }

                public bool HasMatchingInvocationImposterGroup()
                {
                    return _target.HasMatchingInvocationImposterGroup();
                }

                ICreateInstanceMethodImposter<TArgTarget1>? ICreateInstanceMethodImposter.As<TArgTarget1>()
                {
                    throw new NotImplementedException();
                }
            }

            public bool HasMatchingInvocationImposterGroup()
            {
                return FindMatchingInvocationImposterGroup() != null;
            }

            private CreateInstanceMethodInvocationImposterGroup<TArg>? FindMatchingInvocationImposterGroup()
            {
                if (_invocationImposters.TryPeek(out var invocationImposterGroup))
                    return invocationImposterGroup;
                else
                    return null;
            }

            public TArg Invoke()
            {
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup();
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("TArg IGenericConstraintsTarget.CreateInstance<TArg>()");
                    }

                    matchingInvocationImposterGroup = CreateInstanceMethodInvocationImposterGroup<TArg>.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "TArg IGenericConstraintsTarget.CreateInstance<TArg>()");
                    _createInstanceMethodInvocationHistoryCollection.Add(new CreateInstanceMethodInvocationHistory<TArg>(result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _createInstanceMethodInvocationHistoryCollection.Add(new CreateInstanceMethodInvocationHistory<TArg>(default !, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : ICreateInstanceMethodImposterBuilder<TArg>, ICreateInstanceMethodInvocationImposterGroupContinuation<TArg>
            {
                private readonly CreateInstanceMethodImposterCollection _imposterCollection;
                private readonly CreateInstanceMethodInvocationHistoryCollection _createInstanceMethodInvocationHistoryCollection;
                private readonly CreateInstanceMethodInvocationImposterGroup<TArg> _invocationImposterGroup;
                private CreateInstanceMethodInvocationImposterGroup<TArg>.MethodInvocationImposter _currentInvocationImposter;
                public Builder(CreateInstanceMethodImposterCollection _imposterCollection, CreateInstanceMethodInvocationHistoryCollection _createInstanceMethodInvocationHistoryCollection)
                {
                    this._imposterCollection = _imposterCollection;
                    this._createInstanceMethodInvocationHistoryCollection = _createInstanceMethodInvocationHistoryCollection;
                    this._invocationImposterGroup = new CreateInstanceMethodInvocationImposterGroup<TArg>();
                    CreateInstanceMethodImposter<TArg> methodImposter = _imposterCollection.AddNew<TArg>();
                    methodImposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                ICreateInstanceMethodInvocationImposterGroupContinuation<TArg> ICreateInstanceMethodInvocationImposterGroup<TArg>.Throws<TException>()
                {
                    _currentInvocationImposter.Throws(() =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                ICreateInstanceMethodInvocationImposterGroupContinuation<TArg> ICreateInstanceMethodInvocationImposterGroup<TArg>.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws(() =>
                    {
                        throw exception;
                    });
                    return this;
                }

                ICreateInstanceMethodInvocationImposterGroupContinuation<TArg> ICreateInstanceMethodInvocationImposterGroup<TArg>.Throws(CreateInstanceExceptionGeneratorDelegate<TArg> exceptionGenerator)
                {
                    _currentInvocationImposter.Throws(() =>
                    {
                        throw exceptionGenerator.Invoke();
                    });
                    return this;
                }

                ICreateInstanceMethodInvocationImposterGroupContinuation<TArg> ICreateInstanceMethodInvocationImposterGroupCallback<TArg>.Callback(CreateInstanceCallbackDelegate<TArg> callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                ICreateInstanceMethodInvocationImposterGroupContinuation<TArg> ICreateInstanceMethodInvocationImposterGroup<TArg>.Returns(CreateInstanceDelegate<TArg> resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                ICreateInstanceMethodInvocationImposterGroupContinuation<TArg> ICreateInstanceMethodInvocationImposterGroup<TArg>.Returns(TArg value)
                {
                    _currentInvocationImposter.Returns(value);
                    return this;
                }

                ICreateInstanceMethodInvocationImposterGroup<TArg> ICreateInstanceMethodInvocationImposterGroupContinuation<TArg>.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void CreateInstanceInvocationVerifier<TArg>.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _createInstanceMethodInvocationHistoryCollection.Count<TArg>();
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount, _createInstanceMethodInvocationHistoryCollection.ToString());
                    }
                }
            }
        }

        public delegate void HandleReferenceDelegate<TArg>(TArg value);
        public delegate void HandleReferenceCallbackDelegate<TArg>(TArg value);
        public delegate global::System.Exception HandleReferenceExceptionGeneratorDelegate<TArg>(TArg value);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class HandleReferenceArguments<TArg>
        {
            public TArg value;
            internal HandleReferenceArguments(TArg value)
            {
                this.value = value;
            }

            public HandleReferenceArguments<TArgTarget> As<TArgTarget>()
            {
                return new HandleReferenceArguments<TArgTarget>(TypeCaster.Cast<TArg, TArgTarget>(value));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class HandleReferenceArgumentsCriteria<TArg>
        {
            public global::Imposter.Abstractions.Arg<TArg> value { get; }

            public HandleReferenceArgumentsCriteria(global::Imposter.Abstractions.Arg<TArg> value)
            {
                this.value = value;
            }

            public bool Matches(HandleReferenceArguments<TArg> arguments)
            {
                return value.Matches(arguments.value);
            }

            public HandleReferenceArgumentsCriteria<TArgTarget> As<TArgTarget>()
            {
                return new HandleReferenceArgumentsCriteria<TArgTarget>(global::Imposter.Abstractions.Arg<TArgTarget>.Is(it => global::Imposter.Abstractions.TypeCaster.TryCast<TArgTarget, TArg>(it, out TArg valueTarget) && value.Matches(valueTarget)));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IHandleReferenceMethodInvocationHistory
        {
            bool Matches<TArgTarget>(HandleReferenceArgumentsCriteria<TArgTarget> criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class HandleReferenceMethodInvocationHistory<TArg> : IHandleReferenceMethodInvocationHistory
        {
            internal HandleReferenceArguments<TArg> Arguments;
            internal global::System.Exception? Exception;
            public HandleReferenceMethodInvocationHistory(HandleReferenceArguments<TArg> Arguments, global::System.Exception? Exception)
            {
                this.Arguments = Arguments;
                this.Exception = Exception;
            }

            public bool Matches<TArgTarget>(HandleReferenceArgumentsCriteria<TArgTarget> criteria)
            {
                return (typeof(TArgTarget) == typeof(TArg)) && criteria.As<TArg>().Matches(Arguments);
            }

            public override string ToString()
            {
                return "HandleReference(" + global::System.String.Join(", ", new[] { "value: " + FormatValue(Arguments.value) }) + ")" + (Exception == null ? "" : " threw " + FormatValue(Exception));
            }

            private static string FormatValue(object? value)
            {
                return "<" + (value?.ToString() ?? "null") + ">";
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class HandleReferenceMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IHandleReferenceMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IHandleReferenceMethodInvocationHistory>();
            internal void Add(IHandleReferenceMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count<TArg>(HandleReferenceArgumentsCriteria<TArg> argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches<TArg>(argumentsCriteria));
            }

            public override string ToString()
            {
                return string.Join(Environment.NewLine, _invocationHistory.Select(invocation => invocation.ToString()));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class HandleReferenceMethodImposterCollection
        {
            private readonly HandleReferenceMethodInvocationHistoryCollection _handleReferenceMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public HandleReferenceMethodImposterCollection(HandleReferenceMethodInvocationHistoryCollection _handleReferenceMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._handleReferenceMethodInvocationHistoryCollection = _handleReferenceMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            private readonly global::System.Collections.Concurrent.ConcurrentStack<IHandleReferenceMethodImposter> _imposters = new global::System.Collections.Concurrent.ConcurrentStack<IHandleReferenceMethodImposter>();
            internal HandleReferenceMethodImposter<TArg> AddNew<TArg>()
            {
                var imposter = new HandleReferenceMethodImposter<TArg>(_handleReferenceMethodInvocationHistoryCollection, _invocationBehavior);
                _imposters.Push(imposter);
                return imposter;
            }

            internal IHandleReferenceMethodImposter<TArg> GetImposterWithMatchingInvocationImposterGroup<TArg>(HandleReferenceArguments<TArg> arguments)
            {
                return _imposters.Select(it => it.As<TArg>()).Where(it => it != null).Select(it => it!).FirstOrDefault(it => it.HasMatchingInvocationImposterGroup(arguments)) ?? AddNew<TArg>();
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class HandleReferenceMethodInvocationImposterGroup<TArg>
        {
            internal static HandleReferenceMethodInvocationImposterGroup<TArg> Default = new HandleReferenceMethodInvocationImposterGroup<TArg>(new HandleReferenceArgumentsCriteria<TArg>(global::Imposter.Abstractions.Arg<TArg>.Any()));
            internal HandleReferenceArgumentsCriteria<TArg> ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public HandleReferenceMethodInvocationImposterGroup(HandleReferenceArgumentsCriteria<TArg> argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public void Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, TArg value)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                invocationImposter.Invoke(invocationBehavior, methodDisplayName, value);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default._resultGenerator = DefaultResultGenerator;
                }

                private HandleReferenceDelegate<TArg>? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<HandleReferenceCallbackDelegate<TArg>> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<HandleReferenceCallbackDelegate<TArg>>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public void Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, TArg value)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    _resultGenerator.Invoke(value);
                    foreach (var callback in _callbacks)
                    {
                        callback(value);
                    }
                }

                internal void Callback(HandleReferenceCallbackDelegate<TArg> callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Throws(HandleReferenceExceptionGeneratorDelegate<TArg> exceptionGenerator)
                {
                    _resultGenerator = (TArg value) =>
                    {
                        throw exceptionGenerator(value);
                    };
                }

                internal static void DefaultResultGenerator(TArg value)
                {
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IHandleReferenceMethodInvocationImposterGroupCallback<TArg>
        {
            IHandleReferenceMethodInvocationImposterGroupContinuation<TArg> Callback(HandleReferenceCallbackDelegate<TArg> callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IHandleReferenceMethodInvocationImposterGroupContinuation<TArg> : IHandleReferenceMethodInvocationImposterGroupCallback<TArg>
        {
            IHandleReferenceMethodInvocationImposterGroup<TArg> Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IHandleReferenceMethodInvocationImposterGroup<TArg> : IHandleReferenceMethodInvocationImposterGroupCallback<TArg>
        {
            IHandleReferenceMethodInvocationImposterGroupContinuation<TArg> Throws<TException>()
                where TException : global::System.Exception, new();
            IHandleReferenceMethodInvocationImposterGroupContinuation<TArg> Throws(global::System.Exception exception);
            IHandleReferenceMethodInvocationImposterGroupContinuation<TArg> Throws(HandleReferenceExceptionGeneratorDelegate<TArg> exceptionGenerator);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface IHandleReferenceMethodImposter
        {
            IHandleReferenceMethodImposter<TArgTarget>? As<TArgTarget>();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface IHandleReferenceMethodImposter<TArg> : IHandleReferenceMethodImposter
        {
            void Invoke(TArg value);
            bool HasMatchingInvocationImposterGroup(HandleReferenceArguments<TArg> arguments);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface HandleReferenceInvocationVerifier<TArg>
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IHandleReferenceMethodImposterBuilder<TArg> : IHandleReferenceMethodInvocationImposterGroup<TArg>, IHandleReferenceMethodInvocationImposterGroupCallback<TArg>, HandleReferenceInvocationVerifier<TArg>
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class HandleReferenceMethodImposter<TArg> : IHandleReferenceMethodImposter<TArg>
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<HandleReferenceMethodInvocationImposterGroup<TArg>> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<HandleReferenceMethodInvocationImposterGroup<TArg>>();
            private readonly HandleReferenceMethodInvocationHistoryCollection _handleReferenceMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public HandleReferenceMethodImposter(HandleReferenceMethodInvocationHistoryCollection _handleReferenceMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._handleReferenceMethodInvocationHistoryCollection = _handleReferenceMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            IHandleReferenceMethodImposter<TArgTarget>? IHandleReferenceMethodImposter.As<TArgTarget>()
            {
                if (typeof(TArgTarget).IsAssignableTo(typeof(TArg)))
                {
                    return new Adapter<TArgTarget>(this);
                }

                return null;
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            private class Adapter<TArgTarget> : IHandleReferenceMethodImposter<TArgTarget>
            {
                private readonly HandleReferenceMethodImposter<TArg> _target;
                public Adapter(HandleReferenceMethodImposter<TArg> target)
                {
                    _target = target;
                }

                public void Invoke(TArgTarget value)
                {
                    _target.Invoke(global::Imposter.Abstractions.TypeCaster.Cast<TArgTarget, TArg>(value));
                }

                public bool HasMatchingInvocationImposterGroup(HandleReferenceArguments<TArgTarget> arguments)
                {
                    return _target.HasMatchingInvocationImposterGroup(arguments.As<TArg>());
                }

                IHandleReferenceMethodImposter<TArgTarget1>? IHandleReferenceMethodImposter.As<TArgTarget1>()
                {
                    throw new NotImplementedException();
                }
            }

            public bool HasMatchingInvocationImposterGroup(HandleReferenceArguments<TArg> arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private HandleReferenceMethodInvocationImposterGroup<TArg>? FindMatchingInvocationImposterGroup(HandleReferenceArguments<TArg> arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public void Invoke(TArg value)
            {
                var arguments = new HandleReferenceArguments<TArg>(value);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("void IGenericConstraintsTarget.HandleReference<TArg>(TArg value)");
                    }

                    matchingInvocationImposterGroup = HandleReferenceMethodInvocationImposterGroup<TArg>.Default;
                }

                try
                {
                    matchingInvocationImposterGroup.Invoke(_invocationBehavior, "void IGenericConstraintsTarget.HandleReference<TArg>(TArg value)", value);
                    _handleReferenceMethodInvocationHistoryCollection.Add(new HandleReferenceMethodInvocationHistory<TArg>(arguments, default));
                }
                catch (global::System.Exception ex)
                {
                    _handleReferenceMethodInvocationHistoryCollection.Add(new HandleReferenceMethodInvocationHistory<TArg>(arguments, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IHandleReferenceMethodImposterBuilder<TArg>, IHandleReferenceMethodInvocationImposterGroupContinuation<TArg>
            {
                private readonly HandleReferenceMethodImposterCollection _imposterCollection;
                private readonly HandleReferenceMethodInvocationHistoryCollection _handleReferenceMethodInvocationHistoryCollection;
                private readonly HandleReferenceArgumentsCriteria<TArg> _argumentsCriteria;
                private readonly HandleReferenceMethodInvocationImposterGroup<TArg> _invocationImposterGroup;
                private HandleReferenceMethodInvocationImposterGroup<TArg>.MethodInvocationImposter _currentInvocationImposter;
                public Builder(HandleReferenceMethodImposterCollection _imposterCollection, HandleReferenceMethodInvocationHistoryCollection _handleReferenceMethodInvocationHistoryCollection, HandleReferenceArgumentsCriteria<TArg> _argumentsCriteria)
                {
                    this._imposterCollection = _imposterCollection;
                    this._handleReferenceMethodInvocationHistoryCollection = _handleReferenceMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new HandleReferenceMethodInvocationImposterGroup<TArg>(_argumentsCriteria);
                    HandleReferenceMethodImposter<TArg> methodImposter = _imposterCollection.AddNew<TArg>();
                    methodImposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IHandleReferenceMethodInvocationImposterGroupContinuation<TArg> IHandleReferenceMethodInvocationImposterGroup<TArg>.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((TArg value) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IHandleReferenceMethodInvocationImposterGroupContinuation<TArg> IHandleReferenceMethodInvocationImposterGroup<TArg>.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((TArg value) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IHandleReferenceMethodInvocationImposterGroupContinuation<TArg> IHandleReferenceMethodInvocationImposterGroup<TArg>.Throws(HandleReferenceExceptionGeneratorDelegate<TArg> exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((TArg value) =>
                    {
                        throw exceptionGenerator.Invoke(value);
                    });
                    return this;
                }

                IHandleReferenceMethodInvocationImposterGroupContinuation<TArg> IHandleReferenceMethodInvocationImposterGroupCallback<TArg>.Callback(HandleReferenceCallbackDelegate<TArg> callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IHandleReferenceMethodInvocationImposterGroup<TArg> IHandleReferenceMethodInvocationImposterGroupContinuation<TArg>.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void HandleReferenceInvocationVerifier<TArg>.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _handleReferenceMethodInvocationHistoryCollection.Count<TArg>(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount, _handleReferenceMethodInvocationHistoryCollection.ToString());
                    }
                }
            }
        }

        public IGenericConstraintsTargetImposter(global::Imposter.Abstractions.ImposterMode invocationBehavior = global::Imposter.Abstractions.ImposterMode.Implicit)
        {
            this._handleReferenceMethodImposterCollection = new HandleReferenceMethodImposterCollection(_handleReferenceMethodInvocationHistoryCollection, invocationBehavior);
            this._cloneStructMethodImposterCollection = new CloneStructMethodImposterCollection(_cloneStructMethodInvocationHistoryCollection, invocationBehavior);
            this._compareValuesMethodImposterCollection = new CompareValuesMethodImposterCollection(_compareValuesMethodInvocationHistoryCollection, invocationBehavior);
            this._createInstanceMethodImposterCollection = new CreateInstanceMethodImposterCollection(_createInstanceMethodInvocationHistoryCollection, invocationBehavior);
            this._imposterInstance = new ImposterTargetInstance(this);
            this._invocationBehavior = invocationBehavior;
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class ImposterTargetInstance : global::Imposter.Tests.Features.OpenGenericImposter.IGenericConstraintsTarget
        {
            private readonly IGenericConstraintsTargetImposter _imposter;
            public ImposterTargetInstance(IGenericConstraintsTargetImposter _imposter)
            {
                this._imposter = _imposter;
            }

            public void HandleReference<TArg>(TArg value)
                where TArg : class, new()
            {
                _imposter._handleReferenceMethodImposterCollection.GetImposterWithMatchingInvocationImposterGroup<TArg>(new HandleReferenceArguments<TArg>(value)).Invoke(value);
            }

            public TArg CloneStruct<TArg>(TArg value)
                where TArg : struct
            {
                return _imposter._cloneStructMethodImposterCollection.GetImposterWithMatchingInvocationImposterGroup<TArg>(new CloneStructArguments<TArg>(value)).Invoke(value);
            }

            public void CompareValues<TArg>(TArg left, TArg right)
                where TArg : global::System.IComparable<TArg>
            {
                _imposter._compareValuesMethodImposterCollection.GetImposterWithMatchingInvocationImposterGroup<TArg>(new CompareValuesArguments<TArg>(left, right)).Invoke(left, right);
            }

            public TArg CreateInstance<TArg>()
                where TArg : new()
            {
                return _imposter._createInstanceMethodImposterCollection.GetImposterWithMatchingInvocationImposterGroup<TArg>().Invoke();
            }
        }
    }

    [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
    public static class IGenericConstraintsTargetImposterExtensions
    {
        extension(global::Imposter.Tests.Features.OpenGenericImposter.IGenericConstraintsTarget imposter)
        {
            public static global::Imposter.Tests.Features.OpenGenericImposter.IGenericConstraintsTargetImposter Imposter(global::Imposter.Abstractions.ImposterMode invocationBehavior = global::Imposter.Abstractions.ImposterMode.Implicit) => new global::Imposter.Tests.Features.OpenGenericImposter.IGenericConstraintsTargetImposter(invocationBehavior);
        }
    }
}
#nullable restore
