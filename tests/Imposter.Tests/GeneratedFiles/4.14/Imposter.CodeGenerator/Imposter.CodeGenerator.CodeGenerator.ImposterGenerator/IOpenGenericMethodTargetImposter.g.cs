// <auto-generated />
#nullable enable
#pragma warning disable
using global::System;
using global::System.Linq;
using global::System.Collections.Generic;
using global::System.Threading.Tasks;
using global::System.Diagnostics;
using global::System.Runtime.CompilerServices;
using global::Imposter.Abstractions;
using global::System.Collections.Concurrent;
using global::Imposter.Tests.Features.OpenGenericImposter;

namespace Imposter.Tests.Features.OpenGenericImposter
{
    [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
    public sealed class IOpenGenericMethodTargetImposter<T> : global::Imposter.Abstractions.IHaveImposterInstance<global::Imposter.Tests.Features.OpenGenericImposter.IOpenGenericMethodTarget<T>>
    {
        private readonly GetNextMethodImposter _getNextMethodImposter;
        private readonly TryAddMethodImposter _tryAddMethodImposter;
        private readonly AddMethodImposter _addMethodImposter;
        private readonly CountForMethodImposter _countForMethodImposter;
        private readonly ResilientFetchMethodImposter _resilientFetchMethodImposter;
        private readonly PublishMethodImposter _publishMethodImposter;
        private readonly GetNextMethodInvocationHistoryCollection _getNextMethodInvocationHistoryCollection = new GetNextMethodInvocationHistoryCollection();
        private readonly TryAddMethodInvocationHistoryCollection _tryAddMethodInvocationHistoryCollection = new TryAddMethodInvocationHistoryCollection();
        private readonly AddMethodInvocationHistoryCollection _addMethodInvocationHistoryCollection = new AddMethodInvocationHistoryCollection();
        private readonly CountForMethodInvocationHistoryCollection _countForMethodInvocationHistoryCollection = new CountForMethodInvocationHistoryCollection();
        private readonly ResilientFetchMethodInvocationHistoryCollection _resilientFetchMethodInvocationHistoryCollection = new ResilientFetchMethodInvocationHistoryCollection();
        private readonly PublishMethodInvocationHistoryCollection _publishMethodInvocationHistoryCollection = new PublishMethodInvocationHistoryCollection();
        public IGetNextMethodImposterBuilder GetNext()
        {
            return new GetNextMethodImposter.Builder(_getNextMethodImposter, _getNextMethodInvocationHistoryCollection);
        }

        public ITryAddMethodImposterBuilder TryAdd(global::Imposter.Abstractions.Arg<T> value)
        {
            return new TryAddMethodImposter.Builder(_tryAddMethodImposter, _tryAddMethodInvocationHistoryCollection, new TryAddArgumentsCriteria(value));
        }

        public IAddMethodImposterBuilder Add(global::Imposter.Abstractions.Arg<T> item, global::Imposter.Abstractions.Arg<int> index)
        {
            return new AddMethodImposter.Builder(_addMethodImposter, _addMethodInvocationHistoryCollection, new AddArgumentsCriteria(item, index));
        }

        public ICountForMethodImposterBuilder CountFor(global::Imposter.Abstractions.Arg<T> item)
        {
            return new CountForMethodImposter.Builder(_countForMethodImposter, _countForMethodInvocationHistoryCollection, new CountForArgumentsCriteria(item));
        }

        public IResilientFetchMethodImposterBuilder ResilientFetch()
        {
            return new ResilientFetchMethodImposter.Builder(_resilientFetchMethodImposter, _resilientFetchMethodInvocationHistoryCollection);
        }

        public IPublishMethodImposterBuilder Publish(global::Imposter.Abstractions.Arg<T> payload, global::Imposter.Abstractions.Arg<string> category, global::Imposter.Abstractions.Arg<int> priority)
        {
            return new PublishMethodImposter.Builder(_publishMethodImposter, _publishMethodInvocationHistoryCollection, new PublishArgumentsCriteria(payload, category, priority));
        }

        private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
        private ImposterTargetInstance _imposterInstance;
        global::Imposter.Tests.Features.OpenGenericImposter.IOpenGenericMethodTarget<T> global::Imposter.Abstractions.IHaveImposterInstance<global::Imposter.Tests.Features.OpenGenericImposter.IOpenGenericMethodTarget<T>>.Instance()
        {
            return _imposterInstance;
        }

        // void IOpenGenericMethodTarget<T>.Add(T item, int index)
        public delegate void AddDelegate(T item, int index);
        // void IOpenGenericMethodTarget<T>.Add(T item, int index)
        public delegate void AddCallbackDelegate(T item, int index);
        // void IOpenGenericMethodTarget<T>.Add(T item, int index)
        public delegate global::System.Exception AddExceptionGeneratorDelegate(T item, int index);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class AddArguments
        {
            public T item;
            public int index;
            internal AddArguments(T item, int index)
            {
                this.item = item;
                this.index = index;
            }
        }

        // void IOpenGenericMethodTarget<T>.Add(T item, int index)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class AddArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<T> item { get; }
            public global::Imposter.Abstractions.Arg<int> index { get; }

            public AddArgumentsCriteria(global::Imposter.Abstractions.Arg<T> item, global::Imposter.Abstractions.Arg<int> index)
            {
                this.item = item;
                this.index = index;
            }

            public bool Matches(AddArguments arguments)
            {
                return item.Matches(arguments.item) && index.Matches(arguments.index);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IAddMethodInvocationHistory
        {
            bool Matches(AddArgumentsCriteria criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class AddMethodInvocationHistory : IAddMethodInvocationHistory
        {
            internal AddArguments Arguments;
            internal global::System.Exception? Exception;
            public AddMethodInvocationHistory(AddArguments Arguments, global::System.Exception? Exception)
            {
                this.Arguments = Arguments;
                this.Exception = Exception;
            }

            public bool Matches(AddArgumentsCriteria criteria)
            {
                return criteria.Matches(Arguments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class AddMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IAddMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IAddMethodInvocationHistory>();
            internal void Add(IAddMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count(AddArgumentsCriteria argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches(argumentsCriteria));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class AddMethodInvocationImposterGroup
        {
            internal static AddMethodInvocationImposterGroup Default = new AddMethodInvocationImposterGroup(new AddArgumentsCriteria(global::Imposter.Abstractions.Arg<T>.Any(), global::Imposter.Abstractions.Arg<int>.Any()));
            internal AddArgumentsCriteria ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public AddMethodInvocationImposterGroup(AddArgumentsCriteria argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public void Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, T item, int index)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                invocationImposter.Invoke(invocationBehavior, methodDisplayName, item, index);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default._resultGenerator = DefaultResultGenerator;
                }

                private AddDelegate? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<AddCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<AddCallbackDelegate>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public void Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, T item, int index)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    _resultGenerator.Invoke(item, index);
                    foreach (var callback in _callbacks)
                    {
                        callback(item, index);
                    }
                }

                internal void Callback(AddCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Throws(AddExceptionGeneratorDelegate exceptionGenerator)
                {
                    _resultGenerator = (T item, int index) =>
                    {
                        throw exceptionGenerator(item, index);
                    };
                }

                internal static void DefaultResultGenerator(T item, int index)
                {
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IAddMethodInvocationImposterGroupCallback
        {
            IAddMethodInvocationImposterGroupContinuation Callback(AddCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IAddMethodInvocationImposterGroupContinuation : IAddMethodInvocationImposterGroupCallback
        {
            IAddMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IAddMethodInvocationImposterGroup : IAddMethodInvocationImposterGroupCallback
        {
            IAddMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            IAddMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            IAddMethodInvocationImposterGroupContinuation Throws(AddExceptionGeneratorDelegate exceptionGenerator);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface AddInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IAddMethodImposterBuilder : IAddMethodInvocationImposterGroup, IAddMethodInvocationImposterGroupCallback, AddInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class AddMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<AddMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<AddMethodInvocationImposterGroup>();
            private readonly AddMethodInvocationHistoryCollection _addMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public AddMethodImposter(AddMethodInvocationHistoryCollection _addMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._addMethodInvocationHistoryCollection = _addMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup(AddArguments arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private AddMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup(AddArguments arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public void Invoke(T item, int index)
            {
                var arguments = new AddArguments(item, index);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("void IOpenGenericMethodTarget<T>.Add(T item, int index)");
                    }

                    matchingInvocationImposterGroup = AddMethodInvocationImposterGroup.Default;
                }

                try
                {
                    matchingInvocationImposterGroup.Invoke(_invocationBehavior, "void IOpenGenericMethodTarget<T>.Add(T item, int index)", item, index);
                    _addMethodInvocationHistoryCollection.Add(new AddMethodInvocationHistory(arguments, default));
                }
                catch (global::System.Exception ex)
                {
                    _addMethodInvocationHistoryCollection.Add(new AddMethodInvocationHistory(arguments, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IAddMethodImposterBuilder, IAddMethodInvocationImposterGroupContinuation
            {
                private readonly AddMethodImposter _imposter;
                private readonly AddMethodInvocationHistoryCollection _addMethodInvocationHistoryCollection;
                private readonly AddArgumentsCriteria _argumentsCriteria;
                private readonly AddMethodInvocationImposterGroup _invocationImposterGroup;
                private AddMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(AddMethodImposter _imposter, AddMethodInvocationHistoryCollection _addMethodInvocationHistoryCollection, AddArgumentsCriteria _argumentsCriteria)
                {
                    this._imposter = _imposter;
                    this._addMethodInvocationHistoryCollection = _addMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new AddMethodInvocationImposterGroup(_argumentsCriteria);
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IAddMethodInvocationImposterGroupContinuation IAddMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((T item, int index) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IAddMethodInvocationImposterGroupContinuation IAddMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((T item, int index) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IAddMethodInvocationImposterGroupContinuation IAddMethodInvocationImposterGroup.Throws(AddExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((T item, int index) =>
                    {
                        throw exceptionGenerator.Invoke(item, index);
                    });
                    return this;
                }

                IAddMethodInvocationImposterGroupContinuation IAddMethodInvocationImposterGroupCallback.Callback(AddCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IAddMethodInvocationImposterGroup IAddMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void AddInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _addMethodInvocationHistoryCollection.Count(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        // int IOpenGenericMethodTarget<T>.CountFor(T item)
        public delegate int CountForDelegate(T item);
        // int IOpenGenericMethodTarget<T>.CountFor(T item)
        public delegate void CountForCallbackDelegate(T item);
        // int IOpenGenericMethodTarget<T>.CountFor(T item)
        public delegate global::System.Exception CountForExceptionGeneratorDelegate(T item);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class CountForArguments
        {
            public T item;
            internal CountForArguments(T item)
            {
                this.item = item;
            }
        }

        // int IOpenGenericMethodTarget<T>.CountFor(T item)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class CountForArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<T> item { get; }

            public CountForArgumentsCriteria(global::Imposter.Abstractions.Arg<T> item)
            {
                this.item = item;
            }

            public bool Matches(CountForArguments arguments)
            {
                return item.Matches(arguments.item);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICountForMethodInvocationHistory
        {
            bool Matches(CountForArgumentsCriteria criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CountForMethodInvocationHistory : ICountForMethodInvocationHistory
        {
            internal CountForArguments Arguments;
            internal int? Result;
            internal global::System.Exception? Exception;
            public CountForMethodInvocationHistory(CountForArguments Arguments, int? Result, global::System.Exception? Exception)
            {
                this.Arguments = Arguments;
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches(CountForArgumentsCriteria criteria)
            {
                return criteria.Matches(Arguments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CountForMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<ICountForMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<ICountForMethodInvocationHistory>();
            internal void Add(ICountForMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count(CountForArgumentsCriteria argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches(argumentsCriteria));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class CountForMethodInvocationImposterGroup
        {
            internal static CountForMethodInvocationImposterGroup Default = new CountForMethodInvocationImposterGroup(new CountForArgumentsCriteria(global::Imposter.Abstractions.Arg<T>.Any()));
            internal CountForArgumentsCriteria ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public CountForMethodInvocationImposterGroup(CountForArgumentsCriteria argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public int Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, T item)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName, item);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private CountForDelegate? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<CountForCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<CountForCallbackDelegate>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public int Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, T item)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    int result = _resultGenerator.Invoke(item);
                    foreach (var callback in _callbacks)
                    {
                        callback(item);
                    }

                    return result;
                }

                internal void Callback(CountForCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(CountForDelegate resultGenerator)
                {
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(int value)
                {
                    _resultGenerator = (T item) =>
                    {
                        return value;
                    };
                }

                internal void Throws(CountForExceptionGeneratorDelegate exceptionGenerator)
                {
                    _resultGenerator = (T item) =>
                    {
                        throw exceptionGenerator(item);
                    };
                }

                internal static int DefaultResultGenerator(T item)
                {
                    return default !;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICountForMethodInvocationImposterGroupCallback
        {
            ICountForMethodInvocationImposterGroupContinuation Callback(CountForCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICountForMethodInvocationImposterGroupContinuation : ICountForMethodInvocationImposterGroupCallback
        {
            ICountForMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICountForMethodInvocationImposterGroup : ICountForMethodInvocationImposterGroupCallback
        {
            ICountForMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            ICountForMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            ICountForMethodInvocationImposterGroupContinuation Throws(CountForExceptionGeneratorDelegate exceptionGenerator);
            ICountForMethodInvocationImposterGroupContinuation Returns(CountForDelegate resultGenerator);
            ICountForMethodInvocationImposterGroupContinuation Returns(int value);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface CountForInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICountForMethodImposterBuilder : ICountForMethodInvocationImposterGroup, ICountForMethodInvocationImposterGroupCallback, CountForInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CountForMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<CountForMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<CountForMethodInvocationImposterGroup>();
            private readonly CountForMethodInvocationHistoryCollection _countForMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public CountForMethodImposter(CountForMethodInvocationHistoryCollection _countForMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._countForMethodInvocationHistoryCollection = _countForMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup(CountForArguments arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private CountForMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup(CountForArguments arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public int Invoke(T item)
            {
                var arguments = new CountForArguments(item);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("int IOpenGenericMethodTarget<T>.CountFor(T item)");
                    }

                    matchingInvocationImposterGroup = CountForMethodInvocationImposterGroup.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "int IOpenGenericMethodTarget<T>.CountFor(T item)", item);
                    _countForMethodInvocationHistoryCollection.Add(new CountForMethodInvocationHistory(arguments, result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _countForMethodInvocationHistoryCollection.Add(new CountForMethodInvocationHistory(arguments, default !, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : ICountForMethodImposterBuilder, ICountForMethodInvocationImposterGroupContinuation
            {
                private readonly CountForMethodImposter _imposter;
                private readonly CountForMethodInvocationHistoryCollection _countForMethodInvocationHistoryCollection;
                private readonly CountForArgumentsCriteria _argumentsCriteria;
                private readonly CountForMethodInvocationImposterGroup _invocationImposterGroup;
                private CountForMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(CountForMethodImposter _imposter, CountForMethodInvocationHistoryCollection _countForMethodInvocationHistoryCollection, CountForArgumentsCriteria _argumentsCriteria)
                {
                    this._imposter = _imposter;
                    this._countForMethodInvocationHistoryCollection = _countForMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new CountForMethodInvocationImposterGroup(_argumentsCriteria);
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                ICountForMethodInvocationImposterGroupContinuation ICountForMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((T item) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                ICountForMethodInvocationImposterGroupContinuation ICountForMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((T item) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                ICountForMethodInvocationImposterGroupContinuation ICountForMethodInvocationImposterGroup.Throws(CountForExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((T item) =>
                    {
                        throw exceptionGenerator.Invoke(item);
                    });
                    return this;
                }

                ICountForMethodInvocationImposterGroupContinuation ICountForMethodInvocationImposterGroupCallback.Callback(CountForCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                ICountForMethodInvocationImposterGroupContinuation ICountForMethodInvocationImposterGroup.Returns(CountForDelegate resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                ICountForMethodInvocationImposterGroupContinuation ICountForMethodInvocationImposterGroup.Returns(int value)
                {
                    _currentInvocationImposter.Returns(value);
                    return this;
                }

                ICountForMethodInvocationImposterGroup ICountForMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void CountForInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _countForMethodInvocationHistoryCollection.Count(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        // T IOpenGenericMethodTarget<T>.GetNext()
        public delegate T GetNextDelegate();
        // T IOpenGenericMethodTarget<T>.GetNext()
        public delegate void GetNextCallbackDelegate();
        // T IOpenGenericMethodTarget<T>.GetNext()
        public delegate global::System.Exception GetNextExceptionGeneratorDelegate();
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IGetNextMethodInvocationHistory
        {
            bool Matches();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class GetNextMethodInvocationHistory : IGetNextMethodInvocationHistory
        {
            internal T? Result;
            internal global::System.Exception? Exception;
            public GetNextMethodInvocationHistory(T? Result, global::System.Exception? Exception)
            {
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches()
            {
                return true;
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class GetNextMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IGetNextMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IGetNextMethodInvocationHistory>();
            internal void Add(IGetNextMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count()
            {
                return _invocationHistory.Count(it => it.Matches());
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class GetNextMethodInvocationImposterGroup
        {
            internal static GetNextMethodInvocationImposterGroup Default = new GetNextMethodInvocationImposterGroup();
            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public GetNextMethodInvocationImposterGroup()
            {
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public T Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private GetNextDelegate? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<GetNextCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<GetNextCallbackDelegate>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public T Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    T result = _resultGenerator.Invoke();
                    foreach (var callback in _callbacks)
                    {
                        callback();
                    }

                    return result;
                }

                internal void Callback(GetNextCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(GetNextDelegate resultGenerator)
                {
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(T value)
                {
                    _resultGenerator = () =>
                    {
                        return value;
                    };
                }

                internal void Throws(GetNextExceptionGeneratorDelegate exceptionGenerator)
                {
                    _resultGenerator = () =>
                    {
                        throw exceptionGenerator();
                    };
                }

                internal static T DefaultResultGenerator()
                {
                    return default !;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IGetNextMethodInvocationImposterGroupCallback
        {
            IGetNextMethodInvocationImposterGroupContinuation Callback(GetNextCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IGetNextMethodInvocationImposterGroupContinuation : IGetNextMethodInvocationImposterGroupCallback
        {
            IGetNextMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IGetNextMethodInvocationImposterGroup : IGetNextMethodInvocationImposterGroupCallback
        {
            IGetNextMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            IGetNextMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            IGetNextMethodInvocationImposterGroupContinuation Throws(GetNextExceptionGeneratorDelegate exceptionGenerator);
            IGetNextMethodInvocationImposterGroupContinuation Returns(GetNextDelegate resultGenerator);
            IGetNextMethodInvocationImposterGroupContinuation Returns(T value);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface GetNextInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IGetNextMethodImposterBuilder : IGetNextMethodInvocationImposterGroup, IGetNextMethodInvocationImposterGroupCallback, GetNextInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class GetNextMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<GetNextMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<GetNextMethodInvocationImposterGroup>();
            private readonly GetNextMethodInvocationHistoryCollection _getNextMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public GetNextMethodImposter(GetNextMethodInvocationHistoryCollection _getNextMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._getNextMethodInvocationHistoryCollection = _getNextMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup()
            {
                return FindMatchingInvocationImposterGroup() != null;
            }

            private GetNextMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup()
            {
                if (_invocationImposters.TryPeek(out var invocationImposterGroup))
                    return invocationImposterGroup;
                else
                    return null;
            }

            public T Invoke()
            {
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup();
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("T IOpenGenericMethodTarget<T>.GetNext()");
                    }

                    matchingInvocationImposterGroup = GetNextMethodInvocationImposterGroup.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "T IOpenGenericMethodTarget<T>.GetNext()");
                    _getNextMethodInvocationHistoryCollection.Add(new GetNextMethodInvocationHistory(result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _getNextMethodInvocationHistoryCollection.Add(new GetNextMethodInvocationHistory(default !, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IGetNextMethodImposterBuilder, IGetNextMethodInvocationImposterGroupContinuation
            {
                private readonly GetNextMethodImposter _imposter;
                private readonly GetNextMethodInvocationHistoryCollection _getNextMethodInvocationHistoryCollection;
                private readonly GetNextMethodInvocationImposterGroup _invocationImposterGroup;
                private GetNextMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(GetNextMethodImposter _imposter, GetNextMethodInvocationHistoryCollection _getNextMethodInvocationHistoryCollection)
                {
                    this._imposter = _imposter;
                    this._getNextMethodInvocationHistoryCollection = _getNextMethodInvocationHistoryCollection;
                    this._invocationImposterGroup = new GetNextMethodInvocationImposterGroup();
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IGetNextMethodInvocationImposterGroupContinuation IGetNextMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws(() =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IGetNextMethodInvocationImposterGroupContinuation IGetNextMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws(() =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IGetNextMethodInvocationImposterGroupContinuation IGetNextMethodInvocationImposterGroup.Throws(GetNextExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws(() =>
                    {
                        throw exceptionGenerator.Invoke();
                    });
                    return this;
                }

                IGetNextMethodInvocationImposterGroupContinuation IGetNextMethodInvocationImposterGroupCallback.Callback(GetNextCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IGetNextMethodInvocationImposterGroupContinuation IGetNextMethodInvocationImposterGroup.Returns(GetNextDelegate resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                IGetNextMethodInvocationImposterGroupContinuation IGetNextMethodInvocationImposterGroup.Returns(T value)
                {
                    _currentInvocationImposter.Returns(value);
                    return this;
                }

                IGetNextMethodInvocationImposterGroup IGetNextMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void GetNextInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _getNextMethodInvocationHistoryCollection.Count();
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        // void IOpenGenericMethodTarget<T>.Publish(T payload, string category, int priority)
        public delegate void PublishDelegate(T payload, string category, int priority);
        // void IOpenGenericMethodTarget<T>.Publish(T payload, string category, int priority)
        public delegate void PublishCallbackDelegate(T payload, string category, int priority);
        // void IOpenGenericMethodTarget<T>.Publish(T payload, string category, int priority)
        public delegate global::System.Exception PublishExceptionGeneratorDelegate(T payload, string category, int priority);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class PublishArguments
        {
            public T payload;
            public string category;
            public int priority;
            internal PublishArguments(T payload, string category, int priority)
            {
                this.payload = payload;
                this.category = category;
                this.priority = priority;
            }
        }

        // void IOpenGenericMethodTarget<T>.Publish(T payload, string category, int priority)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class PublishArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<T> payload { get; }
            public global::Imposter.Abstractions.Arg<string> category { get; }
            public global::Imposter.Abstractions.Arg<int> priority { get; }

            public PublishArgumentsCriteria(global::Imposter.Abstractions.Arg<T> payload, global::Imposter.Abstractions.Arg<string> category, global::Imposter.Abstractions.Arg<int> priority)
            {
                this.payload = payload;
                this.category = category;
                this.priority = priority;
            }

            public bool Matches(PublishArguments arguments)
            {
                return (payload.Matches(arguments.payload) && category.Matches(arguments.category)) && priority.Matches(arguments.priority);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IPublishMethodInvocationHistory
        {
            bool Matches(PublishArgumentsCriteria criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class PublishMethodInvocationHistory : IPublishMethodInvocationHistory
        {
            internal PublishArguments Arguments;
            internal global::System.Exception? Exception;
            public PublishMethodInvocationHistory(PublishArguments Arguments, global::System.Exception? Exception)
            {
                this.Arguments = Arguments;
                this.Exception = Exception;
            }

            public bool Matches(PublishArgumentsCriteria criteria)
            {
                return criteria.Matches(Arguments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class PublishMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IPublishMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IPublishMethodInvocationHistory>();
            internal void Add(IPublishMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count(PublishArgumentsCriteria argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches(argumentsCriteria));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class PublishMethodInvocationImposterGroup
        {
            internal static PublishMethodInvocationImposterGroup Default = new PublishMethodInvocationImposterGroup(new PublishArgumentsCriteria(global::Imposter.Abstractions.Arg<T>.Any(), global::Imposter.Abstractions.Arg<string>.Any(), global::Imposter.Abstractions.Arg<int>.Any()));
            internal PublishArgumentsCriteria ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public PublishMethodInvocationImposterGroup(PublishArgumentsCriteria argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public void Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, T payload, string category, int priority)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                invocationImposter.Invoke(invocationBehavior, methodDisplayName, payload, category, priority);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default._resultGenerator = DefaultResultGenerator;
                }

                private PublishDelegate? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<PublishCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<PublishCallbackDelegate>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public void Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, T payload, string category, int priority)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    _resultGenerator.Invoke(payload, category, priority);
                    foreach (var callback in _callbacks)
                    {
                        callback(payload, category, priority);
                    }
                }

                internal void Callback(PublishCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Throws(PublishExceptionGeneratorDelegate exceptionGenerator)
                {
                    _resultGenerator = (T payload, string category, int priority) =>
                    {
                        throw exceptionGenerator(payload, category, priority);
                    };
                }

                internal static void DefaultResultGenerator(T payload, string category, int priority)
                {
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IPublishMethodInvocationImposterGroupCallback
        {
            IPublishMethodInvocationImposterGroupContinuation Callback(PublishCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IPublishMethodInvocationImposterGroupContinuation : IPublishMethodInvocationImposterGroupCallback
        {
            IPublishMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IPublishMethodInvocationImposterGroup : IPublishMethodInvocationImposterGroupCallback
        {
            IPublishMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            IPublishMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            IPublishMethodInvocationImposterGroupContinuation Throws(PublishExceptionGeneratorDelegate exceptionGenerator);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface PublishInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IPublishMethodImposterBuilder : IPublishMethodInvocationImposterGroup, IPublishMethodInvocationImposterGroupCallback, PublishInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class PublishMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<PublishMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<PublishMethodInvocationImposterGroup>();
            private readonly PublishMethodInvocationHistoryCollection _publishMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public PublishMethodImposter(PublishMethodInvocationHistoryCollection _publishMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._publishMethodInvocationHistoryCollection = _publishMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup(PublishArguments arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private PublishMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup(PublishArguments arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public void Invoke(T payload, string category, int priority)
            {
                var arguments = new PublishArguments(payload, category, priority);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("void IOpenGenericMethodTarget<T>.Publish(T payload, string category, int priority)");
                    }

                    matchingInvocationImposterGroup = PublishMethodInvocationImposterGroup.Default;
                }

                try
                {
                    matchingInvocationImposterGroup.Invoke(_invocationBehavior, "void IOpenGenericMethodTarget<T>.Publish(T payload, string category, int priority)", payload, category, priority);
                    _publishMethodInvocationHistoryCollection.Add(new PublishMethodInvocationHistory(arguments, default));
                }
                catch (global::System.Exception ex)
                {
                    _publishMethodInvocationHistoryCollection.Add(new PublishMethodInvocationHistory(arguments, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IPublishMethodImposterBuilder, IPublishMethodInvocationImposterGroupContinuation
            {
                private readonly PublishMethodImposter _imposter;
                private readonly PublishMethodInvocationHistoryCollection _publishMethodInvocationHistoryCollection;
                private readonly PublishArgumentsCriteria _argumentsCriteria;
                private readonly PublishMethodInvocationImposterGroup _invocationImposterGroup;
                private PublishMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(PublishMethodImposter _imposter, PublishMethodInvocationHistoryCollection _publishMethodInvocationHistoryCollection, PublishArgumentsCriteria _argumentsCriteria)
                {
                    this._imposter = _imposter;
                    this._publishMethodInvocationHistoryCollection = _publishMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new PublishMethodInvocationImposterGroup(_argumentsCriteria);
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IPublishMethodInvocationImposterGroupContinuation IPublishMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((T payload, string category, int priority) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IPublishMethodInvocationImposterGroupContinuation IPublishMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((T payload, string category, int priority) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IPublishMethodInvocationImposterGroupContinuation IPublishMethodInvocationImposterGroup.Throws(PublishExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((T payload, string category, int priority) =>
                    {
                        throw exceptionGenerator.Invoke(payload, category, priority);
                    });
                    return this;
                }

                IPublishMethodInvocationImposterGroupContinuation IPublishMethodInvocationImposterGroupCallback.Callback(PublishCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IPublishMethodInvocationImposterGroup IPublishMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void PublishInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _publishMethodInvocationHistoryCollection.Count(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        // T IOpenGenericMethodTarget<T>.ResilientFetch()
        public delegate T ResilientFetchDelegate();
        // T IOpenGenericMethodTarget<T>.ResilientFetch()
        public delegate void ResilientFetchCallbackDelegate();
        // T IOpenGenericMethodTarget<T>.ResilientFetch()
        public delegate global::System.Exception ResilientFetchExceptionGeneratorDelegate();
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IResilientFetchMethodInvocationHistory
        {
            bool Matches();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ResilientFetchMethodInvocationHistory : IResilientFetchMethodInvocationHistory
        {
            internal T? Result;
            internal global::System.Exception? Exception;
            public ResilientFetchMethodInvocationHistory(T? Result, global::System.Exception? Exception)
            {
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches()
            {
                return true;
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ResilientFetchMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IResilientFetchMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IResilientFetchMethodInvocationHistory>();
            internal void Add(IResilientFetchMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count()
            {
                return _invocationHistory.Count(it => it.Matches());
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class ResilientFetchMethodInvocationImposterGroup
        {
            internal static ResilientFetchMethodInvocationImposterGroup Default = new ResilientFetchMethodInvocationImposterGroup();
            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public ResilientFetchMethodInvocationImposterGroup()
            {
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public T Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private ResilientFetchDelegate? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<ResilientFetchCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<ResilientFetchCallbackDelegate>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public T Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    T result = _resultGenerator.Invoke();
                    foreach (var callback in _callbacks)
                    {
                        callback();
                    }

                    return result;
                }

                internal void Callback(ResilientFetchCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(ResilientFetchDelegate resultGenerator)
                {
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(T value)
                {
                    _resultGenerator = () =>
                    {
                        return value;
                    };
                }

                internal void Throws(ResilientFetchExceptionGeneratorDelegate exceptionGenerator)
                {
                    _resultGenerator = () =>
                    {
                        throw exceptionGenerator();
                    };
                }

                internal static T DefaultResultGenerator()
                {
                    return default !;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IResilientFetchMethodInvocationImposterGroupCallback
        {
            IResilientFetchMethodInvocationImposterGroupContinuation Callback(ResilientFetchCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IResilientFetchMethodInvocationImposterGroupContinuation : IResilientFetchMethodInvocationImposterGroupCallback
        {
            IResilientFetchMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IResilientFetchMethodInvocationImposterGroup : IResilientFetchMethodInvocationImposterGroupCallback
        {
            IResilientFetchMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            IResilientFetchMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            IResilientFetchMethodInvocationImposterGroupContinuation Throws(ResilientFetchExceptionGeneratorDelegate exceptionGenerator);
            IResilientFetchMethodInvocationImposterGroupContinuation Returns(ResilientFetchDelegate resultGenerator);
            IResilientFetchMethodInvocationImposterGroupContinuation Returns(T value);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ResilientFetchInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IResilientFetchMethodImposterBuilder : IResilientFetchMethodInvocationImposterGroup, IResilientFetchMethodInvocationImposterGroupCallback, ResilientFetchInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ResilientFetchMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<ResilientFetchMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<ResilientFetchMethodInvocationImposterGroup>();
            private readonly ResilientFetchMethodInvocationHistoryCollection _resilientFetchMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public ResilientFetchMethodImposter(ResilientFetchMethodInvocationHistoryCollection _resilientFetchMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._resilientFetchMethodInvocationHistoryCollection = _resilientFetchMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup()
            {
                return FindMatchingInvocationImposterGroup() != null;
            }

            private ResilientFetchMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup()
            {
                if (_invocationImposters.TryPeek(out var invocationImposterGroup))
                    return invocationImposterGroup;
                else
                    return null;
            }

            public T Invoke()
            {
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup();
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("T IOpenGenericMethodTarget<T>.ResilientFetch()");
                    }

                    matchingInvocationImposterGroup = ResilientFetchMethodInvocationImposterGroup.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "T IOpenGenericMethodTarget<T>.ResilientFetch()");
                    _resilientFetchMethodInvocationHistoryCollection.Add(new ResilientFetchMethodInvocationHistory(result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _resilientFetchMethodInvocationHistoryCollection.Add(new ResilientFetchMethodInvocationHistory(default !, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IResilientFetchMethodImposterBuilder, IResilientFetchMethodInvocationImposterGroupContinuation
            {
                private readonly ResilientFetchMethodImposter _imposter;
                private readonly ResilientFetchMethodInvocationHistoryCollection _resilientFetchMethodInvocationHistoryCollection;
                private readonly ResilientFetchMethodInvocationImposterGroup _invocationImposterGroup;
                private ResilientFetchMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(ResilientFetchMethodImposter _imposter, ResilientFetchMethodInvocationHistoryCollection _resilientFetchMethodInvocationHistoryCollection)
                {
                    this._imposter = _imposter;
                    this._resilientFetchMethodInvocationHistoryCollection = _resilientFetchMethodInvocationHistoryCollection;
                    this._invocationImposterGroup = new ResilientFetchMethodInvocationImposterGroup();
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IResilientFetchMethodInvocationImposterGroupContinuation IResilientFetchMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws(() =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IResilientFetchMethodInvocationImposterGroupContinuation IResilientFetchMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws(() =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IResilientFetchMethodInvocationImposterGroupContinuation IResilientFetchMethodInvocationImposterGroup.Throws(ResilientFetchExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws(() =>
                    {
                        throw exceptionGenerator.Invoke();
                    });
                    return this;
                }

                IResilientFetchMethodInvocationImposterGroupContinuation IResilientFetchMethodInvocationImposterGroupCallback.Callback(ResilientFetchCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IResilientFetchMethodInvocationImposterGroupContinuation IResilientFetchMethodInvocationImposterGroup.Returns(ResilientFetchDelegate resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                IResilientFetchMethodInvocationImposterGroupContinuation IResilientFetchMethodInvocationImposterGroup.Returns(T value)
                {
                    _currentInvocationImposter.Returns(value);
                    return this;
                }

                IResilientFetchMethodInvocationImposterGroup IResilientFetchMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void ResilientFetchInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _resilientFetchMethodInvocationHistoryCollection.Count();
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        // bool IOpenGenericMethodTarget<T>.TryAdd(T value)
        public delegate bool TryAddDelegate(T value);
        // bool IOpenGenericMethodTarget<T>.TryAdd(T value)
        public delegate void TryAddCallbackDelegate(T value);
        // bool IOpenGenericMethodTarget<T>.TryAdd(T value)
        public delegate global::System.Exception TryAddExceptionGeneratorDelegate(T value);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class TryAddArguments
        {
            public T value;
            internal TryAddArguments(T value)
            {
                this.value = value;
            }
        }

        // bool IOpenGenericMethodTarget<T>.TryAdd(T value)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class TryAddArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<T> value { get; }

            public TryAddArgumentsCriteria(global::Imposter.Abstractions.Arg<T> value)
            {
                this.value = value;
            }

            public bool Matches(TryAddArguments arguments)
            {
                return value.Matches(arguments.value);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ITryAddMethodInvocationHistory
        {
            bool Matches(TryAddArgumentsCriteria criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class TryAddMethodInvocationHistory : ITryAddMethodInvocationHistory
        {
            internal TryAddArguments Arguments;
            internal bool? Result;
            internal global::System.Exception? Exception;
            public TryAddMethodInvocationHistory(TryAddArguments Arguments, bool? Result, global::System.Exception? Exception)
            {
                this.Arguments = Arguments;
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches(TryAddArgumentsCriteria criteria)
            {
                return criteria.Matches(Arguments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class TryAddMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<ITryAddMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<ITryAddMethodInvocationHistory>();
            internal void Add(ITryAddMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count(TryAddArgumentsCriteria argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches(argumentsCriteria));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class TryAddMethodInvocationImposterGroup
        {
            internal static TryAddMethodInvocationImposterGroup Default = new TryAddMethodInvocationImposterGroup(new TryAddArgumentsCriteria(global::Imposter.Abstractions.Arg<T>.Any()));
            internal TryAddArgumentsCriteria ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public TryAddMethodInvocationImposterGroup(TryAddArgumentsCriteria argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public bool Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, T value)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName, value);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private TryAddDelegate? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<TryAddCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<TryAddCallbackDelegate>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public bool Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, T value)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    bool result = _resultGenerator.Invoke(value);
                    foreach (var callback in _callbacks)
                    {
                        callback(value);
                    }

                    return result;
                }

                internal void Callback(TryAddCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(TryAddDelegate resultGenerator)
                {
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(bool value_1)
                {
                    _resultGenerator = (T value) =>
                    {
                        return value_1;
                    };
                }

                internal void Throws(TryAddExceptionGeneratorDelegate exceptionGenerator)
                {
                    _resultGenerator = (T value) =>
                    {
                        throw exceptionGenerator(value);
                    };
                }

                internal static bool DefaultResultGenerator(T value)
                {
                    return default !;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ITryAddMethodInvocationImposterGroupCallback
        {
            ITryAddMethodInvocationImposterGroupContinuation Callback(TryAddCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ITryAddMethodInvocationImposterGroupContinuation : ITryAddMethodInvocationImposterGroupCallback
        {
            ITryAddMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ITryAddMethodInvocationImposterGroup : ITryAddMethodInvocationImposterGroupCallback
        {
            ITryAddMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            ITryAddMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            ITryAddMethodInvocationImposterGroupContinuation Throws(TryAddExceptionGeneratorDelegate exceptionGenerator);
            ITryAddMethodInvocationImposterGroupContinuation Returns(TryAddDelegate resultGenerator);
            ITryAddMethodInvocationImposterGroupContinuation Returns(bool value);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface TryAddInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ITryAddMethodImposterBuilder : ITryAddMethodInvocationImposterGroup, ITryAddMethodInvocationImposterGroupCallback, TryAddInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class TryAddMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<TryAddMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<TryAddMethodInvocationImposterGroup>();
            private readonly TryAddMethodInvocationHistoryCollection _tryAddMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public TryAddMethodImposter(TryAddMethodInvocationHistoryCollection _tryAddMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._tryAddMethodInvocationHistoryCollection = _tryAddMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup(TryAddArguments arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private TryAddMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup(TryAddArguments arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public bool Invoke(T value)
            {
                var arguments = new TryAddArguments(value);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("bool IOpenGenericMethodTarget<T>.TryAdd(T value)");
                    }

                    matchingInvocationImposterGroup = TryAddMethodInvocationImposterGroup.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "bool IOpenGenericMethodTarget<T>.TryAdd(T value)", value);
                    _tryAddMethodInvocationHistoryCollection.Add(new TryAddMethodInvocationHistory(arguments, result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _tryAddMethodInvocationHistoryCollection.Add(new TryAddMethodInvocationHistory(arguments, default !, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : ITryAddMethodImposterBuilder, ITryAddMethodInvocationImposterGroupContinuation
            {
                private readonly TryAddMethodImposter _imposter;
                private readonly TryAddMethodInvocationHistoryCollection _tryAddMethodInvocationHistoryCollection;
                private readonly TryAddArgumentsCriteria _argumentsCriteria;
                private readonly TryAddMethodInvocationImposterGroup _invocationImposterGroup;
                private TryAddMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(TryAddMethodImposter _imposter, TryAddMethodInvocationHistoryCollection _tryAddMethodInvocationHistoryCollection, TryAddArgumentsCriteria _argumentsCriteria)
                {
                    this._imposter = _imposter;
                    this._tryAddMethodInvocationHistoryCollection = _tryAddMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new TryAddMethodInvocationImposterGroup(_argumentsCriteria);
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                ITryAddMethodInvocationImposterGroupContinuation ITryAddMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((T value) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                ITryAddMethodInvocationImposterGroupContinuation ITryAddMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((T value) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                ITryAddMethodInvocationImposterGroupContinuation ITryAddMethodInvocationImposterGroup.Throws(TryAddExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((T value) =>
                    {
                        throw exceptionGenerator.Invoke(value);
                    });
                    return this;
                }

                ITryAddMethodInvocationImposterGroupContinuation ITryAddMethodInvocationImposterGroupCallback.Callback(TryAddCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                ITryAddMethodInvocationImposterGroupContinuation ITryAddMethodInvocationImposterGroup.Returns(TryAddDelegate resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                ITryAddMethodInvocationImposterGroupContinuation ITryAddMethodInvocationImposterGroup.Returns(bool value_1)
                {
                    _currentInvocationImposter.Returns(value_1);
                    return this;
                }

                ITryAddMethodInvocationImposterGroup ITryAddMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void TryAddInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _tryAddMethodInvocationHistoryCollection.Count(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        public IOpenGenericMethodTargetImposter(global::Imposter.Abstractions.ImposterMode invocationBehavior = global::Imposter.Abstractions.ImposterMode.Implicit)
        {
            this._getNextMethodImposter = new GetNextMethodImposter(_getNextMethodInvocationHistoryCollection, invocationBehavior);
            this._tryAddMethodImposter = new TryAddMethodImposter(_tryAddMethodInvocationHistoryCollection, invocationBehavior);
            this._addMethodImposter = new AddMethodImposter(_addMethodInvocationHistoryCollection, invocationBehavior);
            this._countForMethodImposter = new CountForMethodImposter(_countForMethodInvocationHistoryCollection, invocationBehavior);
            this._resilientFetchMethodImposter = new ResilientFetchMethodImposter(_resilientFetchMethodInvocationHistoryCollection, invocationBehavior);
            this._publishMethodImposter = new PublishMethodImposter(_publishMethodInvocationHistoryCollection, invocationBehavior);
            this._imposterInstance = new ImposterTargetInstance(this);
            this._invocationBehavior = invocationBehavior;
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class ImposterTargetInstance : global::Imposter.Tests.Features.OpenGenericImposter.IOpenGenericMethodTarget<T>
        {
            private readonly IOpenGenericMethodTargetImposter<T> _imposter;
            public ImposterTargetInstance(IOpenGenericMethodTargetImposter<T> _imposter)
            {
                this._imposter = _imposter;
            }

            public T GetNext()
            {
                return _imposter._getNextMethodImposter.Invoke();
            }

            public bool TryAdd(T value)
            {
                return _imposter._tryAddMethodImposter.Invoke(value);
            }

            public void Add(T item, int index)
            {
                _imposter._addMethodImposter.Invoke(item, index);
            }

            public int CountFor(T item)
            {
                return _imposter._countForMethodImposter.Invoke(item);
            }

            public T ResilientFetch()
            {
                return _imposter._resilientFetchMethodImposter.Invoke();
            }

            public void Publish(T payload, string category, int priority)
            {
                _imposter._publishMethodImposter.Invoke(payload, category, priority);
            }
        }
    }
}
#nullable restore
#pragma warning restore
