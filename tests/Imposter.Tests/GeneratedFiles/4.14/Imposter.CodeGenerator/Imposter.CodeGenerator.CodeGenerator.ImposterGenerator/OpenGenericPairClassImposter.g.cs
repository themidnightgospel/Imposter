// <auto-generated />
#nullable enable
#pragma warning disable
using global::System;
using global::System.Linq;
using global::System.Collections.Generic;
using global::System.Threading.Tasks;
using global::System.Diagnostics;
using global::System.Runtime.CompilerServices;
using global::Imposter.Abstractions;
using global::System.Collections.Concurrent;
using global::Imposter.Tests.Features.OpenGenericImposter;

namespace Imposter.Tests.Features.OpenGenericImposter
{
    [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
    public sealed class OpenGenericPairClassImposter<TKey, TValue> : global::Imposter.Abstractions.IHaveImposterInstance<global::Imposter.Tests.Features.OpenGenericImposter.OpenGenericPairClass<TKey, TValue>> where TKey : class where TValue : class
    {
        private readonly ResolveMethodImposter _resolveMethodImposter;
        private readonly DescribePairMethodImposter _describePairMethodImposter;
        private readonly ResolveMethodInvocationHistoryCollection _resolveMethodInvocationHistoryCollection = new ResolveMethodInvocationHistoryCollection();
        private readonly DescribePairMethodInvocationHistoryCollection _describePairMethodInvocationHistoryCollection = new DescribePairMethodInvocationHistoryCollection();
        public IResolveMethodImposterBuilder Resolve(global::Imposter.Abstractions.Arg<TKey> key, global::Imposter.Abstractions.Arg<TValue> defaultValue)
        {
            return new ResolveMethodImposter.Builder(_resolveMethodImposter, _resolveMethodInvocationHistoryCollection, new ResolveArgumentsCriteria(key, defaultValue));
        }

        public IDescribePairMethodImposterBuilder DescribePair(global::Imposter.Abstractions.Arg<TKey> key, global::Imposter.Abstractions.Arg<TValue> value)
        {
            return new DescribePairMethodImposter.Builder(_describePairMethodImposter, _describePairMethodInvocationHistoryCollection, new DescribePairArgumentsCriteria(key, value));
        }

        private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
        private ImposterTargetInstance _imposterInstance;
        global::Imposter.Tests.Features.OpenGenericImposter.OpenGenericPairClass<TKey, TValue> global::Imposter.Abstractions.IHaveImposterInstance<global::Imposter.Tests.Features.OpenGenericImposter.OpenGenericPairClass<TKey, TValue>>.Instance()
        {
            return _imposterInstance;
        }

        // virtual string OpenGenericPairClass<TKey, TValue>.DescribePair(TKey key, TValue value)
        public delegate string DescribePairDelegate(TKey key, TValue value);
        // virtual string OpenGenericPairClass<TKey, TValue>.DescribePair(TKey key, TValue value)
        public delegate void DescribePairCallbackDelegate(TKey key, TValue value);
        // virtual string OpenGenericPairClass<TKey, TValue>.DescribePair(TKey key, TValue value)
        public delegate global::System.Exception DescribePairExceptionGeneratorDelegate(TKey key, TValue value);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class DescribePairArguments
        {
            public TKey key;
            public TValue value;
            internal DescribePairArguments(TKey key, TValue value)
            {
                this.key = key;
                this.value = value;
            }
        }

        // virtual string OpenGenericPairClass<TKey, TValue>.DescribePair(TKey key, TValue value)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class DescribePairArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<TKey> key { get; }
            public global::Imposter.Abstractions.Arg<TValue> value { get; }

            public DescribePairArgumentsCriteria(global::Imposter.Abstractions.Arg<TKey> key, global::Imposter.Abstractions.Arg<TValue> value)
            {
                this.key = key;
                this.value = value;
            }

            public bool Matches(DescribePairArguments arguments)
            {
                return key.Matches(arguments.key) && value.Matches(arguments.value);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IDescribePairMethodInvocationHistory
        {
            bool Matches(DescribePairArgumentsCriteria criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class DescribePairMethodInvocationHistory : IDescribePairMethodInvocationHistory
        {
            internal DescribePairArguments Arguments;
            internal string? Result;
            internal global::System.Exception? Exception;
            public DescribePairMethodInvocationHistory(DescribePairArguments Arguments, string? Result, global::System.Exception? Exception)
            {
                this.Arguments = Arguments;
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches(DescribePairArgumentsCriteria criteria)
            {
                return criteria.Matches(Arguments);
            }

            public override string ToString()
            {
                return "DescribePair(" + global::System.String.Join(", ", new[] { "key: " + FormatValue(Arguments.key), "value: " + FormatValue(Arguments.value) }) + ")" + " => " + FormatValue(Result) + (Exception == null ? "" : " threw " + FormatValue(Exception));
            }

            private static string FormatValue(object? value)
            {
                return "<" + (value?.ToString() ?? "null") + ">";
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class DescribePairMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IDescribePairMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IDescribePairMethodInvocationHistory>();
            internal void Add(IDescribePairMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count(DescribePairArgumentsCriteria argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches(argumentsCriteria));
            }

            public override string ToString()
            {
                return string.Join(Environment.NewLine, _invocationHistory.Select(invocation => invocation.ToString()));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class DescribePairMethodInvocationImposterGroup
        {
            internal static DescribePairMethodInvocationImposterGroup Default = new DescribePairMethodInvocationImposterGroup(new DescribePairArgumentsCriteria(global::Imposter.Abstractions.Arg<TKey>.Any(), global::Imposter.Abstractions.Arg<TValue>.Any()));
            internal DescribePairArgumentsCriteria ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public DescribePairMethodInvocationImposterGroup(DescribePairArgumentsCriteria argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public string Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, TKey key, TValue value, DescribePairDelegate? baseImplementation = null)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName, key, value, baseImplementation);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private DescribePairDelegate? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<DescribePairCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<DescribePairCallbackDelegate>();
                private bool _useBaseImplementation;
                internal bool IsEmpty => !_useBaseImplementation && ((_resultGenerator == null) && (_callbacks.Count == 0));

                public string Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, TKey key, TValue value, DescribePairDelegate? baseImplementation = null)
                {
                    if (_useBaseImplementation)
                    {
                        _resultGenerator = baseImplementation ?? throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    string result = _resultGenerator.Invoke(key, value);
                    foreach (var callback in _callbacks)
                    {
                        callback(key, value);
                    }

                    return result;
                }

                internal void Callback(DescribePairCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(DescribePairDelegate resultGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(string value_1)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (TKey key, TValue value) =>
                    {
                        return value_1;
                    };
                }

                internal void Throws(DescribePairExceptionGeneratorDelegate exceptionGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (TKey key, TValue value) =>
                    {
                        throw exceptionGenerator(key, value);
                    };
                }

                internal void UseBaseImplementation()
                {
                    _useBaseImplementation = true;
                    _resultGenerator = null;
                }

                internal static string DefaultResultGenerator(TKey key, TValue value)
                {
                    return default !;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IDescribePairMethodInvocationImposterGroupCallback
        {
            IDescribePairMethodInvocationImposterGroupContinuation Callback(DescribePairCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IDescribePairMethodInvocationImposterGroupContinuation : IDescribePairMethodInvocationImposterGroupCallback
        {
            IDescribePairMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IDescribePairMethodInvocationImposterGroup : IDescribePairMethodInvocationImposterGroupCallback
        {
            IDescribePairMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            IDescribePairMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            IDescribePairMethodInvocationImposterGroupContinuation Throws(DescribePairExceptionGeneratorDelegate exceptionGenerator);
            IDescribePairMethodInvocationImposterGroupContinuation Returns(DescribePairDelegate resultGenerator);
            IDescribePairMethodInvocationImposterGroupContinuation Returns(string value);
            IDescribePairMethodInvocationImposterGroupContinuation UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface DescribePairInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IDescribePairMethodImposterBuilder : IDescribePairMethodInvocationImposterGroup, IDescribePairMethodInvocationImposterGroupCallback, DescribePairInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class DescribePairMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<DescribePairMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<DescribePairMethodInvocationImposterGroup>();
            private readonly DescribePairMethodInvocationHistoryCollection _describePairMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public DescribePairMethodImposter(DescribePairMethodInvocationHistoryCollection _describePairMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._describePairMethodInvocationHistoryCollection = _describePairMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup(DescribePairArguments arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private DescribePairMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup(DescribePairArguments arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public string Invoke(TKey key, TValue value, DescribePairDelegate? baseImplementation = null)
            {
                var arguments = new DescribePairArguments(key, value);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("virtual string OpenGenericPairClass<TKey, TValue>.DescribePair(TKey key, TValue value)");
                    }

                    matchingInvocationImposterGroup = DescribePairMethodInvocationImposterGroup.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "virtual string OpenGenericPairClass<TKey, TValue>.DescribePair(TKey key, TValue value)", key, value, baseImplementation);
                    _describePairMethodInvocationHistoryCollection.Add(new DescribePairMethodInvocationHistory(arguments, result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _describePairMethodInvocationHistoryCollection.Add(new DescribePairMethodInvocationHistory(arguments, default !, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IDescribePairMethodImposterBuilder, IDescribePairMethodInvocationImposterGroupContinuation
            {
                private readonly DescribePairMethodImposter _imposter;
                private readonly DescribePairMethodInvocationHistoryCollection _describePairMethodInvocationHistoryCollection;
                private readonly DescribePairArgumentsCriteria _argumentsCriteria;
                private readonly DescribePairMethodInvocationImposterGroup _invocationImposterGroup;
                private DescribePairMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(DescribePairMethodImposter _imposter, DescribePairMethodInvocationHistoryCollection _describePairMethodInvocationHistoryCollection, DescribePairArgumentsCriteria _argumentsCriteria)
                {
                    this._imposter = _imposter;
                    this._describePairMethodInvocationHistoryCollection = _describePairMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new DescribePairMethodInvocationImposterGroup(_argumentsCriteria);
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IDescribePairMethodInvocationImposterGroupContinuation IDescribePairMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((TKey key, TValue value) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IDescribePairMethodInvocationImposterGroupContinuation IDescribePairMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((TKey key, TValue value) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IDescribePairMethodInvocationImposterGroupContinuation IDescribePairMethodInvocationImposterGroup.Throws(DescribePairExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((TKey key, TValue value) =>
                    {
                        throw exceptionGenerator.Invoke(key, value);
                    });
                    return this;
                }

                IDescribePairMethodInvocationImposterGroupContinuation IDescribePairMethodInvocationImposterGroupCallback.Callback(DescribePairCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IDescribePairMethodInvocationImposterGroupContinuation IDescribePairMethodInvocationImposterGroup.Returns(DescribePairDelegate resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                IDescribePairMethodInvocationImposterGroupContinuation IDescribePairMethodInvocationImposterGroup.Returns(string value_1)
                {
                    _currentInvocationImposter.Returns(value_1);
                    return this;
                }

                IDescribePairMethodInvocationImposterGroupContinuation IDescribePairMethodInvocationImposterGroup.UseBaseImplementation()
                {
                    _currentInvocationImposter.UseBaseImplementation();
                    return this;
                }

                IDescribePairMethodInvocationImposterGroup IDescribePairMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void DescribePairInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _describePairMethodInvocationHistoryCollection.Count(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount, _describePairMethodInvocationHistoryCollection.ToString());
                    }
                }
            }
        }

        // virtual TValue OpenGenericPairClass<TKey, TValue>.Resolve(TKey key, TValue defaultValue)
        public delegate TValue ResolveDelegate(TKey key, TValue defaultValue);
        // virtual TValue OpenGenericPairClass<TKey, TValue>.Resolve(TKey key, TValue defaultValue)
        public delegate void ResolveCallbackDelegate(TKey key, TValue defaultValue);
        // virtual TValue OpenGenericPairClass<TKey, TValue>.Resolve(TKey key, TValue defaultValue)
        public delegate global::System.Exception ResolveExceptionGeneratorDelegate(TKey key, TValue defaultValue);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class ResolveArguments
        {
            public TKey key;
            public TValue defaultValue;
            internal ResolveArguments(TKey key, TValue defaultValue)
            {
                this.key = key;
                this.defaultValue = defaultValue;
            }
        }

        // virtual TValue OpenGenericPairClass<TKey, TValue>.Resolve(TKey key, TValue defaultValue)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class ResolveArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<TKey> key { get; }
            public global::Imposter.Abstractions.Arg<TValue> defaultValue { get; }

            public ResolveArgumentsCriteria(global::Imposter.Abstractions.Arg<TKey> key, global::Imposter.Abstractions.Arg<TValue> defaultValue)
            {
                this.key = key;
                this.defaultValue = defaultValue;
            }

            public bool Matches(ResolveArguments arguments)
            {
                return key.Matches(arguments.key) && defaultValue.Matches(arguments.defaultValue);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IResolveMethodInvocationHistory
        {
            bool Matches(ResolveArgumentsCriteria criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ResolveMethodInvocationHistory : IResolveMethodInvocationHistory
        {
            internal ResolveArguments Arguments;
            internal TValue? Result;
            internal global::System.Exception? Exception;
            public ResolveMethodInvocationHistory(ResolveArguments Arguments, TValue? Result, global::System.Exception? Exception)
            {
                this.Arguments = Arguments;
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches(ResolveArgumentsCriteria criteria)
            {
                return criteria.Matches(Arguments);
            }

            public override string ToString()
            {
                return "Resolve(" + global::System.String.Join(", ", new[] { "key: " + FormatValue(Arguments.key), "defaultValue: " + FormatValue(Arguments.defaultValue) }) + ")" + " => " + FormatValue(Result) + (Exception == null ? "" : " threw " + FormatValue(Exception));
            }

            private static string FormatValue(object? value)
            {
                return "<" + (value?.ToString() ?? "null") + ">";
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ResolveMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IResolveMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IResolveMethodInvocationHistory>();
            internal void Add(IResolveMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count(ResolveArgumentsCriteria argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches(argumentsCriteria));
            }

            public override string ToString()
            {
                return string.Join(Environment.NewLine, _invocationHistory.Select(invocation => invocation.ToString()));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class ResolveMethodInvocationImposterGroup
        {
            internal static ResolveMethodInvocationImposterGroup Default = new ResolveMethodInvocationImposterGroup(new ResolveArgumentsCriteria(global::Imposter.Abstractions.Arg<TKey>.Any(), global::Imposter.Abstractions.Arg<TValue>.Any()));
            internal ResolveArgumentsCriteria ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public ResolveMethodInvocationImposterGroup(ResolveArgumentsCriteria argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public TValue Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, TKey key, TValue defaultValue, ResolveDelegate? baseImplementation = null)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName, key, defaultValue, baseImplementation);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private ResolveDelegate? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<ResolveCallbackDelegate> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<ResolveCallbackDelegate>();
                private bool _useBaseImplementation;
                internal bool IsEmpty => !_useBaseImplementation && ((_resultGenerator == null) && (_callbacks.Count == 0));

                public TValue Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, TKey key, TValue defaultValue, ResolveDelegate? baseImplementation = null)
                {
                    if (_useBaseImplementation)
                    {
                        _resultGenerator = baseImplementation ?? throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    TValue result = _resultGenerator.Invoke(key, defaultValue);
                    foreach (var callback in _callbacks)
                    {
                        callback(key, defaultValue);
                    }

                    return result;
                }

                internal void Callback(ResolveCallbackDelegate callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(ResolveDelegate resultGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(TValue value)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (TKey key, TValue defaultValue) =>
                    {
                        return value;
                    };
                }

                internal void Throws(ResolveExceptionGeneratorDelegate exceptionGenerator)
                {
                    _useBaseImplementation = false;
                    _resultGenerator = (TKey key, TValue defaultValue) =>
                    {
                        throw exceptionGenerator(key, defaultValue);
                    };
                }

                internal void UseBaseImplementation()
                {
                    _useBaseImplementation = true;
                    _resultGenerator = null;
                }

                internal static TValue DefaultResultGenerator(TKey key, TValue defaultValue)
                {
                    return default !;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IResolveMethodInvocationImposterGroupCallback
        {
            IResolveMethodInvocationImposterGroupContinuation Callback(ResolveCallbackDelegate callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IResolveMethodInvocationImposterGroupContinuation : IResolveMethodInvocationImposterGroupCallback
        {
            IResolveMethodInvocationImposterGroup Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IResolveMethodInvocationImposterGroup : IResolveMethodInvocationImposterGroupCallback
        {
            IResolveMethodInvocationImposterGroupContinuation Throws<TException>()
                where TException : global::System.Exception, new();
            IResolveMethodInvocationImposterGroupContinuation Throws(global::System.Exception exception);
            IResolveMethodInvocationImposterGroupContinuation Throws(ResolveExceptionGeneratorDelegate exceptionGenerator);
            IResolveMethodInvocationImposterGroupContinuation Returns(ResolveDelegate resultGenerator);
            IResolveMethodInvocationImposterGroupContinuation Returns(TValue value);
            IResolveMethodInvocationImposterGroupContinuation UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ResolveInvocationVerifier
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IResolveMethodImposterBuilder : IResolveMethodInvocationImposterGroup, IResolveMethodInvocationImposterGroupCallback, ResolveInvocationVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ResolveMethodImposter
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<ResolveMethodInvocationImposterGroup> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<ResolveMethodInvocationImposterGroup>();
            private readonly ResolveMethodInvocationHistoryCollection _resolveMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public ResolveMethodImposter(ResolveMethodInvocationHistoryCollection _resolveMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._resolveMethodInvocationHistoryCollection = _resolveMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            public bool HasMatchingInvocationImposterGroup(ResolveArguments arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private ResolveMethodInvocationImposterGroup? FindMatchingInvocationImposterGroup(ResolveArguments arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public TValue Invoke(TKey key, TValue defaultValue, ResolveDelegate? baseImplementation = null)
            {
                var arguments = new ResolveArguments(key, defaultValue);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("virtual TValue OpenGenericPairClass<TKey, TValue>.Resolve(TKey key, TValue defaultValue)");
                    }

                    matchingInvocationImposterGroup = ResolveMethodInvocationImposterGroup.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "virtual TValue OpenGenericPairClass<TKey, TValue>.Resolve(TKey key, TValue defaultValue)", key, defaultValue, baseImplementation);
                    _resolveMethodInvocationHistoryCollection.Add(new ResolveMethodInvocationHistory(arguments, result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _resolveMethodInvocationHistoryCollection.Add(new ResolveMethodInvocationHistory(arguments, default !, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IResolveMethodImposterBuilder, IResolveMethodInvocationImposterGroupContinuation
            {
                private readonly ResolveMethodImposter _imposter;
                private readonly ResolveMethodInvocationHistoryCollection _resolveMethodInvocationHistoryCollection;
                private readonly ResolveArgumentsCriteria _argumentsCriteria;
                private readonly ResolveMethodInvocationImposterGroup _invocationImposterGroup;
                private ResolveMethodInvocationImposterGroup.MethodInvocationImposter _currentInvocationImposter;
                public Builder(ResolveMethodImposter _imposter, ResolveMethodInvocationHistoryCollection _resolveMethodInvocationHistoryCollection, ResolveArgumentsCriteria _argumentsCriteria)
                {
                    this._imposter = _imposter;
                    this._resolveMethodInvocationHistoryCollection = _resolveMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new ResolveMethodInvocationImposterGroup(_argumentsCriteria);
                    _imposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IResolveMethodInvocationImposterGroupContinuation IResolveMethodInvocationImposterGroup.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((TKey key, TValue defaultValue) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IResolveMethodInvocationImposterGroupContinuation IResolveMethodInvocationImposterGroup.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((TKey key, TValue defaultValue) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IResolveMethodInvocationImposterGroupContinuation IResolveMethodInvocationImposterGroup.Throws(ResolveExceptionGeneratorDelegate exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((TKey key, TValue defaultValue) =>
                    {
                        throw exceptionGenerator.Invoke(key, defaultValue);
                    });
                    return this;
                }

                IResolveMethodInvocationImposterGroupContinuation IResolveMethodInvocationImposterGroupCallback.Callback(ResolveCallbackDelegate callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IResolveMethodInvocationImposterGroupContinuation IResolveMethodInvocationImposterGroup.Returns(ResolveDelegate resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                IResolveMethodInvocationImposterGroupContinuation IResolveMethodInvocationImposterGroup.Returns(TValue value)
                {
                    _currentInvocationImposter.Returns(value);
                    return this;
                }

                IResolveMethodInvocationImposterGroupContinuation IResolveMethodInvocationImposterGroup.UseBaseImplementation()
                {
                    _currentInvocationImposter.UseBaseImplementation();
                    return this;
                }

                IResolveMethodInvocationImposterGroup IResolveMethodInvocationImposterGroupContinuation.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void ResolveInvocationVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _resolveMethodInvocationHistoryCollection.Count(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount, _resolveMethodInvocationHistoryCollection.ToString());
                    }
                }
            }
        }

        public ICurrentPairPropertyBuilder CurrentPair => _CurrentPairPropertyBuilderField;

        private readonly CurrentPairPropertyBuilder _CurrentPairPropertyBuilderField;
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertyGetterOutcomeBuilder
        {
            ICurrentPairPropertyGetterContinuationBuilder Returns(global::System.Collections.Generic.KeyValuePair<TKey, TValue> value);
            ICurrentPairPropertyGetterContinuationBuilder Returns(global::System.Func<global::System.Collections.Generic.KeyValuePair<TKey, TValue>> valueGenerator);
            ICurrentPairPropertyGetterContinuationBuilder Throws(global::System.Exception exception);
            ICurrentPairPropertyGetterContinuationBuilder Throws<TException>()
                where TException : Exception, new();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertyGetterCallbackBuilder
        {
            ICurrentPairPropertyGetterContinuationBuilder Callback(global::System.Action callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertyGetterContinuationBuilder : ICurrentPairPropertyGetterCallbackBuilder
        {
            ICurrentPairPropertyGetterFluentBuilder Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertyGetterVerifier
        {
            void Called(global::Imposter.Abstractions.Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertyGetterFluentBuilder : ICurrentPairPropertyGetterOutcomeBuilder, ICurrentPairPropertyGetterContinuationBuilder
        {
            ICurrentPairPropertyGetterFluentBuilder UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertyGetterBuilder : ICurrentPairPropertyGetterOutcomeBuilder, ICurrentPairPropertyGetterCallbackBuilder, ICurrentPairPropertyGetterVerifier, ICurrentPairPropertyGetterUseBaseImplementationBuilder
        {
            ICurrentPairPropertyGetterUseBaseImplementationBuilder Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertyGetterUseBaseImplementationBuilder
        {
            ICurrentPairPropertyGetterFluentBuilder UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertySetterCallbackBuilder
        {
            ICurrentPairPropertySetterContinuationBuilder Callback(global::System.Action<global::System.Collections.Generic.KeyValuePair<TKey, TValue>> callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertySetterContinuationBuilder : ICurrentPairPropertySetterCallbackBuilder
        {
            ICurrentPairPropertySetterUseBaseImplementationBuilder Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertySetterFluentBuilder : ICurrentPairPropertySetterCallbackBuilder, ICurrentPairPropertySetterContinuationBuilder
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertySetterVerifier
        {
            void Called(global::Imposter.Abstractions.Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertySetterBuilder : ICurrentPairPropertySetterCallbackBuilder, ICurrentPairPropertySetterVerifier, ICurrentPairPropertySetterUseBaseImplementationBuilder
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertySetterUseBaseImplementationBuilder : ICurrentPairPropertySetterFluentBuilder
        {
            ICurrentPairPropertySetterFluentBuilder UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ICurrentPairPropertyBuilder
        {
            ICurrentPairPropertyGetterBuilder Getter();
            ICurrentPairPropertySetterBuilder Setter(global::Imposter.Abstractions.Arg<global::System.Collections.Generic.KeyValuePair<TKey, TValue>> criteria);
            ICurrentPairPropertyBuilder UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class CurrentPairPropertyBuilder : ICurrentPairPropertyBuilder
        {
            private readonly DefaultPropertyBehaviour _defaultPropertyBehaviour;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            internal SetterImposter _setterImposter;
            internal GetterImposterBuilder _getterImposterBuilder;
            internal CurrentPairPropertyBuilder(global::Imposter.Abstractions.ImposterMode invocationBehavior)
            {
                _defaultPropertyBehaviour = new DefaultPropertyBehaviour();
                _invocationBehavior = invocationBehavior;
                _getterImposterBuilder = new GetterImposterBuilder(_defaultPropertyBehaviour, _invocationBehavior, "Imposter.Tests.Features.OpenGenericImposter.OpenGenericPairClass<TKey, TValue>.CurrentPair");
                _setterImposter = new SetterImposter(_defaultPropertyBehaviour, _invocationBehavior, "Imposter.Tests.Features.OpenGenericImposter.OpenGenericPairClass<TKey, TValue>.CurrentPair");
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class DefaultPropertyBehaviour
            {
                internal volatile bool IsOn = true;
                internal volatile bool HasValueSet = false;
                internal global::System.Collections.Generic.KeyValuePair<TKey, TValue> BackingField = default !;
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class GetterImposterBuilder : ICurrentPairPropertyGetterBuilder, ICurrentPairPropertyGetterFluentBuilder, ICurrentPairPropertyGetterUseBaseImplementationBuilder
            {
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<global::System.Func<global::System.Func<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>?, global::System.Collections.Generic.KeyValuePair<TKey, TValue>>> _returnValues = new global::System.Collections.Concurrent.ConcurrentQueue<global::System.Func<global::System.Func<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>?, global::System.Collections.Generic.KeyValuePair<TKey, TValue>>>();
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<global::System.Action> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<global::System.Action>();
                private volatile global::System.Func<global::System.Func<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>?, global::System.Collections.Generic.KeyValuePair<TKey, TValue>> _lastReturnValue = _ => default !;
                private int _invocationCount;
                private readonly DefaultPropertyBehaviour _defaultPropertyBehaviour;
                private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
                private readonly string _propertyDisplayName;
                private bool _hasConfiguredReturn;
                internal GetterImposterBuilder(DefaultPropertyBehaviour _defaultPropertyBehaviour, global::Imposter.Abstractions.ImposterMode invocationBehavior, string propertyDisplayName)
                {
                    this._defaultPropertyBehaviour = _defaultPropertyBehaviour;
                    this._invocationBehavior = invocationBehavior;
                    this._propertyDisplayName = propertyDisplayName;
                }

                private void AddReturnValue(global::System.Func<global::System.Func<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>?, global::System.Collections.Generic.KeyValuePair<TKey, TValue>> valueGenerator)
                {
                    _defaultPropertyBehaviour.IsOn = false;
                    _returnValues.Enqueue(valueGenerator);
                    _hasConfiguredReturn = true;
                }

                ICurrentPairPropertyGetterContinuationBuilder ICurrentPairPropertyGetterOutcomeBuilder.Returns(global::System.Collections.Generic.KeyValuePair<TKey, TValue> value)
                {
                    AddReturnValue((_) => value);
                    return this;
                }

                ICurrentPairPropertyGetterContinuationBuilder ICurrentPairPropertyGetterOutcomeBuilder.Returns(global::System.Func<global::System.Collections.Generic.KeyValuePair<TKey, TValue>> valueGenerator)
                {
                    AddReturnValue((_) => valueGenerator());
                    return this;
                }

                ICurrentPairPropertyGetterContinuationBuilder ICurrentPairPropertyGetterOutcomeBuilder.Throws(global::System.Exception exception)
                {
                    AddReturnValue((_) => throw exception);
                    return this;
                }

                ICurrentPairPropertyGetterContinuationBuilder ICurrentPairPropertyGetterOutcomeBuilder.Throws<TException>()
                {
                    AddReturnValue((_) => throw new TException());
                    return this;
                }

                ICurrentPairPropertyGetterContinuationBuilder ICurrentPairPropertyGetterCallbackBuilder.Callback(global::System.Action callback)
                {
                    _callbacks.Enqueue(callback);
                    return this;
                }

                void ICurrentPairPropertyGetterVerifier.Called(global::Imposter.Abstractions.Count count)
                {
                    if (!count.Matches(_invocationCount))
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, _invocationCount);
                }

                ICurrentPairPropertyGetterFluentBuilder ICurrentPairPropertyGetterContinuationBuilder.Then()
                {
                    return this;
                }

                ICurrentPairPropertyGetterUseBaseImplementationBuilder ICurrentPairPropertyGetterBuilder.Then()
                {
                    return this;
                }

                internal void EnableBaseImplementation()
                {
                    AddReturnValue((global::System.Func<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>? baseImplementation) =>
                    {
                        if (baseImplementation != null)
                            return baseImplementation();
                        else
                            throw new global::Imposter.Abstractions.MissingImposterException(_propertyDisplayName + " (getter)");
                    });
                }

                ICurrentPairPropertyGetterFluentBuilder ICurrentPairPropertyGetterUseBaseImplementationBuilder.UseBaseImplementation()
                {
                    EnableBaseImplementation();
                    return this;
                }

                ICurrentPairPropertyGetterFluentBuilder ICurrentPairPropertyGetterFluentBuilder.UseBaseImplementation()
                {
                    EnableBaseImplementation();
                    return this;
                }

                internal global::System.Collections.Generic.KeyValuePair<TKey, TValue> Get(global::System.Func<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>? baseImplementation = null)
                {
                    EnsureGetterConfigured();
                    global::System.Threading.Interlocked.Increment(ref _invocationCount);
                    foreach (var getterCallback in _callbacks)
                    {
                        getterCallback();
                    }

                    if (_defaultPropertyBehaviour.IsOn)
                    {
                        if (((_invocationCount == 1) && (baseImplementation != null)) && !_defaultPropertyBehaviour.HasValueSet)
                        {
                            _defaultPropertyBehaviour.BackingField = baseImplementation();
                        }

                        return _defaultPropertyBehaviour.BackingField;
                    }

                    var nextReturnValue = _lastReturnValue;
                    if (_returnValues.TryDequeue(out var returnValue) && (returnValue != null))
                    {
                        nextReturnValue = returnValue;
                        _lastReturnValue = returnValue;
                    }

                    return nextReturnValue(baseImplementation);
                }

                private void EnsureGetterConfigured()
                {
                    if ((_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit) && !_hasConfiguredReturn)
                        throw new global::Imposter.Abstractions.MissingImposterException(_propertyDisplayName + " (getter)");
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class SetterImposter
            {
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<global::System.Tuple<global::Imposter.Abstractions.Arg<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>, global::System.Action<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>>> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<global::System.Tuple<global::Imposter.Abstractions.Arg<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>, global::System.Action<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>>>();
                private readonly global::System.Collections.Concurrent.ConcurrentStack<global::System.Collections.Generic.KeyValuePair<TKey, TValue>> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>();
                private readonly DefaultPropertyBehaviour _defaultPropertyBehaviour;
                private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
                private readonly string _propertyDisplayName;
                private bool _hasConfiguredSetter;
                private bool _useBaseImplementation;
                internal SetterImposter(DefaultPropertyBehaviour _defaultPropertyBehaviour, global::Imposter.Abstractions.ImposterMode invocationBehavior, string propertyDisplayName)
                {
                    this._defaultPropertyBehaviour = _defaultPropertyBehaviour;
                    this._invocationBehavior = invocationBehavior;
                    this._propertyDisplayName = propertyDisplayName;
                }

                internal void Callback(global::Imposter.Abstractions.Arg<global::System.Collections.Generic.KeyValuePair<TKey, TValue>> criteria, global::System.Action<global::System.Collections.Generic.KeyValuePair<TKey, TValue>> callback)
                {
                    _callbacks.Enqueue(new global::System.Tuple<global::Imposter.Abstractions.Arg<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>, global::System.Action<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>>(criteria, callback));
                }

                void Called(global::Imposter.Abstractions.Arg<global::System.Collections.Generic.KeyValuePair<TKey, TValue>> criteria, global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _invocationHistory.Count(criteria.Matches);
                    if (!count.Matches(invocationCount))
                    {
                        var performedInvocations = new global::System.Collections.Generic.List<string>();
                        foreach (var value in _invocationHistory)
                        {
                            performedInvocations.Add("set " + _propertyDisplayName + " = " + FormatValue(value));
                        }

                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount, string.Join(Environment.NewLine, performedInvocations));
                    }
                }

                internal void UseBaseImplementation()
                {
                    _hasConfiguredSetter = true;
                    _useBaseImplementation = true;
                }

                internal void Set(global::System.Collections.Generic.KeyValuePair<TKey, TValue> value, global::System.Action<global::System.Collections.Generic.KeyValuePair<TKey, TValue>>? baseImplementation = null)
                {
                    EnsureSetterConfigured();
                    _invocationHistory.Push(value);
                    foreach (var(criteria, setterCallback)in _callbacks)
                    {
                        if (criteria.Matches(value))
                            setterCallback(value);
                    }

                    if (_useBaseImplementation)
                    {
                        if (baseImplementation != null)
                        {
                            baseImplementation(value);
                            return;
                        }
                        else
                            throw new global::Imposter.Abstractions.MissingImposterException(_propertyDisplayName + " (setter)");
                    }

                    if (_defaultPropertyBehaviour.IsOn)
                    {
                        _defaultPropertyBehaviour.BackingField = value;
                        _defaultPropertyBehaviour.HasValueSet = true;
                    }
                }

                private void EnsureSetterConfigured()
                {
                    if ((_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit) && !_hasConfiguredSetter)
                        throw new global::Imposter.Abstractions.MissingImposterException(_propertyDisplayName + " (setter)");
                }

                internal void MarkConfigured()
                {
                    _hasConfiguredSetter = true;
                }

                private static string FormatValue(object? value)
                {
                    return "<" + (value?.ToString() ?? "null") + ">";
                }

                [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
                internal class Builder : ICurrentPairPropertySetterBuilder, ICurrentPairPropertySetterFluentBuilder, ICurrentPairPropertySetterUseBaseImplementationBuilder
                {
                    private readonly SetterImposter _setterImposter;
                    private readonly global::Imposter.Abstractions.Arg<global::System.Collections.Generic.KeyValuePair<TKey, TValue>> _criteria;
                    internal Builder(SetterImposter _setterImposter, global::Imposter.Abstractions.Arg<global::System.Collections.Generic.KeyValuePair<TKey, TValue>> _criteria)
                    {
                        this._setterImposter = _setterImposter;
                        this._criteria = _criteria;
                    }

                    ICurrentPairPropertySetterContinuationBuilder ICurrentPairPropertySetterCallbackBuilder.Callback(global::System.Action<global::System.Collections.Generic.KeyValuePair<TKey, TValue>> callback)
                    {
                        _setterImposter.Callback(_criteria, callback);
                        return this;
                    }

                    void ICurrentPairPropertySetterVerifier.Called(global::Imposter.Abstractions.Count count)
                    {
                        _setterImposter.Called(_criteria, count);
                    }

                    ICurrentPairPropertySetterUseBaseImplementationBuilder ICurrentPairPropertySetterContinuationBuilder.Then()
                    {
                        return this;
                    }

                    ICurrentPairPropertySetterFluentBuilder ICurrentPairPropertySetterUseBaseImplementationBuilder.UseBaseImplementation()
                    {
                        _setterImposter.UseBaseImplementation();
                        return this;
                    }
                }
            }

            ICurrentPairPropertyGetterBuilder ICurrentPairPropertyBuilder.Getter()
            {
                return _getterImposterBuilder;
            }

            ICurrentPairPropertySetterBuilder ICurrentPairPropertyBuilder.Setter(global::Imposter.Abstractions.Arg<global::System.Collections.Generic.KeyValuePair<TKey, TValue>> criteria)
            {
                _setterImposter.MarkConfigured();
                return new SetterImposter.Builder(_setterImposter, criteria);
            }

            ICurrentPairPropertyBuilder ICurrentPairPropertyBuilder.UseBaseImplementation()
            {
                _getterImposterBuilder.EnableBaseImplementation();
                _setterImposter.UseBaseImplementation();
                return this;
            }
        }

        private readonly IndexerIndexerBuilder _IndexerIndexer;
        public IIndexerIndexerBuilder this[global::Imposter.Abstractions.Arg<TKey> key] => new IndexerIndexerBuilder.InvocationBuilder(_IndexerIndexer, new IndexerIndexerArgumentsCriteria(key));
        public delegate TValue IndexerIndexerDelegate(TKey key);
        public delegate void IndexerIndexerGetterCallback(TKey key);
        public delegate void IndexerIndexerSetterCallback(TKey key, TValue value);
        public delegate global::System.Exception IndexerIndexerExceptionGenerator(TKey key);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class IndexerIndexerArguments : global::System.IEquatable<IndexerIndexerArguments>
        {
            public TKey key;
            internal IndexerIndexerArguments(TKey key)
            {
                this.key = key;
            }

            public bool Equals(IndexerIndexerArguments? other)
            {
                if (other == null)
                {
                    return false;
                }

                return true && (key == other.key);
            }

            public override bool Equals(object? obj)
            {
                return obj is IndexerIndexerArguments other && Equals(other);
            }

            public override int GetHashCode()
            {
                global::System.HashCode hash = new global::System.HashCode();
                hash.Add(key);
                return hash.ToHashCode();
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class IndexerIndexerArgumentsCriteria
        {
            public global::Imposter.Abstractions.Arg<TKey> key;
            internal IndexerIndexerArgumentsCriteria(global::Imposter.Abstractions.Arg<TKey> key)
            {
                this.key = key;
            }

            public bool Matches(IndexerIndexerArguments arguments)
            {
                return key.Matches(arguments.key);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class IndexerIndexerBuilder
        {
            private readonly DefaultIndexerIndexerBehaviour _IndexerDefaultIndexerBehaviour = new DefaultIndexerIndexerBehaviour();
            private readonly GetterImposter _getterImposter;
            private readonly SetterImposter _setterImposter;
            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class DefaultIndexerIndexerBehaviour
            {
                private bool _isOn = true;
                internal bool IsOn
                {
                    get
                    {
                        return global::System.Threading.Volatile.Read(ref _isOn);
                    }

                    set
                    {
                        global::System.Threading.Volatile.Write(ref _isOn, value);
                    }
                }

                internal global::System.Collections.Concurrent.ConcurrentDictionary<IndexerIndexerArguments, TValue> BackingField = new global::System.Collections.Concurrent.ConcurrentDictionary<IndexerIndexerArguments, TValue>();
                internal TValue Get(IndexerIndexerArguments arguments, global::System.Func<TValue>? baseImplementation = null)
                {
                    if (BackingField.TryGetValue(arguments, out var value))
                        return value;
                    if (baseImplementation != null)
                        return baseImplementation();
                    return default !;
                }

                internal void Set(IndexerIndexerArguments arguments, TValue value, global::System.Action? baseImplementation = null)
                {
                    if (baseImplementation != null)
                    {
                        baseImplementation();
                        return;
                    }

                    BackingField[arguments] = value;
                }
            }

            internal IndexerIndexerBuilder(global::Imposter.Abstractions.ImposterMode invocationBehavior, string propertyDisplayName)
            {
                this._getterImposter = new GetterImposter(_IndexerDefaultIndexerBehaviour, invocationBehavior, propertyDisplayName);
                this._setterImposter = new SetterImposter(_IndexerDefaultIndexerBehaviour, invocationBehavior, propertyDisplayName);
            }

            internal IIndexerIndexerGetterBuilder CreateGetter(IndexerIndexerArgumentsCriteria criteria)
            {
                return new GetterImposter.Builder(_getterImposter, criteria);
            }

            internal IIndexerIndexerSetterBuilder CreateSetter(IndexerIndexerArgumentsCriteria criteria)
            {
                _setterImposter.MarkConfigured();
                return new SetterImposter.Builder(_setterImposter, criteria);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class InvocationBuilder : IIndexerIndexerBuilder
            {
                private readonly IndexerIndexerBuilder _builder;
                private readonly IndexerIndexerArgumentsCriteria _criteria;
                internal InvocationBuilder(IndexerIndexerBuilder builder, IndexerIndexerArgumentsCriteria criteria)
                {
                    this._builder = builder;
                    this._criteria = criteria;
                }

                public IIndexerIndexerGetterBuilder Getter()
                {
                    return _builder.CreateGetter(_criteria);
                }

                public IIndexerIndexerSetterBuilder Setter()
                {
                    return _builder.CreateSetter(_criteria);
                }
            }

            internal TValue Get(TKey key, global::System.Func<TValue>? baseImplementation = null)
            {
                return _getterImposter.Get(key, baseImplementation);
            }

            internal void Set(TKey key, TValue value, global::System.Action? baseImplementation = null)
            {
                _setterImposter.Set(key, value, baseImplementation);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            private sealed class GetterImposter
            {
                private readonly DefaultIndexerIndexerBehaviour _defaultBehaviour;
                private readonly global::System.Collections.Concurrent.ConcurrentStack<GetterInvocationImposter> _getterInvocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<GetterInvocationImposter>();
                private readonly global::System.Collections.Concurrent.ConcurrentDictionary<IndexerIndexerArgumentsCriteria, GetterInvocationImposter> _setupLookup = new global::System.Collections.Concurrent.ConcurrentDictionary<IndexerIndexerArgumentsCriteria, GetterInvocationImposter>();
                private readonly global::System.Collections.Concurrent.ConcurrentStack<IndexerIndexerArguments> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IndexerIndexerArguments>();
                private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
                private readonly string _propertyDisplayName;
                private bool _hasConfiguredReturn;
                internal GetterImposter(DefaultIndexerIndexerBehaviour defaultBehaviour, global::Imposter.Abstractions.ImposterMode invocationBehavior, string propertyDisplayName)
                {
                    this._defaultBehaviour = defaultBehaviour;
                    this._invocationBehavior = invocationBehavior;
                    this._propertyDisplayName = propertyDisplayName;
                }

                internal TValue Get(TKey key, global::System.Func<TValue>? baseImplementation = null)
                {
                    IndexerIndexerArguments arguments = new IndexerIndexerArguments(key);
                    try
                    {
                        var getterInvocationImposter = FindGetterInvocationImposter(arguments);
                        if (getterInvocationImposter is null)
                        {
                            EnsureGetterConfigured();
                            if (_defaultBehaviour.IsOn)
                                return _defaultBehaviour.Get(arguments, baseImplementation);
                            if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                            {
                                throw new global::Imposter.Abstractions.MissingImposterException(_propertyDisplayName + " (getter)");
                            }
                            else
                            {
                                return default !;
                            }
                        }

                        return getterInvocationImposter.Invoke(arguments, baseImplementation);
                    }
                    finally
                    {
                        _invocationHistory.Push(arguments);
                    }
                }

                private GetterInvocationImposter? FindGetterInvocationImposter(IndexerIndexerArguments arguments)
                {
                    foreach (var getterInvocationImposter in _getterInvocationImposters)
                    {
                        if (getterInvocationImposter.Criteria.Matches(arguments))
                        {
                            return getterInvocationImposter;
                        }
                    }

                    return null;
                }

                private GetterInvocationImposter GetOrCreate(IndexerIndexerArgumentsCriteria criteria)
                {
                    return _setupLookup.GetOrAdd(criteria, CreateSetup);
                    GetterInvocationImposter CreateSetup(IndexerIndexerArgumentsCriteria key)
                    {
                        GetterInvocationImposter getterInvocationImposter = new GetterInvocationImposter(this, _defaultBehaviour, key);
                        _getterInvocationImposters.Push(getterInvocationImposter);
                        return getterInvocationImposter;
                    }
                }

                private void Called(IndexerIndexerArgumentsCriteria criteria, global::Imposter.Abstractions.Count count)
                {
                    int invocationCount = _invocationHistory.Count(criteria.Matches);
                    if (!count.Matches(invocationCount))
                    {
                        var performedInvocations = new global::System.Collections.Generic.List<string>();
                        foreach (var entry in _invocationHistory)
                        {
                            performedInvocations.Add("get " + _propertyDisplayName + "[" + string.Join(", ", new[] { FormatValue(entry.key) }) + "]");
                        }

                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount, string.Join(Environment.NewLine, performedInvocations));
                    }
                }

                internal string PropertyDisplayName => _propertyDisplayName;

                internal void MarkReturnConfigured()
                {
                    global::System.Threading.Volatile.Write(ref _hasConfiguredReturn, true);
                }

                private void EnsureGetterConfigured()
                {
                    if ((_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit) && !global::System.Threading.Volatile.Read(ref _hasConfiguredReturn))
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(_propertyDisplayName + " (getter)");
                    }
                }

                [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
                internal class Builder : IIndexerIndexerGetterBuilder, IIndexerIndexerGetterFluentBuilder
                {
                    private readonly GetterImposter _imposter;
                    private readonly IndexerIndexerArgumentsCriteria _criteria;
                    internal Builder(GetterImposter _imposter, IndexerIndexerArgumentsCriteria _criteria)
                    {
                        this._imposter = _imposter;
                        this._criteria = _criteria;
                    }

                    private GetterInvocationImposter InvocationImposter => _imposter.GetOrCreate(_criteria);

                    IIndexerIndexerGetterContinuationBuilder IIndexerIndexerGetterOutcomeBuilder.Returns(TValue value)
                    {
                        InvocationImposter.AddReturnValue(arguments => value);
                        return this;
                    }

                    IIndexerIndexerGetterContinuationBuilder IIndexerIndexerGetterOutcomeBuilder.Returns(global::System.Func<TValue> valueGenerator)
                    {
                        InvocationImposter.AddReturnValue(arguments => valueGenerator());
                        return this;
                    }

                    IIndexerIndexerGetterContinuationBuilder IIndexerIndexerGetterOutcomeBuilder.Returns(IndexerIndexerDelegate valueGenerator)
                    {
                        InvocationImposter.AddReturnValue(arguments => valueGenerator(arguments.key));
                        return this;
                    }

                    IIndexerIndexerGetterContinuationBuilder IIndexerIndexerGetterOutcomeBuilder.Throws(global::System.Exception exception)
                    {
                        InvocationImposter.AddReturnValue(arguments => throw exception);
                        return this;
                    }

                    IIndexerIndexerGetterContinuationBuilder IIndexerIndexerGetterOutcomeBuilder.Throws<TException>()
                    {
                        InvocationImposter.AddReturnValue(arguments => throw new TException());
                        return this;
                    }

                    IIndexerIndexerGetterContinuationBuilder IIndexerIndexerGetterOutcomeBuilder.Throws(IndexerIndexerExceptionGenerator exceptionGenerator)
                    {
                        InvocationImposter.AddReturnValue(arguments => throw exceptionGenerator(arguments.key));
                        return this;
                    }

                    IIndexerIndexerGetterContinuationBuilder IIndexerIndexerGetterCallbackBuilder.Callback(IndexerIndexerGetterCallback callback)
                    {
                        InvocationImposter.AddCallback(callback);
                        return this;
                    }

                    void IIndexerIndexerGetterVerifier.Called(global::Imposter.Abstractions.Count count)
                    {
                        _imposter.Called(_criteria, count);
                    }

                    IIndexerIndexerGetterFluentBuilder IIndexerIndexerGetterContinuationBuilder.Then()
                    {
                        return this;
                    }

                    IIndexerIndexerGetterContinuationBuilder IIndexerIndexerGetterOutcomeBuilder.UseBaseImplementation()
                    {
                        InvocationImposter.UseBaseImplementation();
                        return this;
                    }
                }

                [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
                private sealed class GetterInvocationImposter
                {
                    private readonly GetterImposter _parent;
                    private readonly DefaultIndexerIndexerBehaviour _defaultBehaviour;
                    private readonly global::System.Collections.Concurrent.ConcurrentQueue<global::System.Func<IndexerIndexerArguments, global::System.Func<TValue>?, TValue>> _returnValues = new global::System.Collections.Concurrent.ConcurrentQueue<global::System.Func<IndexerIndexerArguments, global::System.Func<TValue>?, TValue>>();
                    private readonly global::System.Collections.Concurrent.ConcurrentQueue<IndexerIndexerGetterCallback> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<IndexerIndexerGetterCallback>();
                    private volatile global::System.Func<IndexerIndexerArguments, global::System.Func<TValue>?, TValue>? _lastReturnValue;
                    private int _invocationCount;
                    private string _propertyDisplayName;
                    internal IndexerIndexerArgumentsCriteria Criteria { get; private set; }
                    internal int InvocationCount => global::System.Threading.Volatile.Read(ref _invocationCount);

                    internal GetterInvocationImposter(GetterImposter parent, DefaultIndexerIndexerBehaviour defaultBehaviour, IndexerIndexerArgumentsCriteria criteria)
                    {
                        this._parent = parent;
                        this._defaultBehaviour = defaultBehaviour;
                        this._propertyDisplayName = parent.PropertyDisplayName;
                        this.Criteria = criteria;
                    }

                    internal void AddReturnValue(global::System.Func<IndexerIndexerArguments, TValue> generator)
                    {
                        _defaultBehaviour.IsOn = false;
                        _returnValues.Enqueue((arguments, baseImplementation) => generator(arguments));
                        _parent.MarkReturnConfigured();
                    }

                    internal void AddCallback(IndexerIndexerGetterCallback callback)
                    {
                        _callbacks.Enqueue(callback);
                    }

                    internal TValue Invoke(IndexerIndexerArguments arguments, global::System.Func<TValue>? baseImplementation = null)
                    {
                        global::System.Threading.Interlocked.Increment(ref _invocationCount);
                        foreach (var callback in _callbacks)
                        {
                            callback(arguments.key);
                        }

                        global::System.Func<IndexerIndexerArguments, global::System.Func<TValue>?, TValue> generator = ResolveNextGenerator(arguments);
                        return generator(arguments, baseImplementation);
                    }

                    private global::System.Func<IndexerIndexerArguments, global::System.Func<TValue>?, TValue> ResolveNextGenerator(IndexerIndexerArguments arguments)
                    {
                        if (_defaultBehaviour.IsOn)
                        {
                            return (arguments, baseImplementation) => _defaultBehaviour.Get(arguments, baseImplementation);
                        }

                        _returnValues.TryDequeue(out var returnValue);
                        var nextReturnValue = returnValue ?? _lastReturnValue;
                        if (nextReturnValue == null)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(_propertyDisplayName + " (getter)");
                        }

                        _lastReturnValue = nextReturnValue;
                        return nextReturnValue!;
                    }

                    internal void UseBaseImplementation()
                    {
                        _parent.MarkReturnConfigured();
                        _defaultBehaviour.IsOn = false;
                        _returnValues.Enqueue((arguments, baseImplementation) =>
                        {
                            if (baseImplementation == null)
                            {
                                throw new global::Imposter.Abstractions.MissingImposterException(_propertyDisplayName + " (getter)");
                            }

                            return baseImplementation();
                        });
                        _lastReturnValue = null;
                    }
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            private sealed class SetterImposter
            {
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<(IndexerIndexerArgumentsCriteria Criteria, IndexerIndexerSetterCallback Callback)> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<(IndexerIndexerArgumentsCriteria Criteria, IndexerIndexerSetterCallback Callback)>();
                private readonly global::System.Collections.Concurrent.ConcurrentStack<(IndexerIndexerArguments Arguments, TValue Value)> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<(IndexerIndexerArguments Arguments, TValue Value)>();
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<IndexerIndexerArgumentsCriteria> _baseCriteria = new global::System.Collections.Concurrent.ConcurrentQueue<IndexerIndexerArgumentsCriteria>();
                private readonly DefaultIndexerIndexerBehaviour _defaultBehaviour;
                private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
                private readonly string _propertyDisplayName;
                private bool _hasConfiguredSetter;
                internal SetterImposter(DefaultIndexerIndexerBehaviour defaultBehaviour, global::Imposter.Abstractions.ImposterMode invocationBehavior, string propertyDisplayName)
                {
                    this._defaultBehaviour = defaultBehaviour;
                    this._invocationBehavior = invocationBehavior;
                    this._propertyDisplayName = propertyDisplayName;
                }

                public void Callback(IndexerIndexerArgumentsCriteria criteria, IndexerIndexerSetterCallback callback)
                {
                    _callbacks.Enqueue((criteria, callback));
                }

                public void Called(IndexerIndexerArgumentsCriteria criteria, global::Imposter.Abstractions.Count count)
                {
                    int invocationCount = _invocationHistory.Count(entry => criteria.Matches(entry.Arguments));
                    if (!count.Matches(invocationCount))
                    {
                        var performedInvocations = new global::System.Collections.Generic.List<string>();
                        foreach (var entry in _invocationHistory)
                        {
                            performedInvocations.Add("set " + _propertyDisplayName + "[" + string.Join(", ", new[] { FormatValue(entry.Arguments.key) }) + "]" + " = " + FormatValue(entry.Value));
                        }

                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount, string.Join(Environment.NewLine, performedInvocations));
                    }
                }

                internal void Set(TKey key, TValue value, global::System.Action? baseImplementation = null)
                {
                    EnsureSetterConfigured();
                    IndexerIndexerArguments arguments = new IndexerIndexerArguments(key);
                    _invocationHistory.Push((arguments, value));
                    bool matchedCallback = false;
                    foreach (var registration in _callbacks)
                    {
                        if (registration.Criteria.Matches(arguments))
                        {
                            registration.Callback(arguments.key, value);
                            matchedCallback = true;
                        }
                    }

                    bool invokedBaseImplementation = false;
                    foreach (var criteria in _baseCriteria)
                    {
                        if (criteria.Matches(arguments))
                        {
                            if (baseImplementation == null)
                            {
                                throw new global::Imposter.Abstractions.MissingImposterException(_propertyDisplayName + " (setter)");
                            }

                            baseImplementation();
                            invokedBaseImplementation = true;
                            break;
                        }
                    }

                    if (!invokedBaseImplementation && (!matchedCallback && _defaultBehaviour.IsOn))
                    {
                        _defaultBehaviour.Set(arguments, value, null);
                    }
                }

                private void EnsureSetterConfigured()
                {
                    if ((_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit) && !global::System.Threading.Volatile.Read(ref _hasConfiguredSetter))
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(_propertyDisplayName + " (setter)");
                    }
                }

                internal void MarkConfigured()
                {
                    global::System.Threading.Volatile.Write(ref _hasConfiguredSetter, true);
                }

                public void UseBaseImplementation(IndexerIndexerArgumentsCriteria criteria)
                {
                    _baseCriteria.Enqueue(criteria);
                    MarkConfigured();
                }

                [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
                internal class Builder : IIndexerIndexerSetterBuilder, IIndexerIndexerSetterFluentBuilder
                {
                    private readonly SetterImposter _setterImposter;
                    private readonly IndexerIndexerArgumentsCriteria _criteria;
                    internal Builder(SetterImposter _setterImposter, IndexerIndexerArgumentsCriteria _criteria)
                    {
                        this._setterImposter = _setterImposter;
                        this._criteria = _criteria;
                    }

                    IIndexerIndexerSetterContinuationBuilder IIndexerIndexerSetterCallbackBuilder.Callback(IndexerIndexerSetterCallback callback)
                    {
                        _setterImposter.Callback(_criteria, callback);
                        return this;
                    }

                    void IIndexerIndexerSetterVerifier.Called(global::Imposter.Abstractions.Count count)
                    {
                        _setterImposter.Called(_criteria, count);
                    }

                    IIndexerIndexerSetterFluentBuilder IIndexerIndexerSetterContinuationBuilder.Then()
                    {
                        return this;
                    }

                    IIndexerIndexerSetterFluentBuilder IIndexerIndexerSetterBuilder.UseBaseImplementation()
                    {
                        _setterImposter.UseBaseImplementation(_criteria);
                        return this;
                    }
                }
            }

            private static string FormatValue(object? value)
            {
                return "<" + (value?.ToString() ?? "null") + ">";
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIndexerIndexerGetterOutcomeBuilder
        {
            IIndexerIndexerGetterContinuationBuilder Returns(TValue value);
            IIndexerIndexerGetterContinuationBuilder Returns(global::System.Func<TValue> valueGenerator);
            IIndexerIndexerGetterContinuationBuilder Returns(IndexerIndexerDelegate valueGenerator);
            IIndexerIndexerGetterContinuationBuilder Throws(global::System.Exception exception);
            IIndexerIndexerGetterContinuationBuilder Throws<TException>()
                where TException : Exception, new();
            IIndexerIndexerGetterContinuationBuilder Throws(IndexerIndexerExceptionGenerator exceptionGenerator);
            IIndexerIndexerGetterContinuationBuilder UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIndexerIndexerGetterCallbackBuilder
        {
            IIndexerIndexerGetterContinuationBuilder Callback(IndexerIndexerGetterCallback callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIndexerIndexerGetterContinuationBuilder : IIndexerIndexerGetterCallbackBuilder
        {
            IIndexerIndexerGetterFluentBuilder Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIndexerIndexerGetterVerifier
        {
            void Called(global::Imposter.Abstractions.Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIndexerIndexerGetterFluentBuilder : IIndexerIndexerGetterOutcomeBuilder, IIndexerIndexerGetterContinuationBuilder
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIndexerIndexerGetterBuilder : IIndexerIndexerGetterOutcomeBuilder, IIndexerIndexerGetterCallbackBuilder, IIndexerIndexerGetterVerifier
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIndexerIndexerSetterCallbackBuilder
        {
            IIndexerIndexerSetterContinuationBuilder Callback(IndexerIndexerSetterCallback callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIndexerIndexerSetterContinuationBuilder : IIndexerIndexerSetterCallbackBuilder
        {
            IIndexerIndexerSetterFluentBuilder Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIndexerIndexerSetterFluentBuilder : IIndexerIndexerSetterCallbackBuilder, IIndexerIndexerSetterContinuationBuilder
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIndexerIndexerSetterVerifier
        {
            void Called(global::Imposter.Abstractions.Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIndexerIndexerSetterBuilder : IIndexerIndexerSetterCallbackBuilder, IIndexerIndexerSetterVerifier
        {
            IIndexerIndexerSetterFluentBuilder UseBaseImplementation();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IIndexerIndexerBuilder
        {
            IIndexerIndexerGetterBuilder Getter();
            IIndexerIndexerSetterBuilder Setter();
        }

        public OpenGenericPairClassImposter(global::Imposter.Abstractions.ImposterMode invocationBehavior = global::Imposter.Abstractions.ImposterMode.Implicit)
        {
            this._resolveMethodImposter = new ResolveMethodImposter(_resolveMethodInvocationHistoryCollection, invocationBehavior);
            this._describePairMethodImposter = new DescribePairMethodImposter(_describePairMethodInvocationHistoryCollection, invocationBehavior);
            this._CurrentPairPropertyBuilderField = new CurrentPairPropertyBuilder(invocationBehavior);
            this._IndexerIndexer = new IndexerIndexerBuilder(invocationBehavior, "Imposter.Tests.Features.OpenGenericImposter.OpenGenericPairClass<TKey, TValue>.this[TKey key]");
            this._imposterInstance = new ImposterTargetInstance(this);
            this._invocationBehavior = invocationBehavior;
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class ImposterTargetInstance : global::Imposter.Tests.Features.OpenGenericImposter.OpenGenericPairClass<TKey, TValue>
        {
            private readonly OpenGenericPairClassImposter<TKey, TValue> _imposter;
            internal ImposterTargetInstance(OpenGenericPairClassImposter<TKey, TValue> _imposter) : base()
            {
                this._imposter = _imposter;
            }

            public override TValue Resolve(TKey key, TValue defaultValue)
            {
                return _imposter._resolveMethodImposter.Invoke(key, defaultValue, base.Resolve);
            }

            public override string DescribePair(TKey key, TValue value)
            {
                return _imposter._describePairMethodImposter.Invoke(key, value, base.DescribePair);
            }

            public override global::System.Collections.Generic.KeyValuePair<TKey, TValue> CurrentPair
            {
                get
                {
                    return _imposter._CurrentPairPropertyBuilderField._getterImposterBuilder.Get(() => base.CurrentPair);
                }

                set
                {
                    _imposter._CurrentPairPropertyBuilderField._setterImposter.Set(value, (baseSetterValue) =>
                    {
                        base.CurrentPair = baseSetterValue;
                    });
                }
            }

            public override TValue this[TKey key]
            {
                get
                {
                    return _imposter._IndexerIndexer.Get(key, () => base[key]);
                }

                set
                {
                    _imposter._IndexerIndexer.Set(key, value, () =>
                    {
                        base[key] = value;
                    });
                }
            }
        }
    }
}
#nullable restore
#pragma warning restore
