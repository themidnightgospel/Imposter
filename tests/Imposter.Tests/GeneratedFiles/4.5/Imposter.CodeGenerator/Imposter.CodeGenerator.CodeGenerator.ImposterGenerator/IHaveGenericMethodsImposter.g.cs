// <auto-generated />
#nullable enable
#pragma warning disable
using global::System;
using global::System.Linq;
using global::System.Collections.Generic;
using global::System.Threading.Tasks;
using global::System.Diagnostics;
using global::System.Runtime.CompilerServices;
using global::Imposter.Abstractions;
using global::System.Collections.Concurrent;
using global::Imposter.Tests.Features.OpenGenericImposter;

namespace Imposter.Tests.Features.OpenGenericImposter
{
    [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
    public sealed class IHaveGenericMethodsImposter : global::Imposter.Abstractions.IHaveImposterInstance<global::Imposter.Tests.Features.OpenGenericImposter.IHaveGenericMethods>
    {
        private readonly GetValueMethodImposterCollection _getValueMethodImposterCollection;
        private readonly AddItemMethodImposterCollection _addItemMethodImposterCollection;
        private readonly ProcessAsyncMethodImposterCollection _processAsyncMethodImposterCollection;
        private readonly ProcessComplexAsyncMethodImposterCollection _processComplexAsyncMethodImposterCollection;
        private readonly GetValueMethodInvocationHistoryCollection _getValueMethodInvocationHistoryCollection = new GetValueMethodInvocationHistoryCollection();
        private readonly AddItemMethodInvocationHistoryCollection _addItemMethodInvocationHistoryCollection = new AddItemMethodInvocationHistoryCollection();
        private readonly ProcessAsyncMethodInvocationHistoryCollection _processAsyncMethodInvocationHistoryCollection = new ProcessAsyncMethodInvocationHistoryCollection();
        private readonly ProcessComplexAsyncMethodInvocationHistoryCollection _processComplexAsyncMethodInvocationHistoryCollection = new ProcessComplexAsyncMethodInvocationHistoryCollection();
        public IGetValueMethodImposterBuilder<TResult> GetValue<TResult>()
        {
            return new GetValueMethodImposter<TResult>.Builder(_getValueMethodImposterCollection, _getValueMethodInvocationHistoryCollection);
        }

        public IAddItemMethodImposterBuilder<TItem> AddItem<TItem>(global::Imposter.Abstractions.Arg<TItem> item)
        {
            return new AddItemMethodImposter<TItem>.Builder(_addItemMethodImposterCollection, _addItemMethodInvocationHistoryCollection, new AddItemArgumentsCriteria<TItem>(item));
        }

        public IProcessAsyncMethodImposterBuilder<TItem> ProcessAsync<TItem>(global::Imposter.Abstractions.Arg<global::System.Collections.Generic.IEnumerable<TItem>> items)
        {
            return new ProcessAsyncMethodImposter<TItem>.Builder(_processAsyncMethodImposterCollection, _processAsyncMethodInvocationHistoryCollection, new ProcessAsyncArgumentsCriteria<TItem>(items));
        }

        public IProcessComplexAsyncMethodImposterBuilder<TItem, TResult> ProcessComplexAsync<TItem, TResult>(global::Imposter.Abstractions.Arg<global::System.Collections.Generic.IEnumerable<TItem>> items)
        {
            return new ProcessComplexAsyncMethodImposter<TItem, TResult>.Builder(_processComplexAsyncMethodImposterCollection, _processComplexAsyncMethodInvocationHistoryCollection, new ProcessComplexAsyncArgumentsCriteria<TItem, TResult>(items));
        }

        private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
        private ImposterTargetInstance _imposterInstance;
        global::Imposter.Tests.Features.OpenGenericImposter.IHaveGenericMethods global::Imposter.Abstractions.IHaveImposterInstance<global::Imposter.Tests.Features.OpenGenericImposter.IHaveGenericMethods>.Instance()
        {
            return _imposterInstance;
        }

        // void IHaveGenericMethods.AddItem<TItem>(TItem item)
        public delegate void AddItemDelegate<TItem>(TItem item);
        // void IHaveGenericMethods.AddItem<TItem>(TItem item)
        public delegate void AddItemCallbackDelegate<TItem>(TItem item);
        // void IHaveGenericMethods.AddItem<TItem>(TItem item)
        public delegate global::System.Exception AddItemExceptionGeneratorDelegate<TItem>(TItem item);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class AddItemArguments<TItem>
        {
            public TItem item;
            internal AddItemArguments(TItem item)
            {
                this.item = item;
            }

            public AddItemArguments<TItemTarget> As<TItemTarget>()
            {
                return new AddItemArguments<TItemTarget>(TypeCaster.Cast<TItem, TItemTarget>(item));
            }
        }

        // void IHaveGenericMethods.AddItem<TItem>(TItem item)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class AddItemArgumentsCriteria<TItem>
        {
            public global::Imposter.Abstractions.Arg<TItem> item { get; }

            public AddItemArgumentsCriteria(global::Imposter.Abstractions.Arg<TItem> item)
            {
                this.item = item;
            }

            public bool Matches(AddItemArguments<TItem> arguments)
            {
                return item.Matches(arguments.item);
            }

            public AddItemArgumentsCriteria<TItemTarget> As<TItemTarget>()
            {
                return new AddItemArgumentsCriteria<TItemTarget>(global::Imposter.Abstractions.Arg<TItemTarget>.Is(it => global::Imposter.Abstractions.TypeCaster.TryCast<TItemTarget, TItem>(it, out TItem itemTarget) && item.Matches(itemTarget)));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IAddItemMethodInvocationHistory
        {
            bool Matches<TItemTarget>(AddItemArgumentsCriteria<TItemTarget> criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class AddItemMethodInvocationHistory<TItem> : IAddItemMethodInvocationHistory
        {
            internal AddItemArguments<TItem> Arguments;
            internal global::System.Exception? Exception;
            public AddItemMethodInvocationHistory(AddItemArguments<TItem> Arguments, global::System.Exception? Exception)
            {
                this.Arguments = Arguments;
                this.Exception = Exception;
            }

            public bool Matches<TItemTarget>(AddItemArgumentsCriteria<TItemTarget> criteria)
            {
                return (typeof(TItemTarget) == typeof(TItem)) && criteria.As<TItem>().Matches(Arguments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class AddItemMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IAddItemMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IAddItemMethodInvocationHistory>();
            internal void Add(IAddItemMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count<TItem>(AddItemArgumentsCriteria<TItem> argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches<TItem>(argumentsCriteria));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class AddItemMethodImposterCollection
        {
            private readonly AddItemMethodInvocationHistoryCollection _addItemMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public AddItemMethodImposterCollection(AddItemMethodInvocationHistoryCollection _addItemMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._addItemMethodInvocationHistoryCollection = _addItemMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            private readonly global::System.Collections.Concurrent.ConcurrentStack<IAddItemMethodImposter> _imposters = new global::System.Collections.Concurrent.ConcurrentStack<IAddItemMethodImposter>();
            internal AddItemMethodImposter<TItem> AddNew<TItem>()
            {
                var imposter = new AddItemMethodImposter<TItem>(_addItemMethodInvocationHistoryCollection, _invocationBehavior);
                _imposters.Push(imposter);
                return imposter;
            }

            internal IAddItemMethodImposter<TItem> GetImposterWithMatchingInvocationImposterGroup<TItem>(AddItemArguments<TItem> arguments)
            {
                return _imposters.Select(it => it.As<TItem>()).Where(it => it != null).Select(it => it!).FirstOrDefault(it => it.HasMatchingInvocationImposterGroup(arguments)) ?? AddNew<TItem>();
            }
        }

        // void IHaveGenericMethods.AddItem<TItem>(TItem item)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class AddItemMethodInvocationImposterGroup<TItem>
        {
            internal static AddItemMethodInvocationImposterGroup<TItem> Default = new AddItemMethodInvocationImposterGroup<TItem>(new AddItemArgumentsCriteria<TItem>(global::Imposter.Abstractions.Arg<TItem>.Any()));
            internal AddItemArgumentsCriteria<TItem> ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public AddItemMethodInvocationImposterGroup(AddItemArgumentsCriteria<TItem> argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public void Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, TItem item)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                invocationImposter.Invoke(invocationBehavior, methodDisplayName, item);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default._resultGenerator = DefaultResultGenerator;
                }

                private AddItemDelegate<TItem>? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<AddItemCallbackDelegate<TItem>> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<AddItemCallbackDelegate<TItem>>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public void Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, TItem item)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    _resultGenerator.Invoke(item);
                    foreach (var callback in _callbacks)
                    {
                        callback(item);
                    }
                }

                internal void Callback(AddItemCallbackDelegate<TItem> callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Throws(AddItemExceptionGeneratorDelegate<TItem> exceptionGenerator)
                {
                    _resultGenerator = (TItem item) =>
                    {
                        throw exceptionGenerator(item);
                    };
                }

                internal static void DefaultResultGenerator(TItem item)
                {
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IAddItemMethodInvocationImposterGroupCallback<TItem>
        {
            IAddItemMethodInvocationImposterGroupContinuation<TItem> Callback(AddItemCallbackDelegate<TItem> callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IAddItemMethodInvocationImposterGroupContinuation<TItem> : IAddItemMethodInvocationImposterGroupCallback<TItem>
        {
            IAddItemMethodInvocationImposterGroup<TItem> Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IAddItemMethodInvocationImposterGroup<TItem> : IAddItemMethodInvocationImposterGroupCallback<TItem>
        {
            IAddItemMethodInvocationImposterGroupContinuation<TItem> Throws<TException>()
                where TException : global::System.Exception, new();
            IAddItemMethodInvocationImposterGroupContinuation<TItem> Throws(global::System.Exception exception);
            IAddItemMethodInvocationImposterGroupContinuation<TItem> Throws(AddItemExceptionGeneratorDelegate<TItem> exceptionGenerator);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface IAddItemMethodImposter
        {
            IAddItemMethodImposter<TItemTarget>? As<TItemTarget>();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface IAddItemMethodImposter<TItem> : IAddItemMethodImposter
        {
            void Invoke(TItem item);
            bool HasMatchingInvocationImposterGroup(AddItemArguments<TItem> arguments);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface AddItemInvocationVerifier<TItem>
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        // void IHaveGenericMethods.AddItem<TItem>(TItem item)
        public interface IAddItemMethodImposterBuilder<TItem> : IAddItemMethodInvocationImposterGroup<TItem>, IAddItemMethodInvocationImposterGroupCallback<TItem>, AddItemInvocationVerifier<TItem>
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class AddItemMethodImposter<TItem> : IAddItemMethodImposter<TItem>
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<AddItemMethodInvocationImposterGroup<TItem>> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<AddItemMethodInvocationImposterGroup<TItem>>();
            private readonly AddItemMethodInvocationHistoryCollection _addItemMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public AddItemMethodImposter(AddItemMethodInvocationHistoryCollection _addItemMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._addItemMethodInvocationHistoryCollection = _addItemMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            IAddItemMethodImposter<TItemTarget>? IAddItemMethodImposter.As<TItemTarget>()
            {
                if (typeof(TItemTarget).IsAssignableTo(typeof(TItem)))
                {
                    return new Adapter<TItemTarget>(this);
                }

                return null;
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            private class Adapter<TItemTarget> : IAddItemMethodImposter<TItemTarget>
            {
                private readonly AddItemMethodImposter<TItem> _target;
                public Adapter(AddItemMethodImposter<TItem> target)
                {
                    _target = target;
                }

                public void Invoke(TItemTarget item)
                {
                    _target.Invoke(global::Imposter.Abstractions.TypeCaster.Cast<TItemTarget, TItem>(item));
                }

                public bool HasMatchingInvocationImposterGroup(AddItemArguments<TItemTarget> arguments)
                {
                    return _target.HasMatchingInvocationImposterGroup(arguments.As<TItem>());
                }

                IAddItemMethodImposter<TItemTarget1>? IAddItemMethodImposter.As<TItemTarget1>()
                {
                    throw new NotImplementedException();
                }
            }

            public bool HasMatchingInvocationImposterGroup(AddItemArguments<TItem> arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private AddItemMethodInvocationImposterGroup<TItem>? FindMatchingInvocationImposterGroup(AddItemArguments<TItem> arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public void Invoke(TItem item)
            {
                var arguments = new AddItemArguments<TItem>(item);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("void IHaveGenericMethods.AddItem<TItem>(TItem item)");
                    }

                    matchingInvocationImposterGroup = AddItemMethodInvocationImposterGroup<TItem>.Default;
                }

                try
                {
                    matchingInvocationImposterGroup.Invoke(_invocationBehavior, "void IHaveGenericMethods.AddItem<TItem>(TItem item)", item);
                    _addItemMethodInvocationHistoryCollection.Add(new AddItemMethodInvocationHistory<TItem>(arguments, default));
                }
                catch (global::System.Exception ex)
                {
                    _addItemMethodInvocationHistoryCollection.Add(new AddItemMethodInvocationHistory<TItem>(arguments, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IAddItemMethodImposterBuilder<TItem>, IAddItemMethodInvocationImposterGroupContinuation<TItem>
            {
                private readonly AddItemMethodImposterCollection _imposterCollection;
                private readonly AddItemMethodInvocationHistoryCollection _addItemMethodInvocationHistoryCollection;
                private readonly AddItemArgumentsCriteria<TItem> _argumentsCriteria;
                private readonly AddItemMethodInvocationImposterGroup<TItem> _invocationImposterGroup;
                private AddItemMethodInvocationImposterGroup<TItem>.MethodInvocationImposter _currentInvocationImposter;
                public Builder(AddItemMethodImposterCollection _imposterCollection, AddItemMethodInvocationHistoryCollection _addItemMethodInvocationHistoryCollection, AddItemArgumentsCriteria<TItem> _argumentsCriteria)
                {
                    this._imposterCollection = _imposterCollection;
                    this._addItemMethodInvocationHistoryCollection = _addItemMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new AddItemMethodInvocationImposterGroup<TItem>(_argumentsCriteria);
                    AddItemMethodImposter<TItem> methodImposter = _imposterCollection.AddNew<TItem>();
                    methodImposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IAddItemMethodInvocationImposterGroupContinuation<TItem> IAddItemMethodInvocationImposterGroup<TItem>.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((TItem item) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IAddItemMethodInvocationImposterGroupContinuation<TItem> IAddItemMethodInvocationImposterGroup<TItem>.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((TItem item) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IAddItemMethodInvocationImposterGroupContinuation<TItem> IAddItemMethodInvocationImposterGroup<TItem>.Throws(AddItemExceptionGeneratorDelegate<TItem> exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((TItem item) =>
                    {
                        throw exceptionGenerator.Invoke(item);
                    });
                    return this;
                }

                IAddItemMethodInvocationImposterGroupContinuation<TItem> IAddItemMethodInvocationImposterGroupCallback<TItem>.Callback(AddItemCallbackDelegate<TItem> callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IAddItemMethodInvocationImposterGroup<TItem> IAddItemMethodInvocationImposterGroupContinuation<TItem>.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void AddItemInvocationVerifier<TItem>.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _addItemMethodInvocationHistoryCollection.Count<TItem>(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        // TResult IHaveGenericMethods.GetValue<TResult>()
        public delegate TResult GetValueDelegate<TResult>();
        // TResult IHaveGenericMethods.GetValue<TResult>()
        public delegate void GetValueCallbackDelegate<TResult>();
        // TResult IHaveGenericMethods.GetValue<TResult>()
        public delegate global::System.Exception GetValueExceptionGeneratorDelegate<TResult>();
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IGetValueMethodInvocationHistory
        {
            bool Matches<TResultTarget>();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class GetValueMethodInvocationHistory<TResult> : IGetValueMethodInvocationHistory
        {
            internal TResult? Result;
            internal global::System.Exception? Exception;
            public GetValueMethodInvocationHistory(TResult? Result, global::System.Exception? Exception)
            {
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches<TResultTarget>()
            {
                return typeof(TResult) == typeof(TResultTarget);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class GetValueMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IGetValueMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IGetValueMethodInvocationHistory>();
            internal void Add(IGetValueMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count<TResult>()
            {
                return _invocationHistory.Count(it => it.Matches<TResult>());
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class GetValueMethodImposterCollection
        {
            private readonly GetValueMethodInvocationHistoryCollection _getValueMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public GetValueMethodImposterCollection(GetValueMethodInvocationHistoryCollection _getValueMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._getValueMethodInvocationHistoryCollection = _getValueMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            private readonly global::System.Collections.Concurrent.ConcurrentStack<IGetValueMethodImposter> _imposters = new global::System.Collections.Concurrent.ConcurrentStack<IGetValueMethodImposter>();
            internal GetValueMethodImposter<TResult> AddNew<TResult>()
            {
                var imposter = new GetValueMethodImposter<TResult>(_getValueMethodInvocationHistoryCollection, _invocationBehavior);
                _imposters.Push(imposter);
                return imposter;
            }

            internal IGetValueMethodImposter<TResult> GetImposterWithMatchingInvocationImposterGroup<TResult>()
            {
                return _imposters.Select(it => it.As<TResult>()).Where(it => it != null).Select(it => it!).FirstOrDefault(it => it.HasMatchingInvocationImposterGroup()) ?? AddNew<TResult>();
            }
        }

        // TResult IHaveGenericMethods.GetValue<TResult>()
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class GetValueMethodInvocationImposterGroup<TResult>
        {
            internal static GetValueMethodInvocationImposterGroup<TResult> Default = new GetValueMethodInvocationImposterGroup<TResult>();
            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public GetValueMethodInvocationImposterGroup()
            {
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public TResult Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private GetValueDelegate<TResult>? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<GetValueCallbackDelegate<TResult>> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<GetValueCallbackDelegate<TResult>>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public TResult Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    TResult result = _resultGenerator.Invoke();
                    foreach (var callback in _callbacks)
                    {
                        callback();
                    }

                    return result;
                }

                internal void Callback(GetValueCallbackDelegate<TResult> callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(GetValueDelegate<TResult> resultGenerator)
                {
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(TResult value)
                {
                    _resultGenerator = () =>
                    {
                        return value;
                    };
                }

                internal void Throws(GetValueExceptionGeneratorDelegate<TResult> exceptionGenerator)
                {
                    _resultGenerator = () =>
                    {
                        throw exceptionGenerator();
                    };
                }

                internal static TResult DefaultResultGenerator()
                {
                    return default !;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IGetValueMethodInvocationImposterGroupCallback<TResult>
        {
            IGetValueMethodInvocationImposterGroupContinuation<TResult> Callback(GetValueCallbackDelegate<TResult> callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IGetValueMethodInvocationImposterGroupContinuation<TResult> : IGetValueMethodInvocationImposterGroupCallback<TResult>
        {
            IGetValueMethodInvocationImposterGroup<TResult> Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IGetValueMethodInvocationImposterGroup<TResult> : IGetValueMethodInvocationImposterGroupCallback<TResult>
        {
            IGetValueMethodInvocationImposterGroupContinuation<TResult> Throws<TException>()
                where TException : global::System.Exception, new();
            IGetValueMethodInvocationImposterGroupContinuation<TResult> Throws(global::System.Exception exception);
            IGetValueMethodInvocationImposterGroupContinuation<TResult> Throws(GetValueExceptionGeneratorDelegate<TResult> exceptionGenerator);
            IGetValueMethodInvocationImposterGroupContinuation<TResult> Returns(GetValueDelegate<TResult> resultGenerator);
            IGetValueMethodInvocationImposterGroupContinuation<TResult> Returns(TResult value);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface IGetValueMethodImposter
        {
            IGetValueMethodImposter<TResultTarget>? As<TResultTarget>();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface IGetValueMethodImposter<TResult> : IGetValueMethodImposter
        {
            TResult Invoke();
            bool HasMatchingInvocationImposterGroup();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface GetValueInvocationVerifier<TResult>
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        // TResult IHaveGenericMethods.GetValue<TResult>()
        public interface IGetValueMethodImposterBuilder<TResult> : IGetValueMethodInvocationImposterGroup<TResult>, IGetValueMethodInvocationImposterGroupCallback<TResult>, GetValueInvocationVerifier<TResult>
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class GetValueMethodImposter<TResult> : IGetValueMethodImposter<TResult>
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<GetValueMethodInvocationImposterGroup<TResult>> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<GetValueMethodInvocationImposterGroup<TResult>>();
            private readonly GetValueMethodInvocationHistoryCollection _getValueMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public GetValueMethodImposter(GetValueMethodInvocationHistoryCollection _getValueMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._getValueMethodInvocationHistoryCollection = _getValueMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            IGetValueMethodImposter<TResultTarget>? IGetValueMethodImposter.As<TResultTarget>()
            {
                if (typeof(TResult).IsAssignableTo(typeof(TResultTarget)))
                {
                    return new Adapter<TResultTarget>(this);
                }

                return null;
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            private class Adapter<TResultTarget> : IGetValueMethodImposter<TResultTarget>
            {
                private readonly GetValueMethodImposter<TResult> _target;
                public Adapter(GetValueMethodImposter<TResult> target)
                {
                    _target = target;
                }

                public TResultTarget Invoke()
                {
                    var result = _target.Invoke();
                    return global::Imposter.Abstractions.TypeCaster.Cast<TResult, TResultTarget>(result);
                }

                public bool HasMatchingInvocationImposterGroup()
                {
                    return _target.HasMatchingInvocationImposterGroup();
                }

                IGetValueMethodImposter<TResultTarget1>? IGetValueMethodImposter.As<TResultTarget1>()
                {
                    throw new NotImplementedException();
                }
            }

            public bool HasMatchingInvocationImposterGroup()
            {
                return FindMatchingInvocationImposterGroup() != null;
            }

            private GetValueMethodInvocationImposterGroup<TResult>? FindMatchingInvocationImposterGroup()
            {
                if (_invocationImposters.TryPeek(out var invocationImposterGroup))
                    return invocationImposterGroup;
                else
                    return null;
            }

            public TResult Invoke()
            {
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup();
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("TResult IHaveGenericMethods.GetValue<TResult>()");
                    }

                    matchingInvocationImposterGroup = GetValueMethodInvocationImposterGroup<TResult>.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "TResult IHaveGenericMethods.GetValue<TResult>()");
                    _getValueMethodInvocationHistoryCollection.Add(new GetValueMethodInvocationHistory<TResult>(result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _getValueMethodInvocationHistoryCollection.Add(new GetValueMethodInvocationHistory<TResult>(default, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IGetValueMethodImposterBuilder<TResult>, IGetValueMethodInvocationImposterGroupContinuation<TResult>
            {
                private readonly GetValueMethodImposterCollection _imposterCollection;
                private readonly GetValueMethodInvocationHistoryCollection _getValueMethodInvocationHistoryCollection;
                private readonly GetValueMethodInvocationImposterGroup<TResult> _invocationImposterGroup;
                private GetValueMethodInvocationImposterGroup<TResult>.MethodInvocationImposter _currentInvocationImposter;
                public Builder(GetValueMethodImposterCollection _imposterCollection, GetValueMethodInvocationHistoryCollection _getValueMethodInvocationHistoryCollection)
                {
                    this._imposterCollection = _imposterCollection;
                    this._getValueMethodInvocationHistoryCollection = _getValueMethodInvocationHistoryCollection;
                    this._invocationImposterGroup = new GetValueMethodInvocationImposterGroup<TResult>();
                    GetValueMethodImposter<TResult> methodImposter = _imposterCollection.AddNew<TResult>();
                    methodImposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IGetValueMethodInvocationImposterGroupContinuation<TResult> IGetValueMethodInvocationImposterGroup<TResult>.Throws<TException>()
                {
                    _currentInvocationImposter.Throws(() =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IGetValueMethodInvocationImposterGroupContinuation<TResult> IGetValueMethodInvocationImposterGroup<TResult>.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws(() =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IGetValueMethodInvocationImposterGroupContinuation<TResult> IGetValueMethodInvocationImposterGroup<TResult>.Throws(GetValueExceptionGeneratorDelegate<TResult> exceptionGenerator)
                {
                    _currentInvocationImposter.Throws(() =>
                    {
                        throw exceptionGenerator.Invoke();
                    });
                    return this;
                }

                IGetValueMethodInvocationImposterGroupContinuation<TResult> IGetValueMethodInvocationImposterGroupCallback<TResult>.Callback(GetValueCallbackDelegate<TResult> callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IGetValueMethodInvocationImposterGroupContinuation<TResult> IGetValueMethodInvocationImposterGroup<TResult>.Returns(GetValueDelegate<TResult> resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                IGetValueMethodInvocationImposterGroupContinuation<TResult> IGetValueMethodInvocationImposterGroup<TResult>.Returns(TResult value)
                {
                    _currentInvocationImposter.Returns(value);
                    return this;
                }

                IGetValueMethodInvocationImposterGroup<TResult> IGetValueMethodInvocationImposterGroupContinuation<TResult>.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void GetValueInvocationVerifier<TResult>.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _getValueMethodInvocationHistoryCollection.Count<TResult>();
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        // Task<TItem> IHaveGenericMethods.ProcessAsync<TItem>(IEnumerable<TItem> items)
        public delegate global::System.Threading.Tasks.Task<TItem> ProcessAsyncDelegate<TItem>(global::System.Collections.Generic.IEnumerable<TItem> items);
        // Task<TItem> IHaveGenericMethods.ProcessAsync<TItem>(IEnumerable<TItem> items)
        public delegate global::System.Threading.Tasks.Task ProcessAsyncCallbackDelegate<TItem>(global::System.Collections.Generic.IEnumerable<TItem> items);
        // Task<TItem> IHaveGenericMethods.ProcessAsync<TItem>(IEnumerable<TItem> items)
        public delegate global::System.Exception ProcessAsyncExceptionGeneratorDelegate<TItem>(global::System.Collections.Generic.IEnumerable<TItem> items);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class ProcessAsyncArguments<TItem>
        {
            public global::System.Collections.Generic.IEnumerable<TItem> items;
            internal ProcessAsyncArguments(global::System.Collections.Generic.IEnumerable<TItem> items)
            {
                this.items = items;
            }

            public ProcessAsyncArguments<TItemTarget> As<TItemTarget>()
            {
                return new ProcessAsyncArguments<TItemTarget>(TypeCaster.Cast<global::System.Collections.Generic.IEnumerable<TItem>, global::System.Collections.Generic.IEnumerable<TItemTarget>>(items));
            }
        }

        // Task<TItem> IHaveGenericMethods.ProcessAsync<TItem>(IEnumerable<TItem> items)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class ProcessAsyncArgumentsCriteria<TItem>
        {
            public global::Imposter.Abstractions.Arg<global::System.Collections.Generic.IEnumerable<TItem>> items { get; }

            public ProcessAsyncArgumentsCriteria(global::Imposter.Abstractions.Arg<global::System.Collections.Generic.IEnumerable<TItem>> items)
            {
                this.items = items;
            }

            public bool Matches(ProcessAsyncArguments<TItem> arguments)
            {
                return items.Matches(arguments.items);
            }

            public ProcessAsyncArgumentsCriteria<TItemTarget> As<TItemTarget>()
            {
                return new ProcessAsyncArgumentsCriteria<TItemTarget>(global::Imposter.Abstractions.Arg<global::System.Collections.Generic.IEnumerable<TItemTarget>>.Is(it => global::Imposter.Abstractions.TypeCaster.TryCast<global::System.Collections.Generic.IEnumerable<TItemTarget>, global::System.Collections.Generic.IEnumerable<TItem>>(it, out global::System.Collections.Generic.IEnumerable<TItem> itemsTarget) && items.Matches(itemsTarget)));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IProcessAsyncMethodInvocationHistory
        {
            bool Matches<TItemTarget>(ProcessAsyncArgumentsCriteria<TItemTarget> criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ProcessAsyncMethodInvocationHistory<TItem> : IProcessAsyncMethodInvocationHistory
        {
            internal ProcessAsyncArguments<TItem> Arguments;
            internal global::System.Threading.Tasks.Task<TItem> Result;
            internal global::System.Exception? Exception;
            public ProcessAsyncMethodInvocationHistory(ProcessAsyncArguments<TItem> Arguments, global::System.Threading.Tasks.Task<TItem> Result, global::System.Exception? Exception)
            {
                this.Arguments = Arguments;
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches<TItemTarget>(ProcessAsyncArgumentsCriteria<TItemTarget> criteria)
            {
                return ((typeof(global::System.Collections.Generic.IEnumerable<TItemTarget>) == typeof(global::System.Collections.Generic.IEnumerable<TItem>)) && (typeof(global::System.Threading.Tasks.Task<TItem>) == typeof(global::System.Threading.Tasks.Task<TItemTarget>))) && criteria.As<TItem>().Matches(Arguments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ProcessAsyncMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IProcessAsyncMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IProcessAsyncMethodInvocationHistory>();
            internal void Add(IProcessAsyncMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count<TItem>(ProcessAsyncArgumentsCriteria<TItem> argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches<TItem>(argumentsCriteria));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ProcessAsyncMethodImposterCollection
        {
            private readonly ProcessAsyncMethodInvocationHistoryCollection _processAsyncMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public ProcessAsyncMethodImposterCollection(ProcessAsyncMethodInvocationHistoryCollection _processAsyncMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._processAsyncMethodInvocationHistoryCollection = _processAsyncMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            private readonly global::System.Collections.Concurrent.ConcurrentStack<IProcessAsyncMethodImposter> _imposters = new global::System.Collections.Concurrent.ConcurrentStack<IProcessAsyncMethodImposter>();
            internal ProcessAsyncMethodImposter<TItem> AddNew<TItem>()
            {
                var imposter = new ProcessAsyncMethodImposter<TItem>(_processAsyncMethodInvocationHistoryCollection, _invocationBehavior);
                _imposters.Push(imposter);
                return imposter;
            }

            internal IProcessAsyncMethodImposter<TItem> GetImposterWithMatchingInvocationImposterGroup<TItem>(ProcessAsyncArguments<TItem> arguments)
            {
                return _imposters.Select(it => it.As<TItem>()).Where(it => it != null).Select(it => it!).FirstOrDefault(it => it.HasMatchingInvocationImposterGroup(arguments)) ?? AddNew<TItem>();
            }
        }

        // Task<TItem> IHaveGenericMethods.ProcessAsync<TItem>(IEnumerable<TItem> items)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class ProcessAsyncMethodInvocationImposterGroup<TItem>
        {
            internal static ProcessAsyncMethodInvocationImposterGroup<TItem> Default = new ProcessAsyncMethodInvocationImposterGroup<TItem>(new ProcessAsyncArgumentsCriteria<TItem>(global::Imposter.Abstractions.Arg<global::System.Collections.Generic.IEnumerable<TItem>>.Any()));
            internal ProcessAsyncArgumentsCriteria<TItem> ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public ProcessAsyncMethodInvocationImposterGroup(ProcessAsyncArgumentsCriteria<TItem> argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public global::System.Threading.Tasks.Task<TItem> Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, global::System.Collections.Generic.IEnumerable<TItem> items)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName, items);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private ProcessAsyncDelegate<TItem>? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<ProcessAsyncCallbackDelegate<TItem>> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<ProcessAsyncCallbackDelegate<TItem>>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public global::System.Threading.Tasks.Task<TItem> Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, global::System.Collections.Generic.IEnumerable<TItem> items)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    global::System.Threading.Tasks.Task<TItem> result = _resultGenerator.Invoke(items);
                    foreach (var callback in _callbacks)
                    {
                        callback(items);
                    }

                    return result;
                }

                internal void Callback(ProcessAsyncCallbackDelegate<TItem> callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(ProcessAsyncDelegate<TItem> resultGenerator)
                {
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(global::System.Threading.Tasks.Task<TItem> value)
                {
                    _resultGenerator = (global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        return value;
                    };
                }

                internal void ReturnsAsync(TItem value)
                {
                    _resultGenerator = async (global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        return value;
                    };
                }

                internal void Throws(ProcessAsyncExceptionGeneratorDelegate<TItem> exceptionGenerator)
                {
                    _resultGenerator = (global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        throw exceptionGenerator(items);
                    };
                }

                internal void ThrowsAsync(global::System.Exception exception)
                {
                    _resultGenerator = async (global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        throw exception;
                    };
                }

                internal static async global::System.Threading.Tasks.Task<TItem> DefaultResultGenerator(global::System.Collections.Generic.IEnumerable<TItem> items)
                {
                    return default !;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IProcessAsyncMethodInvocationImposterGroupCallback<TItem>
        {
            IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> Callback(ProcessAsyncCallbackDelegate<TItem> callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> : IProcessAsyncMethodInvocationImposterGroupCallback<TItem>
        {
            IProcessAsyncMethodInvocationImposterGroup<TItem> Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IProcessAsyncMethodInvocationImposterGroup<TItem> : IProcessAsyncMethodInvocationImposterGroupCallback<TItem>
        {
            IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> Throws<TException>()
                where TException : global::System.Exception, new();
            IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> Throws(global::System.Exception exception);
            IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> Throws(ProcessAsyncExceptionGeneratorDelegate<TItem> exceptionGenerator);
            IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> Returns(ProcessAsyncDelegate<TItem> resultGenerator);
            IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> Returns(global::System.Threading.Tasks.Task<TItem> value);
            IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> ReturnsAsync(TItem value);
            IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> ThrowsAsync(global::System.Exception exception);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface IProcessAsyncMethodImposter
        {
            IProcessAsyncMethodImposter<TItemTarget>? As<TItemTarget>();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface IProcessAsyncMethodImposter<TItem> : IProcessAsyncMethodImposter
        {
            global::System.Threading.Tasks.Task<TItem> Invoke(global::System.Collections.Generic.IEnumerable<TItem> items);
            bool HasMatchingInvocationImposterGroup(ProcessAsyncArguments<TItem> arguments);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ProcessAsyncInvocationVerifier<TItem>
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        // Task<TItem> IHaveGenericMethods.ProcessAsync<TItem>(IEnumerable<TItem> items)
        public interface IProcessAsyncMethodImposterBuilder<TItem> : IProcessAsyncMethodInvocationImposterGroup<TItem>, IProcessAsyncMethodInvocationImposterGroupCallback<TItem>, ProcessAsyncInvocationVerifier<TItem>
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ProcessAsyncMethodImposter<TItem> : IProcessAsyncMethodImposter<TItem>
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<ProcessAsyncMethodInvocationImposterGroup<TItem>> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<ProcessAsyncMethodInvocationImposterGroup<TItem>>();
            private readonly ProcessAsyncMethodInvocationHistoryCollection _processAsyncMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public ProcessAsyncMethodImposter(ProcessAsyncMethodInvocationHistoryCollection _processAsyncMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._processAsyncMethodInvocationHistoryCollection = _processAsyncMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            IProcessAsyncMethodImposter<TItemTarget>? IProcessAsyncMethodImposter.As<TItemTarget>()
            {
                if (typeof(global::System.Collections.Generic.IEnumerable<TItemTarget>).IsAssignableTo(typeof(global::System.Collections.Generic.IEnumerable<TItem>)) && typeof(global::System.Threading.Tasks.Task<TItem>).IsAssignableTo(typeof(global::System.Threading.Tasks.Task<TItemTarget>)))
                {
                    return new Adapter<TItemTarget>(this);
                }

                return null;
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            private class Adapter<TItemTarget> : IProcessAsyncMethodImposter<TItemTarget>
            {
                private readonly ProcessAsyncMethodImposter<TItem> _target;
                public Adapter(ProcessAsyncMethodImposter<TItem> target)
                {
                    _target = target;
                }

                public global::System.Threading.Tasks.Task<TItemTarget> Invoke(global::System.Collections.Generic.IEnumerable<TItemTarget> items)
                {
                    var result = _target.Invoke(global::Imposter.Abstractions.TypeCaster.Cast<global::System.Collections.Generic.IEnumerable<TItemTarget>, global::System.Collections.Generic.IEnumerable<TItem>>(items));
                    return global::Imposter.Abstractions.TypeCaster.Cast<global::System.Threading.Tasks.Task<TItem>, global::System.Threading.Tasks.Task<TItemTarget>>(result);
                }

                public bool HasMatchingInvocationImposterGroup(ProcessAsyncArguments<TItemTarget> arguments)
                {
                    return _target.HasMatchingInvocationImposterGroup(arguments.As<TItem>());
                }

                IProcessAsyncMethodImposter<TItemTarget1>? IProcessAsyncMethodImposter.As<TItemTarget1>()
                {
                    throw new NotImplementedException();
                }
            }

            public bool HasMatchingInvocationImposterGroup(ProcessAsyncArguments<TItem> arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private ProcessAsyncMethodInvocationImposterGroup<TItem>? FindMatchingInvocationImposterGroup(ProcessAsyncArguments<TItem> arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public global::System.Threading.Tasks.Task<TItem> Invoke(global::System.Collections.Generic.IEnumerable<TItem> items)
            {
                var arguments = new ProcessAsyncArguments<TItem>(items);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("Task<TItem> IHaveGenericMethods.ProcessAsync<TItem>(IEnumerable<TItem> items)");
                    }

                    matchingInvocationImposterGroup = ProcessAsyncMethodInvocationImposterGroup<TItem>.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "Task<TItem> IHaveGenericMethods.ProcessAsync<TItem>(IEnumerable<TItem> items)", items);
                    _processAsyncMethodInvocationHistoryCollection.Add(new ProcessAsyncMethodInvocationHistory<TItem>(arguments, result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _processAsyncMethodInvocationHistoryCollection.Add(new ProcessAsyncMethodInvocationHistory<TItem>(arguments, default, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IProcessAsyncMethodImposterBuilder<TItem>, IProcessAsyncMethodInvocationImposterGroupContinuation<TItem>
            {
                private readonly ProcessAsyncMethodImposterCollection _imposterCollection;
                private readonly ProcessAsyncMethodInvocationHistoryCollection _processAsyncMethodInvocationHistoryCollection;
                private readonly ProcessAsyncArgumentsCriteria<TItem> _argumentsCriteria;
                private readonly ProcessAsyncMethodInvocationImposterGroup<TItem> _invocationImposterGroup;
                private ProcessAsyncMethodInvocationImposterGroup<TItem>.MethodInvocationImposter _currentInvocationImposter;
                public Builder(ProcessAsyncMethodImposterCollection _imposterCollection, ProcessAsyncMethodInvocationHistoryCollection _processAsyncMethodInvocationHistoryCollection, ProcessAsyncArgumentsCriteria<TItem> _argumentsCriteria)
                {
                    this._imposterCollection = _imposterCollection;
                    this._processAsyncMethodInvocationHistoryCollection = _processAsyncMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new ProcessAsyncMethodInvocationImposterGroup<TItem>(_argumentsCriteria);
                    ProcessAsyncMethodImposter<TItem> methodImposter = _imposterCollection.AddNew<TItem>();
                    methodImposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> IProcessAsyncMethodInvocationImposterGroup<TItem>.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> IProcessAsyncMethodInvocationImposterGroup<TItem>.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> IProcessAsyncMethodInvocationImposterGroup<TItem>.Throws(ProcessAsyncExceptionGeneratorDelegate<TItem> exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        throw exceptionGenerator.Invoke(items);
                    });
                    return this;
                }

                IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> IProcessAsyncMethodInvocationImposterGroupCallback<TItem>.Callback(ProcessAsyncCallbackDelegate<TItem> callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> IProcessAsyncMethodInvocationImposterGroup<TItem>.Returns(ProcessAsyncDelegate<TItem> resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> IProcessAsyncMethodInvocationImposterGroup<TItem>.Returns(global::System.Threading.Tasks.Task<TItem> value)
                {
                    _currentInvocationImposter.Returns(value);
                    return this;
                }

                IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> IProcessAsyncMethodInvocationImposterGroup<TItem>.ReturnsAsync(TItem value)
                {
                    _currentInvocationImposter.ReturnsAsync(value);
                    return this;
                }

                IProcessAsyncMethodInvocationImposterGroupContinuation<TItem> IProcessAsyncMethodInvocationImposterGroup<TItem>.ThrowsAsync(global::System.Exception exception)
                {
                    _currentInvocationImposter.ThrowsAsync(exception);
                    return this;
                }

                IProcessAsyncMethodInvocationImposterGroup<TItem> IProcessAsyncMethodInvocationImposterGroupContinuation<TItem>.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void ProcessAsyncInvocationVerifier<TItem>.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _processAsyncMethodInvocationHistoryCollection.Count<TItem>(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        // Task<TResult> IHaveGenericMethods.ProcessComplexAsync<TItem, TResult>(IEnumerable<TItem> items)
        public delegate global::System.Threading.Tasks.Task<TResult> ProcessComplexAsyncDelegate<TItem, TResult>(global::System.Collections.Generic.IEnumerable<TItem> items);
        // Task<TResult> IHaveGenericMethods.ProcessComplexAsync<TItem, TResult>(IEnumerable<TItem> items)
        public delegate global::System.Threading.Tasks.Task ProcessComplexAsyncCallbackDelegate<TItem, TResult>(global::System.Collections.Generic.IEnumerable<TItem> items);
        // Task<TResult> IHaveGenericMethods.ProcessComplexAsync<TItem, TResult>(IEnumerable<TItem> items)
        public delegate global::System.Exception ProcessComplexAsyncExceptionGeneratorDelegate<TItem, TResult>(global::System.Collections.Generic.IEnumerable<TItem> items);
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class ProcessComplexAsyncArguments<TItem, TResult>
        {
            public global::System.Collections.Generic.IEnumerable<TItem> items;
            internal ProcessComplexAsyncArguments(global::System.Collections.Generic.IEnumerable<TItem> items)
            {
                this.items = items;
            }

            public ProcessComplexAsyncArguments<TItemTarget, TResultTarget> As<TItemTarget, TResultTarget>()
            {
                return new ProcessComplexAsyncArguments<TItemTarget, TResultTarget>(TypeCaster.Cast<global::System.Collections.Generic.IEnumerable<TItem>, global::System.Collections.Generic.IEnumerable<TItemTarget>>(items));
            }
        }

        // Task<TResult> IHaveGenericMethods.ProcessComplexAsync<TItem, TResult>(IEnumerable<TItem> items)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public class ProcessComplexAsyncArgumentsCriteria<TItem, TResult>
        {
            public global::Imposter.Abstractions.Arg<global::System.Collections.Generic.IEnumerable<TItem>> items { get; }

            public ProcessComplexAsyncArgumentsCriteria(global::Imposter.Abstractions.Arg<global::System.Collections.Generic.IEnumerable<TItem>> items)
            {
                this.items = items;
            }

            public bool Matches(ProcessComplexAsyncArguments<TItem, TResult> arguments)
            {
                return items.Matches(arguments.items);
            }

            public ProcessComplexAsyncArgumentsCriteria<TItemTarget, TResultTarget> As<TItemTarget, TResultTarget>()
            {
                return new ProcessComplexAsyncArgumentsCriteria<TItemTarget, TResultTarget>(global::Imposter.Abstractions.Arg<global::System.Collections.Generic.IEnumerable<TItemTarget>>.Is(it => global::Imposter.Abstractions.TypeCaster.TryCast<global::System.Collections.Generic.IEnumerable<TItemTarget>, global::System.Collections.Generic.IEnumerable<TItem>>(it, out global::System.Collections.Generic.IEnumerable<TItem> itemsTarget) && items.Matches(itemsTarget)));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IProcessComplexAsyncMethodInvocationHistory
        {
            bool Matches<TItemTarget, TResultTarget>(ProcessComplexAsyncArgumentsCriteria<TItemTarget, TResultTarget> criteria);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ProcessComplexAsyncMethodInvocationHistory<TItem, TResult> : IProcessComplexAsyncMethodInvocationHistory
        {
            internal ProcessComplexAsyncArguments<TItem, TResult> Arguments;
            internal global::System.Threading.Tasks.Task<TResult> Result;
            internal global::System.Exception? Exception;
            public ProcessComplexAsyncMethodInvocationHistory(ProcessComplexAsyncArguments<TItem, TResult> Arguments, global::System.Threading.Tasks.Task<TResult> Result, global::System.Exception? Exception)
            {
                this.Arguments = Arguments;
                this.Result = Result;
                this.Exception = Exception;
            }

            public bool Matches<TItemTarget, TResultTarget>(ProcessComplexAsyncArgumentsCriteria<TItemTarget, TResultTarget> criteria)
            {
                return ((typeof(global::System.Collections.Generic.IEnumerable<TItemTarget>) == typeof(global::System.Collections.Generic.IEnumerable<TItem>)) && (typeof(global::System.Threading.Tasks.Task<TResult>) == typeof(global::System.Threading.Tasks.Task<TResultTarget>))) && criteria.As<TItem, TResult>().Matches(Arguments);
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ProcessComplexAsyncMethodInvocationHistoryCollection
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<IProcessComplexAsyncMethodInvocationHistory> _invocationHistory = new global::System.Collections.Concurrent.ConcurrentStack<IProcessComplexAsyncMethodInvocationHistory>();
            internal void Add(IProcessComplexAsyncMethodInvocationHistory invocationHistory)
            {
                _invocationHistory.Push(invocationHistory);
            }

            internal int Count<TItem, TResult>(ProcessComplexAsyncArgumentsCriteria<TItem, TResult> argumentsCriteria)
            {
                return _invocationHistory.Count(it => it.Matches<TItem, TResult>(argumentsCriteria));
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ProcessComplexAsyncMethodImposterCollection
        {
            private readonly ProcessComplexAsyncMethodInvocationHistoryCollection _processComplexAsyncMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public ProcessComplexAsyncMethodImposterCollection(ProcessComplexAsyncMethodInvocationHistoryCollection _processComplexAsyncMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._processComplexAsyncMethodInvocationHistoryCollection = _processComplexAsyncMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            private readonly global::System.Collections.Concurrent.ConcurrentStack<IProcessComplexAsyncMethodImposter> _imposters = new global::System.Collections.Concurrent.ConcurrentStack<IProcessComplexAsyncMethodImposter>();
            internal ProcessComplexAsyncMethodImposter<TItem, TResult> AddNew<TItem, TResult>()
            {
                var imposter = new ProcessComplexAsyncMethodImposter<TItem, TResult>(_processComplexAsyncMethodInvocationHistoryCollection, _invocationBehavior);
                _imposters.Push(imposter);
                return imposter;
            }

            internal IProcessComplexAsyncMethodImposter<TItem, TResult> GetImposterWithMatchingInvocationImposterGroup<TItem, TResult>(ProcessComplexAsyncArguments<TItem, TResult> arguments)
            {
                return _imposters.Select(it => it.As<TItem, TResult>()).Where(it => it != null).Select(it => it!).FirstOrDefault(it => it.HasMatchingInvocationImposterGroup(arguments)) ?? AddNew<TItem, TResult>();
            }
        }

        // Task<TResult> IHaveGenericMethods.ProcessComplexAsync<TItem, TResult>(IEnumerable<TItem> items)
        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class ProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>
        {
            internal static ProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult> Default = new ProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>(new ProcessComplexAsyncArgumentsCriteria<TItem, TResult>(global::Imposter.Abstractions.Arg<global::System.Collections.Generic.IEnumerable<TItem>>.Any()));
            internal ProcessComplexAsyncArgumentsCriteria<TItem, TResult> ArgumentsCriteria { get; }

            private readonly global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentQueue<MethodInvocationImposter>();
            private MethodInvocationImposter? _lastestInvocationImposter;
            public ProcessComplexAsyncMethodInvocationImposterGroup(ProcessComplexAsyncArgumentsCriteria<TItem, TResult> argumentsCriteria)
            {
                ArgumentsCriteria = argumentsCriteria;
            }

            internal MethodInvocationImposter AddInvocationImposter()
            {
                MethodInvocationImposter invocationImposter = new MethodInvocationImposter();
                _invocationImposters.Enqueue(invocationImposter);
                return invocationImposter;
            }

            private MethodInvocationImposter? GetInvocationImposter()
            {
                if (_invocationImposters.TryDequeue(out var invocationImposter))
                {
                    if (!invocationImposter.IsEmpty)
                    {
                        _lastestInvocationImposter = invocationImposter;
                    }

                    return invocationImposter;
                }

                return _lastestInvocationImposter;
            }

            public global::System.Threading.Tasks.Task<TResult> Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, global::System.Collections.Generic.IEnumerable<TItem> items)
            {
                var invocationImposter = GetInvocationImposter();
                if (invocationImposter == null)
                {
                    if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                    }

                    invocationImposter = MethodInvocationImposter.Default;
                }

                return invocationImposter.Invoke(invocationBehavior, methodDisplayName, items);
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class MethodInvocationImposter
            {
                internal static MethodInvocationImposter Default;
                static MethodInvocationImposter()
                {
                    Default = new MethodInvocationImposter();
                    Default.Returns(DefaultResultGenerator);
                }

                private ProcessComplexAsyncDelegate<TItem, TResult>? _resultGenerator;
                private readonly global::System.Collections.Concurrent.ConcurrentQueue<ProcessComplexAsyncCallbackDelegate<TItem, TResult>> _callbacks = new global::System.Collections.Concurrent.ConcurrentQueue<ProcessComplexAsyncCallbackDelegate<TItem, TResult>>();
                internal bool IsEmpty => (_resultGenerator == null) && (_callbacks.Count == 0);

                public global::System.Threading.Tasks.Task<TResult> Invoke(global::Imposter.Abstractions.ImposterMode invocationBehavior, string methodDisplayName, global::System.Collections.Generic.IEnumerable<TItem> items)
                {
                    if (_resultGenerator == null)
                    {
                        if (invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                        {
                            throw new global::Imposter.Abstractions.MissingImposterException(methodDisplayName);
                        }

                        _resultGenerator = DefaultResultGenerator;
                    }

                    global::System.Threading.Tasks.Task<TResult> result = _resultGenerator.Invoke(items);
                    foreach (var callback in _callbacks)
                    {
                        callback(items);
                    }

                    return result;
                }

                internal void Callback(ProcessComplexAsyncCallbackDelegate<TItem, TResult> callback)
                {
                    _callbacks.Enqueue(callback);
                }

                internal void Returns(ProcessComplexAsyncDelegate<TItem, TResult> resultGenerator)
                {
                    _resultGenerator = resultGenerator;
                }

                internal void Returns(global::System.Threading.Tasks.Task<TResult> value)
                {
                    _resultGenerator = (global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        return value;
                    };
                }

                internal void ReturnsAsync(TResult value)
                {
                    _resultGenerator = async (global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        return value;
                    };
                }

                internal void Throws(ProcessComplexAsyncExceptionGeneratorDelegate<TItem, TResult> exceptionGenerator)
                {
                    _resultGenerator = (global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        throw exceptionGenerator(items);
                    };
                }

                internal void ThrowsAsync(global::System.Exception exception)
                {
                    _resultGenerator = async (global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        throw exception;
                    };
                }

                internal static async global::System.Threading.Tasks.Task<TResult> DefaultResultGenerator(global::System.Collections.Generic.IEnumerable<TItem> items)
                {
                    return default !;
                }
            }
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IProcessComplexAsyncMethodInvocationImposterGroupCallback<TItem, TResult>
        {
            IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> Callback(ProcessComplexAsyncCallbackDelegate<TItem, TResult> callback);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> : IProcessComplexAsyncMethodInvocationImposterGroupCallback<TItem, TResult>
        {
            IProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult> Then();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface IProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult> : IProcessComplexAsyncMethodInvocationImposterGroupCallback<TItem, TResult>
        {
            IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> Throws<TException>()
                where TException : global::System.Exception, new();
            IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> Throws(global::System.Exception exception);
            IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> Throws(ProcessComplexAsyncExceptionGeneratorDelegate<TItem, TResult> exceptionGenerator);
            IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> Returns(ProcessComplexAsyncDelegate<TItem, TResult> resultGenerator);
            IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> Returns(global::System.Threading.Tasks.Task<TResult> value);
            IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> ReturnsAsync(TResult value);
            IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> ThrowsAsync(global::System.Exception exception);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface IProcessComplexAsyncMethodImposter
        {
            IProcessComplexAsyncMethodImposter<TItemTarget, TResultTarget>? As<TItemTarget, TResultTarget>();
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal interface IProcessComplexAsyncMethodImposter<TItem, TResult> : IProcessComplexAsyncMethodImposter
        {
            global::System.Threading.Tasks.Task<TResult> Invoke(global::System.Collections.Generic.IEnumerable<TItem> items);
            bool HasMatchingInvocationImposterGroup(ProcessComplexAsyncArguments<TItem, TResult> arguments);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        public interface ProcessComplexAsyncInvocationVerifier<TItem, TResult>
        {
            void Called(Count count);
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        // Task<TResult> IHaveGenericMethods.ProcessComplexAsync<TItem, TResult>(IEnumerable<TItem> items)
        public interface IProcessComplexAsyncMethodImposterBuilder<TItem, TResult> : IProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>, IProcessComplexAsyncMethodInvocationImposterGroupCallback<TItem, TResult>, ProcessComplexAsyncInvocationVerifier<TItem, TResult>
        {
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        internal class ProcessComplexAsyncMethodImposter<TItem, TResult> : IProcessComplexAsyncMethodImposter<TItem, TResult>
        {
            private readonly global::System.Collections.Concurrent.ConcurrentStack<ProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>> _invocationImposters = new global::System.Collections.Concurrent.ConcurrentStack<ProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>>();
            private readonly ProcessComplexAsyncMethodInvocationHistoryCollection _processComplexAsyncMethodInvocationHistoryCollection;
            private readonly global::Imposter.Abstractions.ImposterMode _invocationBehavior;
            public ProcessComplexAsyncMethodImposter(ProcessComplexAsyncMethodInvocationHistoryCollection _processComplexAsyncMethodInvocationHistoryCollection, global::Imposter.Abstractions.ImposterMode _invocationBehavior)
            {
                this._processComplexAsyncMethodInvocationHistoryCollection = _processComplexAsyncMethodInvocationHistoryCollection;
                this._invocationBehavior = _invocationBehavior;
            }

            IProcessComplexAsyncMethodImposter<TItemTarget, TResultTarget>? IProcessComplexAsyncMethodImposter.As<TItemTarget, TResultTarget>()
            {
                if (typeof(global::System.Collections.Generic.IEnumerable<TItemTarget>).IsAssignableTo(typeof(global::System.Collections.Generic.IEnumerable<TItem>)) && typeof(global::System.Threading.Tasks.Task<TResult>).IsAssignableTo(typeof(global::System.Threading.Tasks.Task<TResultTarget>)))
                {
                    return new Adapter<TItemTarget, TResultTarget>(this);
                }

                return null;
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            private class Adapter<TItemTarget, TResultTarget> : IProcessComplexAsyncMethodImposter<TItemTarget, TResultTarget>
            {
                private readonly ProcessComplexAsyncMethodImposter<TItem, TResult> _target;
                public Adapter(ProcessComplexAsyncMethodImposter<TItem, TResult> target)
                {
                    _target = target;
                }

                public global::System.Threading.Tasks.Task<TResultTarget> Invoke(global::System.Collections.Generic.IEnumerable<TItemTarget> items)
                {
                    var result = _target.Invoke(global::Imposter.Abstractions.TypeCaster.Cast<global::System.Collections.Generic.IEnumerable<TItemTarget>, global::System.Collections.Generic.IEnumerable<TItem>>(items));
                    return global::Imposter.Abstractions.TypeCaster.Cast<global::System.Threading.Tasks.Task<TResult>, global::System.Threading.Tasks.Task<TResultTarget>>(result);
                }

                public bool HasMatchingInvocationImposterGroup(ProcessComplexAsyncArguments<TItemTarget, TResultTarget> arguments)
                {
                    return _target.HasMatchingInvocationImposterGroup(arguments.As<TItem, TResult>());
                }

                IProcessComplexAsyncMethodImposter<TItemTarget1, TResultTarget1>? IProcessComplexAsyncMethodImposter.As<TItemTarget1, TResultTarget1>()
                {
                    throw new NotImplementedException();
                }
            }

            public bool HasMatchingInvocationImposterGroup(ProcessComplexAsyncArguments<TItem, TResult> arguments)
            {
                return FindMatchingInvocationImposterGroup(arguments) != null;
            }

            private ProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>? FindMatchingInvocationImposterGroup(ProcessComplexAsyncArguments<TItem, TResult> arguments)
            {
                foreach (var invocationImposterGroup in _invocationImposters)
                {
                    if (invocationImposterGroup.ArgumentsCriteria.Matches(arguments))
                        return invocationImposterGroup;
                }

                return null;
            }

            public global::System.Threading.Tasks.Task<TResult> Invoke(global::System.Collections.Generic.IEnumerable<TItem> items)
            {
                var arguments = new ProcessComplexAsyncArguments<TItem, TResult>(items);
                var matchingInvocationImposterGroup = FindMatchingInvocationImposterGroup(arguments);
                if (matchingInvocationImposterGroup == default)
                {
                    if (_invocationBehavior == global::Imposter.Abstractions.ImposterMode.Explicit)
                    {
                        throw new global::Imposter.Abstractions.MissingImposterException("Task<TResult> IHaveGenericMethods.ProcessComplexAsync<TItem, TResult>(IEnumerable<TItem> items)");
                    }

                    matchingInvocationImposterGroup = ProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>.Default;
                }

                try
                {
                    var result = matchingInvocationImposterGroup.Invoke(_invocationBehavior, "Task<TResult> IHaveGenericMethods.ProcessComplexAsync<TItem, TResult>(IEnumerable<TItem> items)", items);
                    _processComplexAsyncMethodInvocationHistoryCollection.Add(new ProcessComplexAsyncMethodInvocationHistory<TItem, TResult>(arguments, result, default));
                    return result;
                }
                catch (global::System.Exception ex)
                {
                    _processComplexAsyncMethodInvocationHistoryCollection.Add(new ProcessComplexAsyncMethodInvocationHistory<TItem, TResult>(arguments, default, ex));
                    throw;
                }
            }

            [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
            internal class Builder : IProcessComplexAsyncMethodImposterBuilder<TItem, TResult>, IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult>
            {
                private readonly ProcessComplexAsyncMethodImposterCollection _imposterCollection;
                private readonly ProcessComplexAsyncMethodInvocationHistoryCollection _processComplexAsyncMethodInvocationHistoryCollection;
                private readonly ProcessComplexAsyncArgumentsCriteria<TItem, TResult> _argumentsCriteria;
                private readonly ProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult> _invocationImposterGroup;
                private ProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>.MethodInvocationImposter _currentInvocationImposter;
                public Builder(ProcessComplexAsyncMethodImposterCollection _imposterCollection, ProcessComplexAsyncMethodInvocationHistoryCollection _processComplexAsyncMethodInvocationHistoryCollection, ProcessComplexAsyncArgumentsCriteria<TItem, TResult> _argumentsCriteria)
                {
                    this._imposterCollection = _imposterCollection;
                    this._processComplexAsyncMethodInvocationHistoryCollection = _processComplexAsyncMethodInvocationHistoryCollection;
                    this._argumentsCriteria = _argumentsCriteria;
                    this._invocationImposterGroup = new ProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>(_argumentsCriteria);
                    ProcessComplexAsyncMethodImposter<TItem, TResult> methodImposter = _imposterCollection.AddNew<TItem, TResult>();
                    methodImposter._invocationImposters.Push(_invocationImposterGroup);
                    this._currentInvocationImposter = this._invocationImposterGroup.AddInvocationImposter();
                }

                IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> IProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>.Throws<TException>()
                {
                    _currentInvocationImposter.Throws((global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        throw new TException();
                    });
                    return this;
                }

                IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> IProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>.Throws(global::System.Exception exception)
                {
                    _currentInvocationImposter.Throws((global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        throw exception;
                    });
                    return this;
                }

                IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> IProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>.Throws(ProcessComplexAsyncExceptionGeneratorDelegate<TItem, TResult> exceptionGenerator)
                {
                    _currentInvocationImposter.Throws((global::System.Collections.Generic.IEnumerable<TItem> items) =>
                    {
                        throw exceptionGenerator.Invoke(items);
                    });
                    return this;
                }

                IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> IProcessComplexAsyncMethodInvocationImposterGroupCallback<TItem, TResult>.Callback(ProcessComplexAsyncCallbackDelegate<TItem, TResult> callback)
                {
                    _currentInvocationImposter.Callback(callback);
                    return this;
                }

                IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> IProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>.Returns(ProcessComplexAsyncDelegate<TItem, TResult> resultGenerator)
                {
                    _currentInvocationImposter.Returns(resultGenerator);
                    return this;
                }

                IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> IProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>.Returns(global::System.Threading.Tasks.Task<TResult> value)
                {
                    _currentInvocationImposter.Returns(value);
                    return this;
                }

                IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> IProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>.ReturnsAsync(TResult value)
                {
                    _currentInvocationImposter.ReturnsAsync(value);
                    return this;
                }

                IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult> IProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult>.ThrowsAsync(global::System.Exception exception)
                {
                    _currentInvocationImposter.ThrowsAsync(exception);
                    return this;
                }

                IProcessComplexAsyncMethodInvocationImposterGroup<TItem, TResult> IProcessComplexAsyncMethodInvocationImposterGroupContinuation<TItem, TResult>.Then()
                {
                    this._currentInvocationImposter = _invocationImposterGroup.AddInvocationImposter();
                    return this;
                }

                void ProcessComplexAsyncInvocationVerifier<TItem, TResult>.Called(global::Imposter.Abstractions.Count count)
                {
                    var invocationCount = _processComplexAsyncMethodInvocationHistoryCollection.Count<TItem, TResult>(_argumentsCriteria);
                    if (!count.Matches(invocationCount))
                    {
                        throw new global::Imposter.Abstractions.VerificationFailedException(count, invocationCount);
                    }
                }
            }
        }

        public IHaveGenericMethodsImposter(global::Imposter.Abstractions.ImposterMode invocationBehavior = global::Imposter.Abstractions.ImposterMode.Implicit)
        {
            this._getValueMethodImposterCollection = new GetValueMethodImposterCollection(_getValueMethodInvocationHistoryCollection, invocationBehavior);
            this._addItemMethodImposterCollection = new AddItemMethodImposterCollection(_addItemMethodInvocationHistoryCollection, invocationBehavior);
            this._processAsyncMethodImposterCollection = new ProcessAsyncMethodImposterCollection(_processAsyncMethodInvocationHistoryCollection, invocationBehavior);
            this._processComplexAsyncMethodImposterCollection = new ProcessComplexAsyncMethodImposterCollection(_processComplexAsyncMethodInvocationHistoryCollection, invocationBehavior);
            this._imposterInstance = new ImposterTargetInstance(this);
            this._invocationBehavior = invocationBehavior;
        }

        [global::System.CodeDom.Compiler.GeneratedCode("Imposter.CodeGenerator", "0.1.0.0")]
        class ImposterTargetInstance : global::Imposter.Tests.Features.OpenGenericImposter.IHaveGenericMethods
        {
            private readonly IHaveGenericMethodsImposter _imposter;
            public ImposterTargetInstance(IHaveGenericMethodsImposter _imposter)
            {
                this._imposter = _imposter;
            }

            public TResult GetValue<TResult>()
            {
                return _imposter._getValueMethodImposterCollection.GetImposterWithMatchingInvocationImposterGroup<TResult>().Invoke();
            }

            public void AddItem<TItem>(TItem item)
            {
                _imposter._addItemMethodImposterCollection.GetImposterWithMatchingInvocationImposterGroup<TItem>(new AddItemArguments<TItem>(item)).Invoke(item);
            }

            public global::System.Threading.Tasks.Task<TItem> ProcessAsync<TItem>(global::System.Collections.Generic.IEnumerable<TItem> items)
            {
                return _imposter._processAsyncMethodImposterCollection.GetImposterWithMatchingInvocationImposterGroup<TItem>(new ProcessAsyncArguments<TItem>(items)).Invoke(items);
            }

            public global::System.Threading.Tasks.Task<TResult> ProcessComplexAsync<TItem, TResult>(global::System.Collections.Generic.IEnumerable<TItem> items)
            {
                return _imposter._processComplexAsyncMethodImposterCollection.GetImposterWithMatchingInvocationImposterGroup<TItem, TResult>(new ProcessComplexAsyncArguments<TItem, TResult>(items)).Invoke(items);
            }
        }
    }
}
#nullable restore
#pragma warning restore
